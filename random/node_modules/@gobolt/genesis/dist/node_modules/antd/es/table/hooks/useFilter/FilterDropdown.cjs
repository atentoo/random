"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const Y=require("../../../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),De=require("react"),ke=require("../../../../../@ant-design/icons/es/icons/FilterFilled.cjs"),M=require("../../../../../../_virtual/index.cjs"),Z=require("../../../../../rc-util/es/isEqual.cjs"),Se=require("../../../_util/extendsObject.cjs"),Oe=require("../../../_util/hooks/useSyncState.cjs"),Ke=require("../../../_util/warning.cjs"),ee=require("../../../button/button.cjs"),re=require("../../../checkbox/index.cjs"),xe=require("../../../config-provider/context.cjs"),Pe=require("../../../dropdown/index.cjs"),te=require("../../../empty/index.cjs"),qe=require("../../../menu/index.cjs"),Ne=require("../../../menu/OverrideContext.cjs"),Fe=require("../../../radio/index.cjs"),Ve=require("../../../tree/index.cjs"),le=require("./FilterSearch.cjs"),$e=require("./FilterWrapper.cjs");function Me(o){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const a in o)if(a!=="default"){const s=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(n,a,s.get?s:{enumerable:!0,get:()=>o[a]})}}return n.default=o,Object.freeze(n)}const l=Me(De);function P(o){let n=[];return(o||[]).forEach(a=>{let{value:s,children:p}=a;n.push(s),p&&(n=[].concat(Y(n),Y(P(p))))}),n}function ne(o,n){return(typeof n=="string"||typeof n=="number")&&(n==null?void 0:n.toString().toLowerCase().includes(o.trim().toLowerCase()))}function ie(o){let{filters:n,prefixCls:a,filteredKeys:s,filterMultiple:p,searchValue:u,filterSearch:m}=o;return n.map((r,y)=>{const b=String(r.value);if(r.children)return{key:b||y,label:r.text,popupClassName:`${a}-dropdown-submenu`,children:ie({filters:r.children,prefixCls:a,filteredKeys:s,filterMultiple:p,searchValue:u,filterSearch:m})};const F=p?re:Fe.default,d={key:r.value!==void 0?b:y,label:l.createElement(l.Fragment,null,l.createElement(F,{checked:s.includes(b)}),l.createElement("span",null,r.text))};return u.trim()?typeof m=="function"?m(u,r)?d:null:ne(u,r.text)?d:null:d})}function T(o){return o||[]}exports.default=o=>{var n,a,s,p;const{tablePrefixCls:u,prefixCls:m,column:r,dropdownPrefixCls:y,columnKey:b,filterOnClose:F,filterMultiple:d,filterMode:oe="menu",filterSearch:w=!1,filterState:g,triggerFilter:ae,locale:f,children:se,getPopupContainer:j,rootClassName:ce}=o,{filterResetToDefaultFilteredValue:I,defaultFilteredValue:R,filterDropdownProps:v={},filterDropdownOpen:ue,filterDropdownVisible:de,onFilterDropdownVisibleChange:_,onFilterDropdownOpenChange:A}=r,[q,fe]=l.useState(!1),L=!(!g||!(!((n=g.filteredKeys)===null||n===void 0)&&n.length)&&!g.forceFiltered),E=e=>{var t;fe(e),(t=v.onOpenChange)===null||t===void 0||t.call(v,e),A==null||A(e),_==null||_(e)};if(process.env.NODE_ENV!=="production"){const e=Ke.devUseWarning("Table");[["filterDropdownOpen","filterDropdownProps.open"],["filterDropdownVisible","filterDropdownProps.open"],["onFilterDropdownOpenChange","filterDropdownProps.onOpenChange"],["onFilterDropdownVisibleChange","filterDropdownProps.onOpenChange"]].forEach(t=>{let[i,c]=t;e.deprecated(!(i in r),i,c)}),e.deprecated(!("filterCheckall"in f),"filterCheckall","locale.filterCheckAll")}const z=(p=(s=(a=v.open)!==null&&a!==void 0?a:ue)!==null&&s!==void 0?s:de)!==null&&p!==void 0?p:q,D=g==null?void 0:g.filteredKeys,[k,S]=Oe(T(D)),O=e=>{let{selectedKeys:t}=e;S(t)},pe=(e,t)=>{let{node:i,checked:c}=t;O(d?{selectedKeys:e}:{selectedKeys:c&&i.key?[i.key]:[]})};l.useEffect(()=>{q&&O({selectedKeys:T(D)})},[D]);const[me,ge]=l.useState([]),he=e=>{ge(e)},[C,V]=l.useState(""),G=e=>{const{value:t}=e.target;V(t)};l.useEffect(()=>{q||V("")},[q]);const $=e=>{const t=e!=null&&e.length?e:null;return t!==null||g&&g.filteredKeys?Z(t,g==null?void 0:g.filteredKeys,!0)?null:void ae({column:r,key:b,filteredKeys:t}):null},U=()=>{E(!1),$(k())},W=function(){let{confirm:e,closeDropdown:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{confirm:!1,closeDropdown:!1};e&&$([]),t&&E(!1),V(""),S(I?(R||[]).map(i=>String(i)):[])},ve=function(){let{closeDropdown:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{closeDropdown:!0};e&&E(!1),$(k())},ye=M({[`${y}-menu-without-submenu`]:(B=r.filters||[],!B.some(e=>{let{children:t}=e;return t}))});var B;const Ce=e=>{if(e.target.checked){const t=P(r==null?void 0:r.filters).map(i=>String(i));S(t)}else S([])},H=e=>{let{filters:t}=e;return(t||[]).map((i,c)=>{const K=String(i.value),x={title:i.text,key:i.value!==void 0?K:String(c)};return i.children&&(x.children=H({filters:i.children})),x})},J=e=>{var t;return Object.assign(Object.assign({},e),{text:e.title,value:e.key,children:((t=e.children)===null||t===void 0?void 0:t.map(i=>J(i)))||[]})};let h;const{direction:be,renderEmpty:Q}=l.useContext(xe.ConfigContext);if(typeof r.filterDropdown=="function")h=r.filterDropdown({prefixCls:`${y}-custom`,setSelectedKeys:e=>O({selectedKeys:e}),selectedKeys:k(),confirm:ve,clearFilters:W,filters:r.filters,visible:z,close:()=>{E(!1)}});else if(r.filterDropdown)h=r.filterDropdown;else{const e=k()||[],t=()=>{var c,K;const x=(c=Q==null?void 0:Q("Table.filter"))!==null&&c!==void 0?c:l.createElement(te,{image:te.PRESENTED_IMAGE_SIMPLE,description:f.filterEmptyText,styles:{image:{height:24}},style:{margin:0,padding:"16px 0"}});if((r.filters||[]).length===0)return x;if(oe==="tree")return l.createElement(l.Fragment,null,l.createElement(le,{filterSearch:w,value:C,onChange:G,tablePrefixCls:u,locale:f}),l.createElement("div",{className:`${u}-filter-dropdown-tree`},d?l.createElement(re,{checked:e.length===P(r.filters).length,indeterminate:e.length>0&&e.length<P(r.filters).length,className:`${u}-filter-dropdown-checkall`,onChange:Ce},(K=f==null?void 0:f.filterCheckall)!==null&&K!==void 0?K:f==null?void 0:f.filterCheckAll):null,l.createElement(Ve,{checkable:!0,selectable:!1,blockNode:!0,multiple:d,checkStrictly:!d,className:`${y}-menu`,onCheck:pe,checkedKeys:e,selectedKeys:e,showIcon:!1,treeData:H({filters:r.filters}),autoExpandParent:!0,defaultExpandAll:!0,filterTreeNode:C.trim()?N=>typeof w=="function"?w(C,J(N)):ne(C,N.title):void 0})));const X=ie({filters:r.filters||[],filterSearch:w,prefixCls:m,filteredKeys:k(),filterMultiple:d,searchValue:C}),Ee=X.every(N=>N===null);return l.createElement(l.Fragment,null,l.createElement(le,{filterSearch:w,value:C,onChange:G,tablePrefixCls:u,locale:f}),Ee?x:l.createElement(qe,{selectable:!0,multiple:d,prefixCls:`${y}-menu`,className:ye,onSelect:O,onDeselect:O,selectedKeys:e,getPopupContainer:j,openKeys:me,onOpenChange:he,items:X}))},i=()=>I?Z((R||[]).map(c=>String(c)),e,!0):e.length===0;h=l.createElement(l.Fragment,null,t(),l.createElement("div",{className:`${m}-dropdown-btns`},l.createElement(ee,{type:"link",size:"small",disabled:i(),onClick:()=>W()},f.filterReset),l.createElement(ee,{type:"primary",size:"small",onClick:U},f.filterConfirm)))}r.filterDropdown&&(h=l.createElement(Ne.OverrideProvider,{selectable:void 0},h)),h=l.createElement($e,{className:`${m}-dropdown`},h);const we=Se({trigger:["click"],placement:be==="rtl"?"bottomLeft":"bottomRight",children:(()=>{let e;return e=typeof r.filterIcon=="function"?r.filterIcon(L):r.filterIcon?r.filterIcon:l.createElement(ke,null),l.createElement("span",{role:"button",tabIndex:-1,className:M(`${m}-trigger`,{active:L}),onClick:t=>{t.stopPropagation()}},e)})(),getPopupContainer:j},Object.assign(Object.assign({},v),{rootClassName:M(ce,v.rootClassName),open:z,onOpenChange:(e,t)=>{t.source==="trigger"&&(e&&D!==void 0&&S(T(D)),E(e),e||r.filterDropdown||!F||U())},dropdownRender:()=>typeof(v==null?void 0:v.dropdownRender)=="function"?v.dropdownRender(h):h}));return l.createElement("div",{className:`${m}-column`},l.createElement("span",{className:`${u}-column-title`},se),l.createElement(Pe,Object.assign({},we)))},exports.flattenKeys=P;
