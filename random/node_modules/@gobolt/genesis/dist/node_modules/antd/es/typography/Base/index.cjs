"use strict";const ze=require("react"),De=require("../../../../@ant-design/icons/es/icons/EditOutlined.cjs"),Te=require("../../../../../_virtual/index.cjs"),_e=require("../../../../rc-resize-observer/es/index.cjs"),We=require("../../../../rc-util/es/Children/toArray.cjs"),M=require("../../../../rc-util/es/hooks/useLayoutEffect.cjs"),Z=require("../../../../rc-util/es/hooks/useMergedState.cjs"),Fe=require("../../../../rc-util/es/omit.cjs"),Je=require("../../../../rc-util/es/ref.cjs"),ee=require("../../../../rc-util/es/Dom/styleChecker.cjs");require("../../config-provider/index.cjs");const Ve=require("../../locale/useLocale.cjs"),Ae=require("../../tooltip/index.cjs"),Be=require("../Editable.cjs"),Ge=require("../hooks/useCopyClick.cjs"),R=require("../hooks/useMergedConfig.cjs"),He=require("../hooks/usePrevious.cjs"),Ke=require("../hooks/useTooltipProps.cjs"),Qe=require("../Typography.cjs"),Ue=require("./CopyBtn.cjs"),Xe=require("./Ellipsis.cjs"),Ye=require("./EllipsisTooltip.cjs"),te=require("./util.cjs"),Ze=require("../../config-provider/context.cjs");function et(l){const m=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const s in l)if(s!=="default"){const r=Object.getOwnPropertyDescriptor(l,s);Object.defineProperty(m,s,r.get?r:{enumerable:!0,get:()=>l[s]})}}return m.default=l,Object.freeze(m)}const t=et(ze);var tt=function(l,m){var s={};for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&m.indexOf(r)<0&&(s[r]=l[r]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function"){var p=0;for(r=Object.getOwnPropertySymbols(l);p<r.length;p++)m.indexOf(r[p])<0&&Object.prototype.propertyIsEnumerable.call(l,r[p])&&(s[r[p]]=l[r[p]])}return s};const nt=t.forwardRef((l,m)=>{var s;const{prefixCls:r,className:p,style:z,type:D,disabled:ne,children:y,ellipsis:le,editable:re,copyable:ie,component:T,title:w}=l,oe=tt(l,["prefixCls","className","style","type","disabled","children","ellipsis","editable","copyable","component","title"]),{getPrefixCls:ae,direction:_}=t.useContext(Ze.ConfigContext),[c]=Ve("Text"),j=t.useRef(null),W=t.useRef(null),f=ae("typography",r),se=Fe(oe,["mark","code","delete","underline","strong","keyboard","italic"]),[O,i]=R(re),[S,ce]=Z(!1,{value:i.editing}),{triggerType:F=["icon"]}=i,$=e=>{var n;e&&((n=i.onStart)===null||n===void 0||n.call(i)),ce(e)},ue=He(S);M.default(()=>{var e;!S&&ue&&((e=W.current)===null||e===void 0||e.focus())},[S]);const J=e=>{e==null||e.preventDefault(),$(!0)},de=e=>{var n;(n=i.onChange)===null||n===void 0||n.call(i,e),$(!1)},pe=()=>{var e;(e=i.onCancel)===null||e===void 0||e.call(i),$(!1)},[k,V]=R(ie),{copied:A,copyLoading:B,onClick:fe}=Ge({copyConfig:V,children:y}),[G,be]=t.useState(!1),[H,me]=t.useState(!1),[K,ye]=t.useState(!1),[Q,xe]=t.useState(!1),[ge,ve]=t.useState(!0),[x,o]=R(le,{expandable:!1,symbol:e=>e?c==null?void 0:c.collapse:c==null?void 0:c.expand}),[b,Ee]=Z(o.defaultExpanded||!1,{value:o.expanded}),a=x&&(!b||o.expandable==="collapsible"),{rows:q=1}=o,h=t.useMemo(()=>a&&(o.suffix!==void 0||o.onEllipsis||o.expandable||O||k),[a,o,O,k]);M.default(()=>{x&&!h&&(be(ee.isStyleSupport("webkitLineClamp")),me(ee.isStyleSupport("textOverflow")))},[h,x]);const[u,qe]=t.useState(a),U=t.useMemo(()=>!h&&(q===1?H:G),[h,H,G]);M.default(()=>{qe(U&&a)},[U,a]);const X=a&&(u?Q:K),Ce=a&&q===1&&u,P=a&&q>1&&u,[Y,Oe]=t.useState(0),Se=e=>{var n;ye(e),K!==e&&((n=o.onEllipsis)===null||n===void 0||n.call(o,e))};t.useEffect(()=>{const e=j.current;if(x&&u&&e){const n=te.isEleEllipsis(e);Q!==n&&xe(n)}},[x,u,y,P,ge,Y]),t.useEffect(()=>{const e=j.current;if(typeof IntersectionObserver>"u"||!e||!u||!a)return;const n=new IntersectionObserver(()=>{ve(!!e.offsetParent)});return n.observe(e),()=>{n.disconnect()}},[u,a]);const I=Ke(o.tooltip,i.text,y),N=t.useMemo(()=>{if(x&&!u)return[i.text,y,w,I.title].find(te.isValidText)},[x,u,w,I.title,X]);if(S)return t.createElement(Be,{value:(s=i.text)!==null&&s!==void 0?s:typeof y=="string"?y:"",onSave:de,onCancel:pe,onEnd:i.onEnd,prefixCls:f,className:p,style:z,direction:_,component:T,maxLength:i.maxLength,autoSize:i.autoSize,enterIcon:i.enterIcon});const ke=()=>{const{expandable:e,symbol:n}=o;return e?t.createElement("button",{type:"button",key:"expand",className:`${f}-${b?"collapse":"expand"}`,onClick:v=>((d,E)=>{var C;Ee(E.expanded),(C=o.onExpand)===null||C===void 0||C.call(o,d,E)})(v,{expanded:!b}),"aria-label":b?c.collapse:c==null?void 0:c.expand},typeof n=="function"?n(b):n):null},he=()=>{if(!O)return;const{icon:e,tooltip:n,tabIndex:v}=i,d=We(n)[0]||(c==null?void 0:c.edit),E=typeof d=="string"?d:"";return F.includes("icon")?t.createElement(Ae,{key:"edit",title:n===!1?"":d},t.createElement("button",{type:"button",ref:W,className:`${f}-edit`,onClick:J,"aria-label":E,tabIndex:v},e||t.createElement(De,{role:"button"}))):null},we=e=>[e&&ke(),he(),k?t.createElement(Ue,Object.assign({key:"copy"},V,{prefixCls:f,copied:A,locale:c,onCopy:fe,loading:B,iconOnly:y==null})):null];return t.createElement(_e,{onResize:e=>{let{offsetWidth:n}=e;Oe(n)},disabled:!a},e=>t.createElement(Ye,{tooltipProps:I,enableEllipsis:a,isEllipsis:X},t.createElement(Qe,Object.assign({className:Te({[`${f}-${D}`]:D,[`${f}-disabled`]:ne,[`${f}-ellipsis`]:x,[`${f}-ellipsis-single-line`]:Ce,[`${f}-ellipsis-multiple-line`]:P},p),prefixCls:r,style:Object.assign(Object.assign({},z),{WebkitLineClamp:P?q:void 0}),component:T,ref:Je.composeRef(e,j,m),direction:_,onClick:F.includes("text")?J:void 0,"aria-label":N==null?void 0:N.toString(),title:w},se),t.createElement(Xe,{enableMeasure:a&&!u,text:y,rows:q,width:Y,onEllipsis:Se,expanded:b,miscDeps:[A,b,B,O,k,c]},(n,v)=>function(d,E){let{mark:C,code:je,underline:$e,delete:Pe,strong:Ie,keyboard:Ne,italic:Le}=d,L=E;function g(Me,Re){Re&&(L=t.createElement(Me,{},L))}return g("strong",Ie),g("u",$e),g("del",Pe),g("code",je),g("mark",C),g("kbd",Ne),g("i",Le),L}(l,t.createElement(t.Fragment,null,n.length>0&&v&&!b&&N?t.createElement("span",{key:"show-content","aria-hidden":!0},n):n,(d=>[d&&!b&&t.createElement("span",{"aria-hidden":!0,key:"ellipsis"},"..."),o.suffix,we(d)])(v)))))))});module.exports=nt;
