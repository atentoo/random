"use strict";const Q=require("react"),$=require("../../../../_virtual/index.cjs"),X=require("../../../rc-resize-observer/es/index.cjs"),Y=require("../../../rc-util/es/ref.cjs"),Z=require("../_util/responsiveObserver.cjs"),ee=require("../_util/warning.cjs");require("../config-provider/index.cjs");const te=require("../config-provider/hooks/useCSSVarCls.cjs"),re=require("../config-provider/hooks/useSize.cjs"),se=require("../grid/hooks/useBreakpoint.cjs"),ne=require("./AvatarContext.cjs"),ae=require("./style/index.cjs"),oe=require("../config-provider/context.cjs");function ie(e){const c=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const a in e)if(a!=="default"){const s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(c,a,s.get?s:{enumerable:!0,get:()=>e[a]})}}return c.default=e,Object.freeze(c)}const r=ie(Q);var le=function(e,c){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&c.indexOf(s)<0&&(a[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var u=0;for(s=Object.getOwnPropertySymbols(e);u<s.length;u++)c.indexOf(s[u])<0&&Object.prototype.propertyIsEnumerable.call(e,s[u])&&(a[s[u]]=e[s[u]])}return a};const ce=(e,c)=>{const[a,s]=r.useState(1),[u,P]=r.useState(!1),[E,h]=r.useState(!0),y=r.useRef(null),d=r.useRef(null),w=Y.composeRef(c,y),{getPrefixCls:z,avatar:m}=r.useContext(oe.ConfigContext),b=r.useContext(ne),j=()=>{if(!d.current||!y.current)return;const t=d.current.offsetWidth,n=y.current.offsetWidth;if(t!==0&&n!==0){const{gap:l=4}=e;2*l<n&&s(n-2*l<t?(n-2*l)/t:1)}};r.useEffect(()=>{P(!0)},[]),r.useEffect(()=>{h(!0),s(1)},[e.src]),r.useEffect(j,[e.gap]);const R=()=>{const{onError:t}=e;(t==null?void 0:t())!==!1&&h(!1)},{prefixCls:_,shape:D,size:N,src:p,srcSet:k,icon:f,className:A,rootClassName:V,alt:W,draggable:I,children:v,crossOrigin:T}=e,O=le(e,["prefixCls","shape","size","src","srcSet","icon","className","rootClassName","alt","draggable","children","crossOrigin"]),o=re(t=>{var n,l;return(l=(n=N??(b==null?void 0:b.size))!==null&&n!==void 0?n:t)!==null&&l!==void 0?l:"default"}),M=Object.keys(typeof o=="object"&&o||{}).some(t=>["xs","sm","md","lg","xl","xxl"].includes(t)),q=se(M),L=r.useMemo(()=>{if(typeof o!="object")return{};const t=Z.responsiveArray.find(l=>q[l]),n=o[t];return n?{width:n,height:n,fontSize:n&&(f||v)?n/2:18}:{}},[q,o]);if(process.env.NODE_ENV!=="production"){const t=ee.devUseWarning("Avatar");process.env.NODE_ENV!=="production"&&t(!(typeof f=="string"&&f.length>2),"breaking",`\`icon\` is using ReactNode instead of string naming in v4. Please check \`${f}\` at https://ant.design/components/icon`)}const i=z("avatar",_),x=te(i),[U,B,F]=ae.default(i,x),G=$({[`${i}-lg`]:o==="large",[`${i}-sm`]:o==="small"}),S=r.isValidElement(p),H=D||(b==null?void 0:b.shape)||"circle",J=$(i,G,m==null?void 0:m.className,`${i}-${H}`,{[`${i}-image`]:S||p&&E,[`${i}-icon`]:!!f},F,x,A,V,B),K=typeof o=="number"?{width:o,height:o,fontSize:f?o/2:18}:{};let g;if(typeof p=="string"&&E)g=r.createElement("img",{src:p,draggable:I,srcSet:k,onError:R,alt:W,crossOrigin:T});else if(S)g=p;else if(f)g=f;else if(u||a!==1){const t=`scale(${a})`,n={msTransform:t,WebkitTransform:t,transform:t};g=r.createElement(X,{onResize:j},r.createElement("span",{className:`${i}-string`,ref:d,style:Object.assign({},n)},v))}else g=r.createElement("span",{className:`${i}-string`,style:{opacity:0},ref:d},v);return delete O.onError,delete O.gap,U(r.createElement("span",Object.assign({},O,{style:Object.assign(Object.assign(Object.assign(Object.assign({},K),L),m==null?void 0:m.style),O.style),className:J,ref:w}),g))},C=r.forwardRef(ce);process.env.NODE_ENV!=="production"&&(C.displayName="Avatar"),module.exports=C;
