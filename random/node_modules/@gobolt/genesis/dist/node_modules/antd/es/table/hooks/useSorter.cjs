"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const T=require("../../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),J=require("react"),Q=require("../../../../@ant-design/icons/es/icons/CaretDownOutlined.cjs"),U=require("../../../../@ant-design/icons/es/icons/CaretUpOutlined.cjs"),N=require("../../../../../_virtual/index.cjs"),V=require("../../../../rc-util/es/KeyCode.cjs"),_=require("../../tooltip/index.cjs"),j=require("../util.cjs");function W(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const o in e)if(o!=="default"){const c=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(n,o,c.get?c:{enumerable:!0,get:()=>e[o]})}}return n.default=e,Object.freeze(n)}const b=W(J),K="ascend",I="descend",q=e=>typeof e.sorter=="object"&&typeof e.sorter.multiple=="number"&&e.sorter.multiple,H=e=>typeof e=="function"?e:!(!e||typeof e!="object"||!e.compare)&&e.compare,M=(e,n,o)=>{let c=[];const S=(t,u)=>{c.push({column:t,key:j.getColumnKey(t,u),multiplePriority:q(t),sortOrder:t.sortOrder})};return(e||[]).forEach((t,u)=>{const a=j.getColumnPos(u,o);t.children?("sortOrder"in t&&S(t,a),c=[].concat(T(c),T(M(t.children,n,a)))):t.sorter&&("sortOrder"in t?S(t,a):n&&t.defaultSortOrder&&c.push({column:t,key:j.getColumnKey(t,a),multiplePriority:q(t),sortOrder:t.defaultSortOrder}))}),c},L=(e,n,o,c,S,t,u,a)=>(n||[]).map((l,C)=>{const y=j.getColumnPos(C,a);let i=l;if(i.sorter){const v=i.sortDirections||S,r=i.showSorterTooltip===void 0?u:i.showSorterTooltip,d=j.getColumnKey(i,y),g=o.find(h=>{let{key:p}=h;return p===d}),m=g?g.sortOrder:null,O=((h,p)=>p?h[h.indexOf(p)+1]:h[0])(v,m);let s;if(l.sortIcon)s=l.sortIcon({sortOrder:m});else{const h=v.includes(K)&&b.createElement(U,{className:N(`${e}-column-sorter-up`,{active:m===K})}),p=v.includes(I)&&b.createElement(Q,{className:N(`${e}-column-sorter-down`,{active:m===I})});s=b.createElement("span",{className:N(`${e}-column-sorter`,{[`${e}-column-sorter-full`]:!(!h||!p)})},b.createElement("span",{className:`${e}-column-sorter-inner`,"aria-hidden":"true"},h,p))}const{cancelSort:P,triggerAsc:w,triggerDesc:B}=t||{};let k=P;O===I?k=B:O===K&&(k=w);const x=typeof r=="object"?Object.assign({title:k},r):{title:k};i=Object.assign(Object.assign({},i),{className:N(i.className,{[`${e}-column-sort`]:m}),title:h=>{const p=`${e}-column-sorters`,f=b.createElement("span",{className:`${e}-column-title`},j.renderColumnTitle(l.title,h)),E=b.createElement("div",{className:p},f,s);return r?typeof r!="boolean"&&(r==null?void 0:r.target)==="sorter-icon"?b.createElement("div",{className:`${p} ${e}-column-sorters-tooltip-target-sorter`},f,b.createElement(_,Object.assign({},x),s)):b.createElement(_,Object.assign({},x),E):E},onHeaderCell:h=>{var p;const f=((p=l.onHeaderCell)===null||p===void 0?void 0:p.call(l,h))||{},E=f.onClick,A=f.onKeyDown;f.onClick=D=>{c({column:l,key:d,sortOrder:O,multiplePriority:q(l)}),E==null||E(D)},f.onKeyDown=D=>{D.keyCode===V.ENTER&&(c({column:l,key:d,sortOrder:O,multiplePriority:q(l)}),A==null||A(D))};const $=j.safeColumnTitle(l.title,{}),G=$==null?void 0:$.toString();return m&&(f["aria-sort"]=m==="ascend"?"ascending":"descending"),f["aria-label"]=G||"",f.className=N(f.className,`${e}-column-has-sorters`),f.tabIndex=0,l.ellipsis&&(f.title=($??"").toString()),f}})}return"children"in i&&(i=Object.assign(Object.assign({},i),{children:L(e,i.children,o,c,S,t,u,y)})),i}),z=e=>{const{column:n,sortOrder:o}=e;return{column:n,order:o,field:n.dataIndex,columnKey:n.key}},F=e=>{const n=e.filter(o=>{let{sortOrder:c}=o;return c}).map(z);if(n.length===0&&e.length){const o=e.length-1;return Object.assign(Object.assign({},z(e[o])),{column:void 0,order:void 0,field:void 0,columnKey:void 0})}return n.length<=1?n[0]||{}:n},R=(e,n,o)=>{const c=n.slice().sort((u,a)=>a.multiplePriority-u.multiplePriority),S=e.slice(),t=c.filter(u=>{let{column:{sorter:a},sortOrder:l}=u;return H(a)&&l});return t.length?S.sort((u,a)=>{for(let l=0;l<t.length;l+=1){const C=t[l],{column:{sorter:y},sortOrder:i}=C,v=H(y);if(v&&i){const r=v(u,a,i);if(r!==0)return i===K?r:-r}}return 0}).map(u=>{const a=u[o];return a?Object.assign(Object.assign({},u),{[o]:R(a,n,o)}):u}):S};exports.default=e=>{const{prefixCls:n,mergedColumns:o,sortDirections:c,tableLocale:S,showSorterTooltip:t,onSorterChange:u}=e,[a,l]=b.useState(M(o,!0)),C=(r,d)=>{const g=[];return r.forEach((m,O)=>{const s=j.getColumnPos(O,d);if(g.push(j.getColumnKey(m,s)),Array.isArray(m.children)){const P=C(m.children,s);g.push.apply(g,T(P))}}),g},y=b.useMemo(()=>{let r=!0;const d=M(o,!1);if(!d.length){const s=C(o);return a.filter(P=>{let{key:w}=P;return s.includes(w)})}const g=[];function m(s){r?g.push(s):g.push(Object.assign(Object.assign({},s),{sortOrder:null}))}let O=null;return d.forEach(s=>{O===null?(m(s),s.sortOrder&&(s.multiplePriority===!1?r=!1:O=!0)):(O&&s.multiplePriority!==!1||(r=!1),m(s))}),g},[o,a]),i=b.useMemo(()=>{var r,d;const g=y.map(m=>{let{column:O,sortOrder:s}=m;return{column:O,order:s}});return{sortColumns:g,sortColumn:(r=g[0])===null||r===void 0?void 0:r.column,sortOrder:(d=g[0])===null||d===void 0?void 0:d.order}},[y]),v=r=>{let d;d=r.multiplePriority!==!1&&y.length&&y[0].multiplePriority!==!1?[].concat(T(y.filter(g=>{let{key:m}=g;return m!==r.key})),[r]):[r],l(d),u(F(d),d)};return[r=>L(n,r,y,v,c,S,t),y,i,()=>F(y)]},exports.getSortData=R;
