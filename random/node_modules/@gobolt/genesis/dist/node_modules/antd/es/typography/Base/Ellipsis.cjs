"use strict";const K=require("../../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),Q=require("react"),U=require("../../../../rc-util/es/Children/toArray.cjs"),w=require("../../../../rc-util/es/hooks/useLayoutEffect.cjs"),D=require("./util.cjs");function X(i){const s=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const t in i)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(s,t,n.get?n:{enumerable:!0,get:()=>i[t]})}}return s.default=i,Object.freeze(s)}const e=X(Q),h=e.forwardRef((i,s)=>{let{style:t,children:n}=i;const r=e.useRef(null);return e.useImperativeHandle(s,()=>({isExceed:()=>{const l=r.current;return l.scrollHeight>l.clientHeight},getHeight:()=>r.current.clientHeight})),e.createElement("span",{"aria-hidden":!0,ref:r,style:Object.assign({position:"fixed",display:"block",left:0,top:0,pointerEvents:"none",backgroundColor:"rgba(255, 0, 0, 0.65)"},t)},n)});function W(i,s){let t=0;const n=[];for(let r=0;r<i.length;r+=1){if(t===s)return n;const l=i[r],p=t+(D.isValidText(l)?String(l).length:1);if(p>s){const j=s-t;return n.push(String(l).slice(0,j)),n}n.push(l),t=p}return i}const x=0,L=4,O={display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical"};module.exports=function(i){const{enableMeasure:s,width:t,text:n,children:r,rows:l,expanded:p,miscDeps:j,onEllipsis:T}=i,d=e.useMemo(()=>U(n),[n]),H=e.useMemo(()=>(u=>u.reduce((o,a)=>o+(D.isValidText(a)?String(a).length:1),0))(d),[n]),k=e.useMemo(()=>r(d,!1),[n]),[c,M]=e.useState(null),R=e.useRef(null),v=e.useRef(null),y=e.useRef(null),C=e.useRef(null),q=e.useRef(null),[F,N]=e.useState(!1),[f,S]=e.useState(x),[P,V]=e.useState(0),[z,A]=e.useState(null);w.default(()=>{S(s&&t&&H?1:x)},[t,n,l,s,d]),w.default(()=>{var u,o,a,b;if(f===1){S(2);const g=v.current&&getComputedStyle(v.current).whiteSpace;A(g)}else if(f===2){const g=!!(!((u=y.current)===null||u===void 0)&&u.isExceed());S(g?3:L),M(g?[0,H]:null),N(g);const I=((o=y.current)===null||o===void 0?void 0:o.getHeight())||0,_=l===1?0:((a=C.current)===null||a===void 0?void 0:a.getHeight())||0,G=((b=q.current)===null||b===void 0?void 0:b.getHeight())||0,J=Math.max(I,_+G);V(J+1),T(g)}},[f]);const E=c?Math.ceil((c[0]+c[1])/2):0;w.default(()=>{var u;const[o,a]=c||[0,0];if(o!==a){const b=(((u=R.current)===null||u===void 0?void 0:u.getHeight())||0)>P;let g=E;a-o==1&&(g=b?o:a),M(b?[o,g]:[g,a])}},[c,E]);const B=e.useMemo(()=>{if(!s)return r(d,!1);if(f!==3||!c||c[0]!==c[1]){const u=r(d,!1);return[L,x].includes(f)?u:e.createElement("span",{style:Object.assign(Object.assign({},O),{WebkitLineClamp:l})},u)}return r(p?d:W(d,c[0]),F)},[p,f,c,d].concat(K(j))),m={width:t,margin:0,padding:0,whiteSpace:z==="nowrap"?"normal":"inherit"};return e.createElement(e.Fragment,null,B,f===2&&e.createElement(e.Fragment,null,e.createElement(h,{style:Object.assign(Object.assign(Object.assign({},m),O),{WebkitLineClamp:l}),ref:y},k),e.createElement(h,{style:Object.assign(Object.assign(Object.assign({},m),O),{WebkitLineClamp:l-1}),ref:C},k),e.createElement(h,{style:Object.assign(Object.assign(Object.assign({},m),O),{WebkitLineClamp:1}),ref:q},r([],!0))),f===3&&c&&c[0]!==c[1]&&e.createElement(h,{style:Object.assign(Object.assign({},m),{top:400}),ref:R},r(W(d,E),!0)),f===1&&e.createElement("span",{style:{whiteSpace:"inherit"},ref:v}))};
