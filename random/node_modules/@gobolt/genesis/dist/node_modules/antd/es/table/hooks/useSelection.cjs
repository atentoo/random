"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const w=require("../../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),v=require("react"),Fe=require("../../../../@ant-design/icons/es/icons/DownOutlined.cjs"),Ge=require("../../../../../_virtual/index.cjs");require("../../../../rc-table/es/Footer/index.cjs"),require("../../../../rc-table/es/Table.cjs");const ue=require("../../../../rc-table/es/utils/legacyUtil.cjs");require("../../../../rc-table/es/VirtualTable/index.cjs");const Le=require("../../../../rc-tree/es/util.cjs"),de=require("../../../../rc-tree/es/utils/conductUtil.cjs"),We=require("../../../../rc-tree/es/utils/treeUtil.cjs"),Xe=require("../../../../rc-util/es/hooks/useMergedState.cjs"),ze=require("../../_util/hooks/useMultipleSelect.cjs"),Be=require("../../_util/warning.cjs"),Me=require("../../checkbox/index.cjs"),He=require("../../dropdown/index.cjs"),Je=require("../../radio/index.cjs");function Qe(g){const h=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(g){for(const p in g)if(p!=="default"){const C=Object.getOwnPropertyDescriptor(g,p);Object.defineProperty(h,p,C.get?C:{enumerable:!0,get:()=>g[p]})}}return h.default=g,Object.freeze(h)}const S=Qe(v),O={},he="SELECT_ALL",fe="SELECT_INVERT",pe="SELECT_NONE",Ae=[],Ie=(g,h)=>{let p=[];return(h||[]).forEach(C=>{p.push(C),C&&typeof C=="object"&&g in C&&(p=[].concat(w(p),w(Ie(g,C[g]))))}),p};exports.SELECTION_ALL=he,exports.SELECTION_COLUMN=O,exports.SELECTION_INVERT=fe,exports.SELECTION_NONE=pe,exports.default=(g,h)=>{const{preserveSelectedRowKeys:p,selectedRowKeys:C,defaultSelectedRowKeys:qe,getCheckboxProps:U,onChange:Q,onSelect:Y,onSelectAll:me,onSelectInvert:Z,onSelectNone:Ee,onSelectMultiple:ee,columnWidth:ve,type:L,selections:V,fixed:De,renderCell:ge,hideSelectAll:Ce,checkStrictly:q=!0}=h||{},{prefixCls:$,data:te,pageData:z,getRecordByKey:k,getRowKey:m,expandType:ke,childrenColumnName:B,locale:ne,getPopupContainer:Ne}=g,F=Be.devUseWarning("Table"),[Pe,le]=ze(t=>t),[G,oe]=Xe(C||qe||Ae,{value:C}),W=S.useRef(new Map),Se=v.useCallback(t=>{if(p){const l=new Map;t.forEach(e=>{let n=k(e);!n&&W.current.has(e)&&(n=W.current.get(e)),l.set(e,n)}),W.current=l}},[k,p]);S.useEffect(()=>{Se(G)},[G]);const b=v.useMemo(()=>Ie(B,z),[B,z]),{keyEntities:H}=v.useMemo(()=>{if(q)return{keyEntities:null};let t=te;if(p){const l=new Set(b.map((n,c)=>m(n,c))),e=Array.from(W.current).reduce((n,c)=>{let[u,P]=c;return l.has(u)?n:n.concat(P)},[]);t=[].concat(w(t),w(e))}return We.convertDataToEntities(t,{externalGetKey:m,childrenPropName:B})},[te,m,q,B,p,b]),N=v.useMemo(()=>{const t=new Map;return b.forEach((l,e)=>{const n=m(l,e),c=(U?U(l):null)||{};t.set(n,c),process.env.NODE_ENV!=="production"&&F(!("checked"in c||"defaultChecked"in c),"usage","Do not set `checked` or `defaultChecked` in `getCheckboxProps`. Please use `selectedRowKeys` instead.")}),t},[b,m,U]),X=v.useCallback(t=>{const l=m(t);let e;return e=N.has(l)?N.get(m(t)):U?U(t):void 0,!!(e!=null&&e.disabled)},[N,m]),[D,be]=v.useMemo(()=>{if(q)return[G||[],[]];const{checkedKeys:t,halfCheckedKeys:l}=de.conductCheck(G,!0,H,X);return[t||[],l]},[G,q,H,X]),M=v.useMemo(()=>{const t=L==="radio"?D.slice(0,1):D;return new Set(t)},[D,L]),ye=v.useMemo(()=>L==="radio"?new Set:new Set(be),[be,L]);S.useEffect(()=>{h||oe(Ae)},[!!h]);const T=v.useCallback((t,l)=>{let e,n;Se(t),p?(e=t,n=t.map(c=>W.current.get(c))):(e=[],n=[],t.forEach(c=>{const u=k(c);u!==void 0&&(e.push(c),n.push(u))})),oe(e),Q==null||Q(e,n,{type:l})},[oe,k,Q,p]),J=v.useCallback((t,l,e,n)=>{if(Y){const c=e.map(u=>k(u));Y(k(t),l,c,n)}T(e,"single")},[Y,k,T]),ce=v.useMemo(()=>!V||Ce?null:(V===!0?[he,fe,pe]:V).map(t=>t===he?{key:"all",text:ne.selectionAll,onSelect(){T(te.map((l,e)=>m(l,e)).filter(l=>{const e=N.get(l);return!(e!=null&&e.disabled)||M.has(l)}),"all")}}:t===fe?{key:"invert",text:ne.selectInvert,onSelect(){const l=new Set(M);z.forEach((n,c)=>{const u=m(n,c),P=N.get(u);P!=null&&P.disabled||(l.has(u)?l.delete(u):l.add(u))});const e=Array.from(l);Z&&(F.deprecated(!1,"onSelectInvert","onChange"),Z(e)),T(e,"invert")}}:t===pe?{key:"none",text:ne.selectNone,onSelect(){Ee==null||Ee(),T(Array.from(M).filter(l=>{const e=N.get(l);return e==null?void 0:e.disabled}),"none")}}:t).map(t=>Object.assign(Object.assign({},t),{onSelect:function(){for(var l,e,n=arguments.length,c=new Array(n),u=0;u<n;u++)c[u]=arguments[u];(e=t.onSelect)===null||e===void 0||(l=e).call.apply(l,[t].concat(c)),le(null)}})),[V,M,z,m,Z,T]);return[v.useCallback(t=>{var l;if(!h)return process.env.NODE_ENV!=="production"&&F(!t.includes(O),"usage","`rowSelection` is not config but `SELECTION_COLUMN` exists in the `columns`."),t.filter(o=>o!==O);let e=w(t);const n=new Set(M),c=b.map(m).filter(o=>!N.get(o).disabled),u=c.every(o=>n.has(o)),P=c.some(o=>n.has(o)),Ke=()=>{const o=[];u?c.forEach(a=>{n.delete(a),o.push(a)}):c.forEach(a=>{n.has(a)||(n.add(a),o.push(a))});const s=Array.from(n);me==null||me(!u,s.map(a=>k(a)),o.map(a=>k(a))),T(s,"all"),le(null)};let Oe,re,xe;if(L!=="radio"){let o;if(ce){const r={getPopupContainer:Ne,items:ce.map((d,i)=>{const{key:_,text:I,onSelect:y}=d;return{key:_??i,onClick:()=>{y==null||y(c)},label:I}})};o=S.createElement("div",{className:`${$}-selection-extra`},S.createElement(He,{menu:r,getPopupContainer:Ne},S.createElement("span",null,S.createElement(Fe,null))))}const s=b.map((r,d)=>{const i=m(r,d),_=N.get(i)||{};return Object.assign({checked:n.has(i)},_)}).filter(r=>{let{disabled:d}=r;return d}),a=!!s.length&&s.length===b.length,E=a&&s.every(r=>{let{checked:d}=r;return d}),f=a&&s.some(r=>{let{checked:d}=r;return d});re=S.createElement(Me,{checked:a?E:!!b.length&&u,indeterminate:a?!E&&f:!u&&P,onChange:Ke,disabled:b.length===0||a,"aria-label":o?"Custom selection":"Select all",skipGroup:!0}),Oe=!Ce&&S.createElement("div",{className:`${$}-selection`},re,o)}if(xe=L==="radio"?(o,s,a)=>{const E=m(s,a),f=n.has(E),r=N.get(E);return{node:S.createElement(Je.default,Object.assign({},r,{checked:f,onClick:d=>{var i;d.stopPropagation(),(i=r==null?void 0:r.onClick)===null||i===void 0||i.call(r,d)},onChange:d=>{var i;n.has(E)||J(E,!0,[E],d.nativeEvent),(i=r==null?void 0:r.onChange)===null||i===void 0||i.call(r,d)}})),checked:f}}:(o,s,a)=>{var E;const f=m(s,a),r=n.has(f),d=ye.has(f),i=N.get(f);let _;return ke==="nest"?(_=d,process.env.NODE_ENV!=="production"&&F(typeof(i==null?void 0:i.indeterminate)!="boolean","usage","set `indeterminate` using `rowSelection.getCheckboxProps` is not allowed with tree structured dataSource.")):_=(E=i==null?void 0:i.indeterminate)!==null&&E!==void 0?E:d,{node:S.createElement(Me,Object.assign({},i,{indeterminate:_,checked:r,skipGroup:!0,onClick:I=>{var y;I.stopPropagation(),(y=i==null?void 0:i.onClick)===null||y===void 0||y.call(i,I)},onChange:I=>{var y;const{nativeEvent:se}=I,{shiftKey:Ue}=se,Te=c.findIndex(x=>x===f),Ve=D.some(x=>c.includes(x));if(Ue&&q&&Ve){const x=Pe(Te,c,n),R=Array.from(n);ee==null||ee(!r,R.map(j=>k(j)),x.map(j=>k(j))),T(R,"multiple")}else{const x=D;if(q){const R=r?Le.arrDel(x,f):Le.arrAdd(x,f);J(f,!r,R,se)}else{const R=de.conductCheck([].concat(w(x),[f]),!0,H,X),{checkedKeys:j,halfCheckedKeys:$e}=R;let _e=j;if(r){const we=new Set(j);we.delete(f),_e=de.conductCheck(Array.from(we),{halfCheckedKeys:$e},H,X).checkedKeys}J(f,!r,_e,se)}}le(r?null:Te),(y=i==null?void 0:i.onChange)===null||y===void 0||y.call(i,I)}})),checked:r}},!e.includes(O))if(e.findIndex(o=>{var s;return((s=o[ue.INTERNAL_COL_DEFINE])===null||s===void 0?void 0:s.columnType)==="EXPAND_COLUMN"})===0){const[o,...s]=e;e=[o,O].concat(w(s))}else e=[O].concat(w(e));const ie=e.indexOf(O);process.env.NODE_ENV!=="production"&&F(e.filter(o=>o===O).length<=1,"usage","Multiple `SELECTION_COLUMN` exist in `columns`."),e=e.filter((o,s)=>o!==O||s===ie);const A=e[ie-1],ae=e[ie+1];let K=De;K===void 0&&((ae==null?void 0:ae.fixed)!==void 0?K=ae.fixed:(A==null?void 0:A.fixed)!==void 0&&(K=A.fixed)),K&&A&&((l=A[ue.INTERNAL_COL_DEFINE])===null||l===void 0?void 0:l.columnType)==="EXPAND_COLUMN"&&A.fixed===void 0&&(A.fixed=K);const Re=Ge(`${$}-selection-col`,{[`${$}-selection-col-with-dropdown`]:V&&L==="checkbox"}),je={fixed:K,width:ve,className:`${$}-selection-column`,title:h!=null&&h.columnTitle?typeof h.columnTitle=="function"?h.columnTitle(re):h.columnTitle:Oe,render:(o,s,a)=>{const{node:E,checked:f}=xe(o,s,a);return ge?ge(f,s,a,E):E},onCell:h.onCell,[ue.INTERNAL_COL_DEFINE]:{className:Re}};return e.map(o=>o===O?je:o)},[m,b,h,D,M,ye,ve,ce,ke,N,ee,J,X]),M]};
