import $ from "../../../../@babel/runtime/helpers/esm/slicedToArray.js";
import E from "../../../../@babel/runtime/helpers/esm/defineProperty.js";
import y from "../../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import V from "../../../../@babel/runtime/helpers/esm/typeof.js";
import v from "../../../../@babel/runtime/helpers/esm/objectSpread2.js";
import W from "../../../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import nn from "../../../../rc-util/es/Children/toArray.js";
import { warningOnce as I } from "../../../../rc-util/es/warning.js";
import * as h from "react";
import { EXPAND_COLUMN as l } from "../../constant.js";
import { INTERNAL_COL_DEFINE as en } from "../../utils/legacyUtil.js";
import rn from "./useWidthColumns.js";
var tn = ["children"], on = ["fixed"];
function j(n) {
  return nn(n).filter(function(r) {
    return h.isValidElement(r);
  }).map(function(r) {
    var t = r.key, u = r.props, s = u.children, p = W(u, tn), a = v({ key: t }, p);
    return s && (a.children = j(s)), a;
  });
}
function R(n) {
  return n.filter(function(r) {
    return r && V(r) === "object" && !r.hidden;
  }).map(function(r) {
    var t = r.children;
    return t && t.length > 0 ? v(v({}, r), {}, { children: R(t) }) : r;
  });
}
function k(n) {
  var r = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : "key";
  return n.filter(function(t) {
    return t && V(t) === "object";
  }).reduce(function(t, u, s) {
    var p = u.fixed, a = p === !0 ? "left" : p, C = "".concat(r, "-").concat(s), g = u.children;
    return g && g.length > 0 ? [].concat(y(t), y(k(g, C).map(function(D) {
      return v({ fixed: a }, D);
    }))) : [].concat(y(t), [v(v({ key: C }, u), {}, { fixed: a })]);
  }, []);
}
function vn(n, r) {
  var t = n.prefixCls, u = n.columns, s = n.children, p = n.expandable, a = n.expandedKeys, C = n.columnTitle, g = n.getRowKey, D = n.onTriggerExpand, L = n.expandIcon, P = n.rowExpandable, T = n.expandIconColumnIndex, O = n.direction, K = n.expandRowByClick, B = n.columnWidth, M = n.fixed, w = n.scrollWidth, F = n.clientWidth, N = h.useMemo(function() {
    return R((u || j(s) || []).slice());
  }, [u, s]), A = h.useMemo(function() {
    if (p) {
      var e = N.slice();
      if (process.env.NODE_ENV !== "production" && T >= 0 && I(!1, "`expandIconColumnIndex` is deprecated. Please use `Table.EXPAND_COLUMN` in `columns` instead."), !e.includes(l)) {
        var o = T || 0;
        o >= 0 && (o || M === "left" || !M) && e.splice(o, 0, l), M === "right" && e.splice(N.length, 0, l);
      }
      process.env.NODE_ENV !== "production" && e.filter(function(i) {
        return i === l;
      }).length > 1 && I(!1, "There exist more than one `EXPAND_COLUMN` in `columns`.");
      var c = e.indexOf(l);
      e = e.filter(function(i, x) {
        return i !== l || x === c;
      });
      var m, f = N[c];
      m = M || (f ? f.fixed : null);
      var b = E(E(E(E(E(E({}, en, { className: "".concat(t, "-expand-icon-col"), columnType: "EXPAND_COLUMN" }), "title", C), "fixed", m), "className", "".concat(t, "-row-expand-icon-cell")), "width", B), "render", function(i, x, J) {
        var Q = g(x, J), S = a.has(Q), Y = !P || P(x), X = L({ prefixCls: t, expanded: S, expandable: Y, record: x, onExpand: D });
        return K ? h.createElement("span", { onClick: function(Z) {
          return Z.stopPropagation();
        } }, X) : X;
      });
      return e.map(function(i) {
        return i === l ? b : i;
      });
    }
    return process.env.NODE_ENV !== "production" && N.includes(l) && I(!1, "`expandable` is not config but there exist `EXPAND_COLUMN` in `columns`."), N.filter(function(i) {
      return i !== l;
    });
  }, [p, N, g, a, L, O]), _ = h.useMemo(function() {
    var e = A;
    return r && (e = r(e)), e.length || (e = [{ render: function() {
      return null;
    } }]), e;
  }, [r, A, O]), d = h.useMemo(function() {
    return O === "rtl" ? function(e) {
      return e.map(function(o) {
        var c = o.fixed, m = W(o, on), f = c;
        return c === "left" ? f = "right" : c === "right" && (f = "left"), v({ fixed: f }, m);
      });
    }(k(_)) : k(_);
  }, [_, O, w]), H = h.useMemo(function() {
    for (var e = -1, o = d.length - 1; o >= 0; o -= 1) {
      var c = d[o].fixed;
      if (c === "left" || c === !0) {
        e = o;
        break;
      }
    }
    if (e >= 0) for (var m = 0; m <= e; m += 1) {
      var f = d[m].fixed;
      if (f !== "left" && f !== !0) return !0;
    }
    var b = d.findIndex(function(x) {
      return x.fixed === "right";
    });
    if (b >= 0) {
      for (var i = b; i < d.length; i += 1)
        if (d[i].fixed !== "right") return !0;
    }
    return !1;
  }, [d]), q = rn(d, w, F), U = $(q, 2), z = U[0], G = U[1];
  return [_, z, G, H];
}
export {
  j as convertChildrenToColumns,
  vn as default
};
