"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const q=require("../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),s=require("../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),uo=require("../../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),ze=require("../../portal/es/Portal.cjs"),U=require("../../../../_virtual/index.cjs"),to=require("../../../rc-resize-observer/es/index.cjs"),xe=require("../../../rc-util/es/Dom/findDOMNode.cjs"),Ve=require("../../../rc-util/es/Dom/shadow.cjs"),y=require("../../../rc-util/es/hooks/useEvent.cjs"),io=require("../../../rc-util/es/hooks/useId.cjs"),M=require("../../../rc-util/es/hooks/useLayoutEffect.cjs"),ao=require("../../../rc-util/es/isMobile.cjs"),lo=require("react"),so=require("./Popup/index.cjs"),co=require("./TriggerWrapper.cjs"),je=require("./context.cjs"),po=require("./hooks/useAction.cjs"),fo=require("./hooks/useAlign.cjs"),go=require("./hooks/useWatch.cjs"),mo=require("./hooks/useWinClick.cjs"),Z=require("./util.cjs");function vo(m){const v=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(m){for(const n in m)if(n!=="default"){const E=Object.getOwnPropertyDescriptor(m,n);Object.defineProperty(v,n,E.get?E:{enumerable:!0,get:()=>m[n]})}}return v.default=m,Object.freeze(v)}const r=vo(lo);var ho=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];function Le(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ze,v=r.forwardRef(function(n,E){var $=n.prefixCls,C=$===void 0?"rc-trigger-popup":$,Be=n.children,ee=n.action,Fe=ee===void 0?"hover":ee,He=n.showAction,Ie=n.hideAction,b=n.popupVisible,_e=n.defaultPopupVisible,ne=n.onPopupVisibleChange,oe=n.afterPopupVisibleChange,z=n.mouseEnterDelay,re=n.mouseLeaveDelay,L=re===void 0?.1:re,Xe=n.focusDelay,Ye=n.blurDelay,ue=n.mask,te=n.maskClosable,Je=te===void 0||te,We=n.getPopupContainer,Ge=n.forceRender,Ke=n.autoDestroy,Qe=n.destroyPopupOnHide,Ue=n.popup,Ze=n.popupClassName,$e=n.popupStyle,B=n.popupPlacement,ie=n.builtinPlacements,D=ie===void 0?{}:ie,ae=n.popupAlign,en=n.zIndex,le=n.stretch,F=n.getPopupClassNameFromAlign,nn=n.fresh,A=n.alignPoint,on=n.onPopupClick,rn=n.onPopupAlign,H=n.arrow,un=n.popupMotion,tn=n.maskMotion,an=n.popupTransitionName,ln=n.popupAnimation,sn=n.maskTransitionName,cn=n.maskAnimation,se=n.className,pn=n.getTriggerDOMNode,I=uo(n,ho),fn=Ke||Qe||!1,gn=r.useState(!1),ce=s(gn,2),mn=ce[0],vn=ce[1];M.default(function(){vn(ao())},[]);var pe=r.useRef({}),S=r.useContext(je),dn=r.useMemo(function(){return{registerSubPopup:function(e,o){pe.current[e]=o,S==null||S.registerSubPopup(e,o)}}},[S]),hn=io(),Pn=r.useState(null),fe=s(Pn,2),c=fe[0],yn=fe[1],ge=r.useRef(null),Mn=y(function(e){ge.current=e,xe.isDOM(e)&&c!==e&&yn(e),S==null||S.registerSubPopup(hn,e)}),Cn=r.useState(null),me=s(Cn,2),g=me[0],bn=me[1],ve=r.useRef(null),Dn=y(function(e){xe.isDOM(e)&&g!==e&&(bn(e),ve.current=e)}),_=r.Children.only(Be),p=(_==null?void 0:_.props)||{},d={},An=y(function(e){var o,i,t=g;return(t==null?void 0:t.contains(e))||((o=Ve.getShadowRoot(t))===null||o===void 0?void 0:o.host)===e||e===t||(c==null?void 0:c.contains(e))||((i=Ve.getShadowRoot(c))===null||i===void 0?void 0:i.host)===e||e===c||Object.values(pe.current).some(function(u){return(u==null?void 0:u.contains(e))||e===u})}),Sn=Z.getMotion(C,un,ln,an),Nn=Z.getMotion(C,tn,cn,sn),kn=r.useState(_e||!1),de=s(kn,2),qn=de[0],he=de[1],a=b??qn,En=y(function(e){b===void 0&&he(e)});M.default(function(){he(b||!1)},[b]);var N=r.useRef(a);N.current=a;var w=r.useRef([]);w.current=[];var Pe=y(function(e){var o;En(e),((o=w.current[w.current.length-1])!==null&&o!==void 0?o:a)!==e&&(w.current.push(e),ne==null||ne(e))}),ye=r.useRef(),Me=function(){clearTimeout(ye.current)},f=function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;Me(),o===0?Pe(e):ye.current=setTimeout(function(){Pe(e)},1e3*o)};r.useEffect(function(){return Me},[]);var wn=r.useState(!1),Ce=s(wn,2),X=Ce[0],be=Ce[1];M.default(function(e){e&&!a||be(!0)},[a]);var On=r.useState(null),De=s(On,2),Y=De[0],Ae=De[1],Tn=r.useState(null),Se=s(Tn,2),J=Se[0],Rn=Se[1],O=function(e){Rn([e.clientX,e.clientY])},xn=fo(a,c,A&&J!==null?J:g,B,D,ae,rn),l=s(xn,11),Vn=l[0],jn=l[1],zn=l[2],Ln=l[3],Bn=l[4],Fn=l[5],Hn=l[6],In=l[7],_n=l[8],T=l[9],W=l[10],Xn=po(mn,Fe,He,Ie),Ne=s(Xn,2),R=Ne[0],k=Ne[1],ke=R.has("click"),x=k.has("click")||k.has("contextMenu"),h=y(function(){X||W()});go(a,g,c,h,function(){N.current&&A&&x&&f(!1)}),M.default(function(){h()},[J,B]),M.default(function(){!a||D!=null&&D[B]||h()},[JSON.stringify(ae)]);var Yn=r.useMemo(function(){var e=Z.getAlignPopupClassName(D,C,T,A);return U(e,F==null?void 0:F(T))},[T,F,D,C,A]);r.useImperativeHandle(E,function(){return{nativeElement:ve.current,popupElement:ge.current,forceAlign:h}});var Jn=r.useState(0),qe=s(Jn,2),Wn=qe[0],Gn=qe[1],Kn=r.useState(0),Ee=s(Kn,2),Qn=Ee[0],Un=Ee[1],we=function(){if(le&&g){var e=g.getBoundingClientRect();Gn(e.width),Un(e.height)}};function P(e,o,i,t){d[e]=function(u){var V;t==null||t(u),f(o,i);for(var Q=arguments.length,Re=new Array(Q>1?Q-1:0),j=1;j<Q;j++)Re[j-1]=arguments[j];(V=p[e])===null||V===void 0||V.call.apply(V,[p,u].concat(Re))}}M.default(function(){Y&&(W(),Y(),Ae(null))},[Y]),(ke||x)&&(d.onClick=function(e){var o;N.current&&x?f(!1):!N.current&&ke&&(O(e),f(!0));for(var i=arguments.length,t=new Array(i>1?i-1:0),u=1;u<i;u++)t[u-1]=arguments[u];(o=p.onClick)===null||o===void 0||o.call.apply(o,[p,e].concat(t))});var G,Oe,Zn=mo(a,x,g,c,ue,Je,An,f),$n=R.has("hover"),eo=k.has("hover");$n&&(P("onMouseEnter",!0,z,function(e){O(e)}),P("onPointerEnter",!0,z,function(e){O(e)}),G=function(e){(a||X)&&c!=null&&c.contains(e.target)&&f(!0,z)},A&&(d.onMouseMove=function(e){var o;(o=p.onMouseMove)===null||o===void 0||o.call(p,e)})),eo&&(P("onMouseLeave",!1,L),P("onPointerLeave",!1,L),Oe=function(){f(!1,L)}),R.has("focus")&&P("onFocus",!0,Xe),k.has("focus")&&P("onBlur",!1,Ye),R.has("contextMenu")&&(d.onContextMenu=function(e){var o;N.current&&k.has("contextMenu")?f(!1):(O(e),f(!0)),e.preventDefault();for(var i=arguments.length,t=new Array(i>1?i-1:0),u=1;u<i;u++)t[u-1]=arguments[u];(o=p.onContextMenu)===null||o===void 0||o.call.apply(o,[p,e].concat(t))}),se&&(d.className=U(p.className,se));var K=q(q({},p),d),Te={};["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"].forEach(function(e){I[e]&&(Te[e]=function(){for(var o,i=arguments.length,t=new Array(i),u=0;u<i;u++)t[u]=arguments[u];(o=K[e])===null||o===void 0||o.call.apply(o,[K].concat(t)),I[e].apply(I,t)})});var no=r.cloneElement(_,q(q({},K),Te)),oo={x:Fn,y:Hn},ro=H?q({},H!==!0?H:{}):null;return r.createElement(r.Fragment,null,r.createElement(to,{disabled:!a,ref:Dn,onResize:function(){we(),h()}},r.createElement(co,{getTriggerDOMNode:pn},no)),r.createElement(je.Provider,{value:dn},r.createElement(so,{portal:m,ref:Mn,prefixCls:C,popup:Ue,className:U(Ze,Yn),style:$e,target:g,onMouseEnter:G,onMouseLeave:Oe,onPointerEnter:G,zIndex:en,open:a,keepDom:X,fresh:nn,onClick:on,onPointerDownCapture:Zn,mask:ue,motion:Sn,maskMotion:Nn,onVisibleChanged:function(e){be(!1),W(),oe==null||oe(e)},onPrepare:function(){return new Promise(function(e){we(),Ae(function(){return e})})},forceRender:Ge,autoDestroy:fn,getPopupContainer:We,align:T,arrow:ro,arrowPos:oo,ready:Vn,offsetX:jn,offsetY:zn,offsetR:Ln,offsetB:Bn,onAlign:h,stretch:le,targetWidth:Wn/In,targetHeight:Qn/_n})))});return process.env.NODE_ENV!=="production"&&(v.displayName="Trigger"),v}const Po=Le(ze);exports.default=Po,exports.generateTrigger=Le;
