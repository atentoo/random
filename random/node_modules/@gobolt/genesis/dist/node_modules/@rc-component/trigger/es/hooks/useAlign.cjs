"use strict";const J=require("../../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),Q=require("../../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),Br=require("../../../../rc-util/es/Dom/findDOMNode.cjs"),Er=require("../../../../rc-util/es/Dom/isVisible.cjs"),Jr=require("../../../../rc-util/es/hooks/useEvent.cjs"),ke=require("../../../../rc-util/es/hooks/useLayoutEffect.cjs"),Qr=require("react"),D=require("../util.cjs");function Zr(e){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const o in e)if(o!=="default"){const s=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(i,o,s.get?s:{enumerable:!0,get:()=>e[o]})}}return i.default=e,Object.freeze(i)}const C=Zr(Qr);function ze(e){var i="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0),o=i.match(/^(.*)\%$/);return o?e*(parseFloat(o[1])/100):parseFloat(i)}function Ue(e,i){var o=Q(i||[],2),s=o[0],d=o[1];return[ze(e.width,s),ze(e.height,d)]}function Oe(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return[e[0],e[1]]}function H(e,i){var o,s=i[0],d=i[1];return o=s==="t"?e.y:s==="b"?e.y+e.height:e.y+e.height/2,{x:d==="l"?e.x:d==="r"?e.x+e.width:e.x+e.width/2,y:o}}function p(e,i){var o={t:"b",b:"t",l:"r",r:"l"};return e.map(function(s,d){return d===i?o[s]||"c":s}).join("")}module.exports=function(e,i,o,s,d,je,ce){var Ce=C.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:d[s]||{}}),he=Q(Ce,2),h=he[0],ge=he[1],ee=C.useRef(0),ye=C.useMemo(function(){return i?D.collectScroller(i):[]},[i]),f=C.useRef({});e||(f.current={});var er=Jr(function(){if(i&&o&&e){let y=function(E,$r){var j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Me,Qe=t.x+E,Ze=t.y+$r,Pr=Qe+S,Vr=Ze+F,Yr=Math.max(Qe,j.left),Ir=Math.max(Ze,j.top),Kr=Math.min(Pr,j.right),_r=Math.min(Vr,j.bottom);return Math.max(0,(Kr-Yr)*(_r-Ir))},Je=function(){$=t.y+u,k=$+F,P=t.x+a,z=P+S};var w,re,oe,ne,l,r=i,me=r.ownerDocument,te=D.getWin(r).getComputedStyle(r),rr=te.width,or=te.height,nr=te.position,tr=r.style.left,ir=r.style.top,lr=r.style.right,ar=r.style.bottom,ur=r.style.overflow,X=J(J({},d[s]),je),M=me.createElement("div");if((w=r.parentElement)===null||w===void 0||w.appendChild(M),M.style.left="".concat(r.offsetLeft,"px"),M.style.top="".concat(r.offsetTop,"px"),M.style.position=nr,M.style.height="".concat(r.offsetHeight,"px"),M.style.width="".concat(r.offsetWidth,"px"),r.style.left="0",r.style.top="0",r.style.right="auto",r.style.bottom="auto",r.style.overflow="hidden",Array.isArray(o))l={x:o[0],y:o[1],width:0,height:0};else{var ie,le,g=o.getBoundingClientRect();g.x=(ie=g.x)!==null&&ie!==void 0?ie:g.left,g.y=(le=g.y)!==null&&le!==void 0?le:g.top,l={x:g.x,y:g.y,width:g.width,height:g.height}}var t=r.getBoundingClientRect();t.x=(re=t.x)!==null&&re!==void 0?re:t.left,t.y=(oe=t.y)!==null&&oe!==void 0?oe:t.top;var q=me.documentElement,sr=q.clientWidth,fr=q.clientHeight,cr=q.scrollWidth,hr=q.scrollHeight,ve=q.scrollTop,xe=q.scrollLeft,F=t.height,S=t.width,N=l.height,R=l.width,gr={left:0,top:0,right:sr,bottom:fr},yr={left:-xe,top:-ve,right:cr-xe,bottom:hr-ve},G=X.htmlRegion,pe="visible",we="visibleFirst";G!=="scroll"&&G!==we&&(G=pe);var L=G===we,dr=D.getVisibleArea(yr,ye),n=D.getVisibleArea(gr,ye),Me=G===pe?n:dr,Z=L?n:Me;r.style.left="auto",r.style.top="auto",r.style.right="0",r.style.bottom="0";var be=r.getBoundingClientRect();r.style.left=tr,r.style.top=ir,r.style.right=lr,r.style.bottom=ar,r.style.overflow=ur,(ne=r.parentElement)===null||ne===void 0||ne.removeChild(M);var A=D.toNum(Math.round(S/parseFloat(rr)*1e3)/1e3),W=D.toNum(Math.round(F/parseFloat(or)*1e3)/1e3);if(A===0||W===0||Br.isDOM(o)&&!Er(o))return;var mr=X.offset,vr=X.targetOffset,xr=Ue(t,mr),Xe=Q(xr,2),m=Xe[0],v=Xe[1],pr=Ue(l,vr),qe=Q(pr,2),wr=qe[0],Mr=qe[1];l.x-=wr,l.y-=Mr;var br=X.points||[],Fe=Q(br,2),Xr=Fe[0],b=Oe(Fe[1]),c=Oe(Xr),Se=H(l,b),Ae=H(t,c),T=J({},X),a=Se.x-Ae.x+m,u=Se.y-Ae.y+v,$,k,P,z,x=y(a,u),U=y(a,u,n),We=H(l,["t","l"]),Te=H(t,["t","l"]),De=H(l,["b","r"]),He=H(t,["b","r"]),O=X.overflow||{},qr=O.adjustX,Fr=O.adjustY,Ne=O.shiftX,Re=O.shiftY,Ge=function(E){return typeof E=="boolean"?E:E>=0};Je();var Le=Ge(Fr),$e=c[0]===b[0];if(Le&&c[0]==="t"&&(k>Z.bottom||f.current.bt)){var V=u;$e?V-=F-N:V=We.y-He.y-v;var Pe=y(a,V),Sr=y(a,V,n);Pe>x||Pe===x&&(!L||Sr>=U)?(f.current.bt=!0,u=V,v=-v,T.points=[p(c,0),p(b,0)]):f.current.bt=!1}if(Le&&c[0]==="b"&&($<Z.top||f.current.tb)){var Y=u;$e?Y+=F-N:Y=De.y-Te.y-v;var Ve=y(a,Y),Ar=y(a,Y,n);Ve>x||Ve===x&&(!L||Ar>=U)?(f.current.tb=!0,u=Y,v=-v,T.points=[p(c,0),p(b,0)]):f.current.tb=!1}var Ye=Ge(qr),Ie=c[1]===b[1];if(Ye&&c[1]==="l"&&(z>Z.right||f.current.rl)){var I=a;Ie?I-=S-R:I=We.x-He.x-m;var Ke=y(I,u),Wr=y(I,u,n);Ke>x||Ke===x&&(!L||Wr>=U)?(f.current.rl=!0,a=I,m=-m,T.points=[p(c,1),p(b,1)]):f.current.rl=!1}if(Ye&&c[1]==="r"&&(P<Z.left||f.current.lr)){var K=a;Ie?K+=S-R:K=De.x-Te.x-m;var _e=y(K,u),Tr=y(K,u,n);_e>x||_e===x&&(!L||Tr>=U)?(f.current.lr=!0,a=K,m=-m,T.points=[p(c,1),p(b,1)]):f.current.lr=!1}Je();var _=Ne===!0?0:Ne;typeof _=="number"&&(P<n.left&&(a-=P-n.left-m,l.x+R<n.left+_&&(a+=l.x-n.left+R-_)),z>n.right&&(a-=z-n.right-m,l.x>n.right-_&&(a+=l.x-n.right+_)));var B=Re===!0?0:Re;typeof B=="number"&&($<n.top&&(u-=$-n.top-v,l.y+N<n.top+B&&(u+=l.y-n.top+N-B)),k>n.bottom&&(u-=k-n.bottom-v,l.y>n.bottom-B&&(u+=l.y-n.bottom+B)));var ae=t.x+a,Dr=ae+S,ue=t.y+u,Hr=ue+F,Be=l.x,Nr=Be+R,Ee=l.y,Rr=Ee+N,Gr=(Math.max(ae,Be)+Math.min(Dr,Nr))/2-ae,Lr=(Math.max(ue,Ee)+Math.min(Hr,Rr))/2-ue;ce==null||ce(i,T);var se=be.right-t.x-(a+t.width),fe=be.bottom-t.y-(u+t.height);A===1&&(a=Math.round(a),se=Math.round(se)),W===1&&(u=Math.round(u),fe=Math.round(fe)),ge({ready:!0,offsetX:a/A,offsetY:u/W,offsetR:se/A,offsetB:fe/W,arrowX:Gr/A,arrowY:Lr/W,scaleX:A,scaleY:W,align:T})}}),de=function(){ge(function(w){return J(J({},w),{},{ready:!1})})};return ke.default(de,[s]),ke.default(function(){e||de()},[e]),[h.ready,h.offsetX,h.offsetY,h.offsetR,h.offsetB,h.arrowX,h.arrowY,h.scaleX,h.scaleY,h.align,function(){ee.current+=1;var w=ee.current;Promise.resolve().then(function(){ee.current===w&&er()})}]};
