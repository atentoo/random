import C from "../../../@babel/runtime/helpers/esm/defineProperty.js";
import P from "../../../@babel/runtime/helpers/esm/extends.js";
import G from "../../../@babel/runtime/helpers/esm/objectSpread2.js";
import he from "../../../@babel/runtime/helpers/esm/slicedToArray.js";
import H from "../../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import * as n from "react";
import Me from "../../../../_virtual/index.js";
import be from "../../../rc-overflow/es/Overflow.js";
import { warningOnce as xe } from "../../../rc-util/es/warning.js";
import Ie from "./SubMenuList.js";
import { parseChildren as ke } from "../utils/commonUtil.js";
import J, { MenuContext as Ne } from "../context/MenuContext.js";
import Pe from "../hooks/useMemoCallback.js";
import ge from "./PopupTrigger.js";
import Ke from "../Icon.js";
import Se from "../hooks/useActive.js";
import { warnItemProp as we } from "../utils/warnUtil.js";
import Oe from "../hooks/useDirectionStyle.js";
import Le from "./InlineSubMenuList.js";
import { useFullPath as Q, useMeasure as Re, PathTrackerContext as Te, PathUserContext as ze } from "../context/PathContext.js";
import { useMenuId as De } from "../context/IdContext.js";
import Ve from "../context/PrivateContext.js";
var _e = ["style", "className", "title", "eventKey", "warnKey", "disabled", "internalPopupClose", "children", "itemIcon", "expandIcon", "popupClassName", "popupOffset", "popupStyle", "onClick", "onMouseEnter", "onMouseLeave", "onTitleClick", "onTitleMouseEnter", "onTitleMouseLeave"], Ae = ["active"], Fe = n.forwardRef(function(e, E) {
  var u = e.style, m = e.className, p = e.title, t = e.eventKey, f = e.warnKey, c = e.disabled, W = e.internalPopupClose, g = e.children, K = e.itemIcon, S = e.expandIcon, X = e.popupClassName, Y = e.popupOffset, Z = e.popupStyle, w = e.onClick, O = e.onMouseEnter, L = e.onMouseLeave, R = e.onTitleClick, $ = e.onTitleMouseEnter, ee = e.onTitleMouseLeave, ne = H(e, _e), d = De(t), r = n.useContext(Ne), te = r.prefixCls, o = r.mode, oe = r.openKeys, re = r.disabled, v = r.overflowDisabled, T = r.activeKey, ie = r.selectedKeys, ae = r.itemIcon, le = r.expandIcon, se = r.onItemClick, z = r.onOpenChange, ce = r.onActive, D = n.useContext(Ve)._internalRenderSubMenuItem, y = n.useContext(ze).isSubPathKey, h = Q(), a = "".concat(te, "-submenu"), l = re || c, me = n.useRef(), pe = n.useRef();
  process.env.NODE_ENV !== "production" && f && xe(!1, "SubMenu should not leave undefined `key`.");
  var ue = K ?? ae, M = S ?? le, V = oe.includes(t), s = !v && V, _ = y(ie, t), A = Se(t, l, $, ee), F = A.active, fe = H(A, Ae), de = n.useState(!1), j = he(de, 2), U = j[0], ve = j[1], q = function(i) {
    l || ve(i);
  }, B = n.useMemo(function() {
    return F || o !== "inline" && (U || y([T], t));
  }, [o, F, T, U, t, y]), Ce = Oe(h.length), Ee = Pe(function(i) {
    w == null || w(we(i)), se(i);
  }), b = d && "".concat(d, "-popup"), ye = n.useMemo(function() {
    return n.createElement(Ke, { icon: o !== "horizontal" ? M : void 0, props: G(G({}, e), {}, { isOpen: s, isSubMenu: !0 }) }, n.createElement("i", { className: "".concat(a, "-arrow") }));
  }, [o, M, e, s, a]), x = n.createElement("div", P({ role: "menuitem", style: Ce, className: "".concat(a, "-title"), tabIndex: l ? null : -1, ref: me, title: typeof p == "string" ? p : null, "data-menu-id": v && d ? null : d, "aria-expanded": s, "aria-haspopup": !0, "aria-controls": b, "aria-disabled": l, onClick: function(i) {
    l || (R == null || R({ key: t, domEvent: i }), o === "inline" && z(t, !V));
  }, onFocus: function() {
    ce(t);
  } }, fe), p, ye), I = n.useRef(o);
  if (o !== "inline" && h.length > 1 ? I.current = "vertical" : I.current = o, !v) {
    var k = I.current;
    x = n.createElement(ge, { mode: k, prefixCls: a, visible: !W && s && o !== "inline", popupClassName: X, popupOffset: Y, popupStyle: Z, popup: n.createElement(J, { mode: k === "horizontal" ? "vertical" : k }, n.createElement(Ie, { id: b, ref: pe }, g)), disabled: l, onVisibleChange: function(i) {
      o !== "inline" && z(t, i);
    } }, x);
  }
  var N = n.createElement(be.Item, P({ ref: E, role: "none" }, ne, { component: "li", style: u, className: Me(a, "".concat(a, "-").concat(o), m, C(C(C(C({}, "".concat(a, "-open"), s), "".concat(a, "-active"), B), "".concat(a, "-selected"), _), "".concat(a, "-disabled"), l)), onMouseEnter: function(i) {
    q(!0), O == null || O({ key: t, domEvent: i });
  }, onMouseLeave: function(i) {
    q(!1), L == null || L({ key: t, domEvent: i });
  } }), x, !v && n.createElement(Le, { id: b, open: s, keyPath: h }, g));
  return D && (N = D(N, e, { selected: _, active: B, open: s, disabled: l })), n.createElement(J, { onItemClick: Ee, mode: o === "horizontal" ? "vertical" : o, itemIcon: ue, expandIcon: M }, N);
}), je = n.forwardRef(function(e, E) {
  var u, m = e.eventKey, p = e.children, t = Q(m), f = ke(p, t), c = Re();
  return n.useEffect(function() {
    if (c) return c.registerPath(m, t), function() {
      c.unregisterPath(m, t);
    };
  }, [t]), u = c ? f : n.createElement(Fe, P({ ref: E }, e), f), n.createElement(Te.Provider, { value: t }, u);
});
process.env.NODE_ENV !== "production" && (je.displayName = "SubMenu");
export {
  je as default
};
