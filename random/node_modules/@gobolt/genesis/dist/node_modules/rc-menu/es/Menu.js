import zn from "../../@babel/runtime/helpers/esm/extends.js";
import Ee from "../../@babel/runtime/helpers/esm/defineProperty.js";
import Re from "../../@babel/runtime/helpers/esm/objectSpread2.js";
import Ln from "../../@babel/runtime/helpers/esm/toConsumableArray.js";
import a from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import Un from "../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import Hn from "../../../_virtual/index.js";
import V from "../../rc-overflow/es/Overflow.js";
import F from "../../rc-util/es/hooks/useMergedState.js";
import Wn from "../../rc-util/es/isEqual.js";
import { warningOnce as jn } from "../../rc-util/es/warning.js";
import * as t from "react";
import { useImperativeHandle as qn } from "react";
import { flushSync as Bn } from "react-dom";
import { IdContext as Gn } from "./context/IdContext.js";
import we from "./context/MenuContext.js";
import { PathUserContext as Yn, PathRegisterContext as Jn } from "./context/PathContext.js";
import Qn from "./context/PrivateContext.js";
import { refreshElements as Xn, getFocusableElements as Zn, useAccessibility as $n } from "./hooks/useAccessibility.js";
import et, { OVERFLOW_KEY as nt } from "./hooks/useKeyRecords.js";
import M from "./hooks/useMemoCallback.js";
import tt from "./hooks/useUUID.js";
import ot from "./MenuItem.js";
import rt from "./SubMenu/index.js";
import { parseItems as Oe } from "./utils/nodeUtil.js";
import { warnItemProp as it } from "./utils/warnUtil.js";
var at = ["prefixCls", "rootClassName", "style", "className", "tabIndex", "items", "children", "direction", "id", "mode", "inlineCollapsed", "disabled", "disabledOverflow", "subMenuOpenDelay", "subMenuCloseDelay", "forceSubMenuRender", "defaultOpenKeys", "openKeys", "activeKey", "defaultActiveFirst", "selectable", "multiple", "defaultSelectedKeys", "selectedKeys", "onSelect", "onDeselect", "inlineIndent", "motion", "defaultMotions", "triggerSubMenuAction", "builtinPlacements", "itemIcon", "expandIcon", "overflowedIndicator", "overflowedIndicatorPopupClassName", "getPopupContainer", "onClick", "onOpenChange", "onKeyDown", "openAnimation", "openTransitionName", "_internalRenderMenuItem", "_internalRenderSubMenuItem", "_internalComponents"], d = [], At = t.forwardRef(function(xe, Ne) {
  var K, e = xe, T = e.prefixCls, l = T === void 0 ? "rc-menu" : T, z = e.rootClassName, Ae = e.style, De = e.className, L = e.tabIndex, ke = L === void 0 ? 0 : L, P = e.items, S = e.children, U = e.direction, H = e.id, W = e.mode, p = W === void 0 ? "vertical" : W, E = e.inlineCollapsed, _e = e.disabled, R = e.disabledOverflow, j = e.subMenuOpenDelay, Ve = j === void 0 ? 0.1 : j, q = e.subMenuCloseDelay, Fe = q === void 0 ? 0.1 : q, Te = e.forceSubMenuRender, ze = e.defaultOpenKeys, Le = e.openKeys, B = e.activeKey, Ue = e.defaultActiveFirst, G = e.selectable, He = G === void 0 || G, Y = e.multiple, J = Y !== void 0 && Y, We = e.defaultSelectedKeys, je = e.selectedKeys, Q = e.onSelect, X = e.onDeselect, Z = e.inlineIndent, qe = Z === void 0 ? 24 : Z, Be = e.motion, Ge = e.defaultMotions, $ = e.triggerSubMenuAction, Ye = $ === void 0 ? "hover" : $, Je = e.builtinPlacements, Qe = e.itemIcon, Xe = e.expandIcon, ee = e.overflowedIndicator, Ze = ee === void 0 ? "..." : ee, $e = e.overflowedIndicatorPopupClassName, en = e.getPopupContainer, ne = e.onClick, te = e.onOpenChange, nn = e.onKeyDown, tn = e.openAnimation, on = e.openTransitionName, oe = e._internalRenderMenuItem, re = e._internalRenderSubMenuItem, ie = e._internalComponents, rn = Un(e, at), an = t.useMemo(function() {
    return [Oe(S, P, d, ie, l), Oe(S, P, d, {}, l)];
  }, [S, P, ie]), ae = a(an, 2), m = ae[0], ln = ae[1], un = t.useState(!1), le = a(un, 2), ue = le[0], sn = le[1], v = t.useRef(), w = tt(H), O = U === "rtl";
  process.env.NODE_ENV !== "production" && jn(!tn && !on, "`openAnimation` and `openTransitionName` is removed. Please use `motion` or `defaultMotion` instead.");
  var cn = F(ze, { value: Le, postState: function(n) {
    return n || d;
  } }), se = a(cn, 2), u = se[0], ce = se[1], x = function(n) {
    function o() {
      ce(n), te == null || te(n);
    }
    arguments.length > 1 && arguments[1] !== void 0 && arguments[1] ? Bn(o) : o();
  }, mn = t.useState(u), me = a(mn, 2), fn = me[0], dn = me[1], N = t.useRef(!1), pn = t.useMemo(function() {
    return p !== "inline" && p !== "vertical" || !E ? [p, !1] : ["vertical", E];
  }, [p, E]), fe = a(pn, 2), y = fe[0], A = fe[1], de = y === "inline", vn = t.useState(y), pe = a(vn, 2), s = pe[0], yn = pe[1], bn = t.useState(A), ve = a(bn, 2), gn = ve[0], Cn = ve[1];
  t.useEffect(function() {
    yn(y), Cn(A), N.current && (de ? ce(fn) : x(d));
  }, [y, A]);
  var In = t.useState(0), ye = a(In, 2), b = ye[0], hn = ye[1], D = b >= m.length - 1 || s !== "horizontal" || R;
  t.useEffect(function() {
    de && dn(u);
  }, [u]), t.useEffect(function() {
    return N.current = !0, function() {
      N.current = !1;
    };
  }, []);
  var f = et(), be = f.registerPath, ge = f.unregisterPath, Mn = f.refreshOverflowKeys, Ce = f.isSubPathKey, Kn = f.getKeyPath, Ie = f.getKeys, Pn = f.getSubPathKeys, Sn = t.useMemo(function() {
    return { registerPath: be, unregisterPath: ge };
  }, [be, ge]), En = t.useMemo(function() {
    return { isSubPathKey: Ce };
  }, [Ce]);
  t.useEffect(function() {
    Mn(D ? d : m.slice(b + 1).map(function(n) {
      return n.key;
    }));
  }, [b, D]);
  var Rn = F(B || Ue && ((K = m[0]) === null || K === void 0 ? void 0 : K.key), { value: B }), he = a(Rn, 2), g = he[0], k = he[1], wn = M(function(n) {
    k(n);
  }), On = M(function() {
    k(void 0);
  });
  qn(Ne, function() {
    return { list: v.current, focus: function(n) {
      var o, r, c = Ie(), i = Xn(c, w), I = i.elements, _ = i.key2element, Fn = i.element2key, Pe = Zn(v.current, I), Se = g ?? (Pe[0] ? Fn.get(Pe[0]) : (o = m.find(function(Tn) {
        return !Tn.props.disabled;
      })) === null || o === void 0 ? void 0 : o.key), h = _.get(Se);
      Se && h && (h == null || (r = h.focus) === null || r === void 0 || r.call(h, n));
    } };
  });
  var xn = F(We || [], { value: je, postState: function(n) {
    return Array.isArray(n) ? n : n == null ? d : [n];
  } }), Me = a(xn, 2), C = Me[0], Nn = Me[1], An = M(function(n) {
    ne == null || ne(it(n)), function(o) {
      if (He) {
        var r, c = o.key, i = C.includes(c);
        r = J ? i ? C.filter(function(_) {
          return _ !== c;
        }) : [].concat(Ln(C), [c]) : [c], Nn(r);
        var I = Re(Re({}, o), {}, { selectedKeys: r });
        i ? X == null || X(I) : Q == null || Q(I);
      }
      !J && u.length && s !== "inline" && x(d);
    }(n);
  }), Ke = M(function(n, o) {
    var r = u.filter(function(i) {
      return i !== n;
    });
    if (o) r.push(n);
    else if (s !== "inline") {
      var c = Pn(n);
      r = r.filter(function(i) {
        return !c.has(i);
      });
    }
    Wn(u, r, !0) || x(r, !0);
  }), Dn = $n(s, g, O, w, v, Ie, Kn, k, function(n, o) {
    var r = o ?? !u.includes(n);
    Ke(n, r);
  }, nn);
  t.useEffect(function() {
    sn(!0);
  }, []);
  var kn = t.useMemo(function() {
    return { _internalRenderMenuItem: oe, _internalRenderSubMenuItem: re };
  }, [oe, re]), _n = s !== "horizontal" || R ? m : m.map(function(n, o) {
    return t.createElement(we, { key: n.key, overflowDisabled: o > b }, n);
  }), Vn = t.createElement(V, zn({ id: H, ref: v, prefixCls: "".concat(l, "-overflow"), component: "ul", itemComponent: ot, className: Hn(l, "".concat(l, "-root"), "".concat(l, "-").concat(s), De, Ee(Ee({}, "".concat(l, "-inline-collapsed"), gn), "".concat(l, "-rtl"), O), z), dir: U, style: Ae, role: "menu", tabIndex: ke, data: _n, renderRawItem: function(n) {
    return n;
  }, renderRawRest: function(n) {
    var o = n.length, r = o ? m.slice(-o) : null;
    return t.createElement(rt, { eventKey: nt, title: Ze, disabled: D, internalPopupClose: o === 0, popupClassName: $e }, r);
  }, maxCount: s !== "horizontal" || R ? V.INVALIDATE : V.RESPONSIVE, ssr: "full", "data-menu-list": !0, onVisibleChange: function(n) {
    hn(n);
  }, onKeyDown: Dn }, rn));
  return t.createElement(Qn.Provider, { value: kn }, t.createElement(Gn.Provider, { value: w }, t.createElement(we, { prefixCls: l, rootClassName: z, mode: s, openKeys: u, rtl: O, disabled: _e, motion: ue ? Be : null, defaultMotions: ue ? Ge : null, activeKey: g, onActive: wn, onInactive: On, selectedKeys: C, inlineIndent: qe, subMenuOpenDelay: Ve, subMenuCloseDelay: Fe, forceSubMenuRender: Te, builtinPlacements: Je, triggerSubMenuAction: Ye, getPopupContainer: en, itemIcon: Qe, expandIcon: Xe, onItemClick: An, onOpenChange: Ke }, t.createElement(Yn.Provider, { value: En }, Vn), t.createElement("div", { style: { display: "none" }, "aria-hidden": !0 }, t.createElement(Jn.Provider, { value: Sn }, ln)))));
});
export {
  At as default
};
