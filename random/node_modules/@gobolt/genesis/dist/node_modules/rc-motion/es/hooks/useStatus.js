import Pr from "../../../@babel/runtime/helpers/esm/objectSpread2.js";
import a from "../../../@babel/runtime/helpers/esm/defineProperty.js";
import p from "../../../@babel/runtime/helpers/esm/slicedToArray.js";
import Rr from "../../../rc-util/es/hooks/useEvent.js";
import "../../../rc-util/es/hooks/useLayoutEffect.js";
import $ from "../../../rc-util/es/hooks/useState.js";
import "../../../rc-util/es/ref.js";
import "../../../rc-util/es/warning.js";
import _r from "../../../rc-util/es/hooks/useSyncState.js";
import * as D from "react";
import { useRef as T, useEffect as C } from "react";
import { STATUS_NONE as c, STATUS_APPEAR as P, STATUS_ENTER as R, STATUS_LEAVE as _, STEP_PREPARE as l, STEP_ACTIVE as L, STEP_PREPARED as Lr, STEP_START as g } from "../interface.js";
import gr from "./useDomMotionEvents.js";
import Ur from "./useIsomorphicLayoutEffect.js";
import hr, { SkipStep as Nr, DoStep as Vr, isActive as br } from "./useStepQueue.js";
function Jr(I, i, M, r) {
  var j = r.motionEnter, U = j === void 0 || j, k = r.motionAppear, h = k === void 0 || k, w = r.motionLeave, v = w === void 0 || w, x = r.motionDeadline, rr = r.motionLeaveImmediately, er = r.onAppearPrepare, nr = r.onEnterPrepare, tr = r.onLeavePrepare, or = r.onAppearStart, ir = r.onEnterStart, ar = r.onLeaveStart, ur = r.onAppearActive, mr = r.onEnterActive, cr = r.onLeaveActive, H = r.onAppearEnd, O = r.onEnterEnd, q = r.onLeaveEnd, y = r.onVisibleChanged, lr = $(), z = p(lr, 2), u = z[0], fr = z[1], pr = _r(c), B = p(pr, 2), F = B[0], s = B[1], vr = $(null), G = p(vr, 2), sr = G[0], J = G[1], t = F(), E = T(!1), N = T(null);
  function d() {
    return M();
  }
  var K = T(!1);
  function Q() {
    s(c), J(null, !0);
  }
  var W = Rr(function(e) {
    var n = F();
    if (n !== c) {
      var o = d();
      if (!e || e.deadline || e.target === o) {
        var S, A = K.current;
        n === P && A ? S = H == null ? void 0 : H(o, e) : n === R && A ? S = O == null ? void 0 : O(o, e) : n === _ && A && (S = q == null ? void 0 : q(o, e)), A && S !== !1 && Q();
      }
    }
  }), Er = gr(W), dr = p(Er, 1)[0], X = function(e) {
    switch (e) {
      case P:
        return a(a(a({}, l, er), g, or), L, ur);
      case R:
        return a(a(a({}, l, nr), g, ir), L, mr);
      case _:
        return a(a(a({}, l, tr), g, ar), L, cr);
      default:
        return {};
    }
  }, f = D.useMemo(function() {
    return X(t);
  }, [t]), Sr = hr(t, !I, function(e) {
    if (e === l) {
      var n = f[l];
      return n ? n(d()) : Nr;
    }
    var o;
    return m in f && J(((o = f[m]) === null || o === void 0 ? void 0 : o.call(f, d(), null)) || null), m === L && t !== c && (dr(d()), x > 0 && (clearTimeout(N.current), N.current = setTimeout(function() {
      W({ deadline: !0 });
    }, x))), m === Lr && Q(), Vr;
  }), Y = p(Sr, 2), Ar = Y[0], m = Y[1], Tr = br(m);
  K.current = Tr;
  var Z = T(null);
  Ur(function() {
    if (!E.current || Z.current !== i) {
      fr(i);
      var e, n = E.current;
      E.current = !0, !n && i && h && (e = P), n && i && U && (e = R), (n && !i && v || !n && rr && !i && v) && (e = _);
      var o = X(e);
      e && (I || o[l]) ? (s(e), Ar()) : s(c), Z.current = i;
    }
  }, [i]), C(function() {
    (t === P && !h || t === R && !U || t === _ && !v) && s(c);
  }, [h, U, v]), C(function() {
    return function() {
      E.current = !1, clearTimeout(N.current);
    };
  }, []);
  var V = D.useRef(!1);
  C(function() {
    u && (V.current = !0), u !== void 0 && t === c && ((V.current || u) && (y == null || y(u)), V.current = !0);
  }, [u, t]);
  var b = sr;
  return f[l] && m === g && (b = Pr({ transition: "none" }, b)), [t, m, b, u ?? i];
}
export {
  Jr as default
};
