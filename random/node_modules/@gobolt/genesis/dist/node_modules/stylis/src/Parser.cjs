"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const D=require("./Enum.cjs"),e=require("./Utility.cjs"),r=require("./Tokenizer.cjs");function N(c,p,u,s,l,y,R,o,m){for(var M=0,f=0,n=R,C=0,O=0,k=0,i=1,L=1,d=1,t=0,S="",A=l,h=y,b=s,a=S;L;)switch(k=t,t=r.next()){case 40:if(k!=108&&e.charat(a,n-1)==58){e.indexof(a+=e.replace(r.delimit(t),"&","&\f"),"&\f",e.abs(M?o[M-1]:0))!=-1&&(d=-1);break}case 34:case 39:case 91:a+=r.delimit(t);break;case 9:case 10:case 13:case 32:a+=r.whitespace(k);break;case 92:a+=r.escaping(r.caret()-1,7);continue;case 47:switch(r.peek()){case 42:case 47:e.append(I(r.commenter(r.next(),r.caret()),p,u,m),m),r.token(k||1)!=5&&r.token(r.peek()||1)!=5||!e.strlen(a)||e.substr(a,-1,void 0)===" "||(a+=" ");break;default:a+="/"}break;case 123*i:o[M++]=e.strlen(a)*d;case 125*i:case 59:case 0:switch(t){case 0:case 125:L=0;case 59+f:d==-1&&(a=e.replace(a,/\f/g,"")),O>0&&(e.strlen(a)-n||i===0&&k===47)&&e.append(O>32?z(a+";",s,u,n-1,m):z(e.replace(a," ","")+";",s,u,n-2,m),m);break;case 59:a+=";";default:if(e.append(b=x(a,p,u,M,f,l,o,S,A=[],h=[],n,y),y),t===123)if(f===0)N(a,p,b,b,A,y,n,o,h);else{switch(C){case 99:if(e.charat(a,3)===110)break;case 108:if(e.charat(a,2)===97)break;default:f=0;case 100:case 109:case 115:}f?N(c,b,b,s&&e.append(x(c,b,b,0,0,l,o,S,l,A=[],n,h),h),l,h,n,o,s?A:h):N(a,b,b,b,[""],h,0,o,h)}}M=f=O=0,i=d=1,S=a="",n=R;break;case 58:n=1+e.strlen(a),O=k;default:if(i<1){if(t==123)--i;else if(t==125&&i++==0&&r.prev()==125)continue}switch(a+=e.from(t),t*i){case 38:d=f>0?1:(a+="\f",-1);break;case 44:o[M++]=(e.strlen(a)-1)*d,d=1;break;case 64:r.peek()===45&&(a+=r.delimit(r.next())),C=r.peek(),f=n=e.strlen(S=a+=r.identifier(r.caret())),t++;break;case 45:k===45&&e.strlen(a)==2&&(i=0)}}return y}function x(c,p,u,s,l,y,R,o,m,M,f,n){for(var C=l-1,O=l===0?y:[""],k=e.sizeof(O),i=0,L=0,d=0;i<s;++i)for(var t=0,S=e.substr(c,C+1,C=e.abs(L=R[i])),A=c;t<k;++t)(A=e.trim(L>0?O[t]+" "+S:e.replace(S,/&\f/g,O[t])))&&(m[d++]=A);return r.node(c,p,u,l===0?D.RULESET:o,m,M,f,n)}function I(c,p,u,s){return r.node(c,p,u,D.COMMENT,e.from(r.char()),e.substr(c,2,-2),0,s)}function z(c,p,u,s,l){return r.node(c,p,u,D.DECLARATION,e.substr(c,0,s),e.substr(c,s+1,-1),s,l)}exports.comment=I,exports.compile=function(c){return r.dealloc(N("",null,null,null,[""],c=r.alloc(c),0,[0],c))},exports.declaration=z,exports.parse=N,exports.ruleset=x;
