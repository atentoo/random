import j from "../../../@babel/runtime/helpers/esm/extends.js";
import pe from "../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import c from "../../../@babel/runtime/helpers/esm/objectSpread2.js";
import u from "../../../@babel/runtime/helpers/esm/slicedToArray.js";
import dn from "../../../rc-util/es/hooks/useEvent.js";
import vn from "../../../rc-util/es/hooks/useMergedState.js";
import "../../../rc-util/es/ref.js";
import "../../../rc-util/es/warning.js";
import se from "../../../rc-util/es/hooks/useLayoutEffect.js";
import Cn from "../../../rc-util/es/omit.js";
import gn from "../../../rc-util/es/pickAttrs.js";
import * as r from "react";
import hn from "../hooks/useToggleDates.js";
import kn from "../PickerTrigger/index.js";
import { pickTriggerProps as Pn } from "../PickerTrigger/util.js";
import { toArray as bn } from "../utils/miscUtil.js";
import yn from "./context.js";
import On from "./hooks/useCellRender.js";
import wn from "./hooks/useFieldsInvalidate.js";
import Vn from "./hooks/useFilledProps.js";
import Sn from "./hooks/useOpen.js";
import En from "./hooks/usePickerRef.js";
import Nn from "./hooks/usePresets.js";
import Rn from "./hooks/useRangeActive.js";
import In from "./hooks/useRangePickerValue.js";
import Dn, { useInnerValue as xn } from "./hooks/useRangeValue.js";
import Mn from "./hooks/useShowNow.js";
import Fn from "./Popup/index.js";
import Tn from "./Selector/SingleSelector/index.js";
function Bn(de, ve) {
  var Ce = Vn(de), p = u(Ce, 6), m = p[0], O = p[1], K = p[2], R = p[3], A = p[4], I = p[5], n = m, _ = n.prefixCls, ge = n.styles, he = n.classNames, ke = n.order, Pe = n.defaultValue, be = n.value, D = n.needConfirm, q = n.onChange, z = n.onKeyDown, w = n.disabled, ye = n.disabledDate, Oe = n.minDate, we = n.maxDate, Ve = n.defaultOpen, Se = n.open, Ee = n.onOpenChange, g = n.locale, h = n.generateConfig, s = n.picker, Ne = n.showNow, Re = n.showToday, d = n.showTime, Ie = n.mode, G = n.onPanelChange, J = n.onCalendarChange, L = n.onOk, l = n.multiple, De = n.defaultPickerValue, xe = n.pickerValue, Q = n.onPickerValueChange, Me = n.inputReadOnly, Fe = n.suffixIcon, Te = n.removeIcon, U = n.onFocus, W = n.onBlur, Be = n.presets, V = n.components, He = n.cellRender, je = n.dateRender, Ke = n.monthCellRender, X = n.onClick, x = En(ve);
  function k(e) {
    return e === null ? null : l ? e : e[0];
  }
  var Y = hn(h, g, O), Ae = Sn(Se, Ve, [w], Ee), Z = u(Ae, 2), t = Z[0], i = Z[1], _e = xn(h, g, R, !1, ke, Pe, be, function(e, o, C) {
    if (J) {
      var N = c({}, C);
      delete N.range, J(k(e), k(o), N);
    }
  }, function(e) {
    L == null || L(k(e));
  }), P = u(_e, 5), qe = P[0], ze = P[1], b = P[2], M = P[3], Ge = P[4], a = b(), Je = Rn([w]), S = u(Je, 4), $ = S[0], ee = S[1], E = S[2], F = S[3], ne = function(e) {
    ee(!0), U == null || U(e, {});
  }, oe = function(e) {
    ee(!1), W == null || W(e, {});
  }, Le = vn(s, { value: Ie }), re = u(Le, 2), y = re[0], Qe = re[1], T = y === "date" && d ? "datetime" : y, Ue = Mn(s, y, Ne, Re), We = q && function(e, o) {
    q(k(e), k(o));
  }, Xe = Dn(c(c({}, m), {}, { onChange: We }), qe, ze, b, M, [], R, $, t, I), B = u(Xe, 2)[1], Ye = wn(a, I), te = u(Ye, 2), ie = te[0], Ze = te[1], $e = r.useMemo(function() {
    return ie.some(function(e) {
      return e;
    });
  }, [ie]), en = In(h, g, a, [y], t, F, O, !1, De, xe, bn(d == null ? void 0 : d.defaultOpenValue), function(e, o) {
    if (Q) {
      var C = c(c({}, o), {}, { mode: o.mode[0] });
      delete C.range, Q(e[0], C);
    }
  }, Oe, we), ue = u(en, 2), nn = ue[0], on = ue[1], le = dn(function(e, o, C) {
    if (Qe(o), G && C !== !1) {
      var N = e || a[a.length - 1];
      G(N, o);
    }
  }), v = function() {
    B(b()), i(!1, { force: !0 });
  }, rn = r.useState(null), ae = u(rn, 2), tn = ae[0], me = ae[1], un = r.useState(null), fe = u(un, 2), f = fe[0], H = fe[1], ln = r.useMemo(function() {
    var e = [f].concat(pe(a)).filter(function(o) {
      return o;
    });
    return l ? e : e.slice(0, 1);
  }, [a, f, l]), an = r.useMemo(function() {
    return !l && f ? [f] : a.filter(function(e) {
      return e;
    });
  }, [a, f, l]);
  r.useEffect(function() {
    t || H(null);
  }, [t]);
  var mn = Nn(Be), ce = function(e) {
    var o = l ? Y(b(), e) : [e];
    B(o) && !l && i(!1, { force: !0 });
  }, fn = On(He, je, Ke), cn = r.useMemo(function() {
    var e = gn(m, !1), o = Cn(m, [].concat(pe(Object.keys(e)), ["onChange", "onCalendarChange", "style", "className", "onPanelChange"]));
    return c(c({}, o), {}, { multiple: m.multiple });
  }, [m]), pn = r.createElement(Fn, j({}, cn, { showNow: Ue, showTime: d, disabledDate: ye, onFocus: function(e) {
    i(!0), ne(e);
  }, onBlur: oe, picker: s, mode: y, internalMode: T, onPanelChange: le, format: A, value: a, isInvalid: I, onChange: null, onSelect: function(e) {
    if (E("panel"), !l || T === s) {
      var o = l ? Y(b(), e) : [e];
      M(o), D || K || O !== T || v();
    }
  }, pickerValue: nn, defaultOpenValue: d == null ? void 0 : d.defaultOpenValue, onPickerValueChange: on, hoverValue: ln, onHover: function(e) {
    H(e), me("cell");
  }, needConfirm: D, onSubmit: v, onOk: Ge, presets: mn, onPresetHover: function(e) {
    H(e), me("preset");
  }, onPresetSubmit: ce, onNow: function(e) {
    ce(e);
  }, cellRender: fn })), sn = r.useMemo(function() {
    return { prefixCls: _, locale: g, generateConfig: h, button: V.button, input: V.input };
  }, [_, g, h, V.button, V.input]);
  return se(function() {
    t && F !== void 0 && le(null, s, !1);
  }, [t, F, s]), se(function() {
    var e = E();
    t || e !== "input" || (i(!1), v()), t || !K || D || e !== "panel" || v();
  }, [t]), r.createElement(yn.Provider, { value: sn }, r.createElement(kn, j({}, Pn(m), { popupElement: pn, popupStyle: ge.popup, popupClassName: he.popup, visible: t, onClose: function() {
    i(!1);
  } }), r.createElement(Tn, j({}, m, { ref: x, suffixIcon: Fe, removeIcon: Te, activeHelp: !!f, allHelp: !!f && tn === "preset", focused: $, onFocus: function(e) {
    E("input"), i(!0, { inherit: !0 }), ne(e);
  }, onBlur: function(e) {
    i(!1), oe(e);
  }, onKeyDown: function(e, o) {
    e.key === "Tab" && v(), z == null || z(e, o);
  }, onSubmit: v, value: an, maskFormat: A, onChange: function(e) {
    M(e);
  }, onInputChange: function() {
    E("input");
  }, internalPicker: O, format: R, inputReadOnly: Me, disabled: w, open: t, onOpenChange: i, onClick: function(e) {
    w || x.current.nativeElement.contains(document.activeElement) || x.current.focus(), i(!0), X == null || X(e);
  }, onClear: function() {
    B(null), i(!1, { force: !0 });
  }, invalid: $e, onInvalid: function(e) {
    Ze(e, 0);
  } }))));
}
var Hn = r.forwardRef(Bn);
process.env.NODE_ENV !== "production" && (Hn.displayName = "RefPicker");
export {
  Hn as default
};
