"use strict";const J=require("../../../@babel/runtime/helpers/esm/extends.cjs"),be=require("../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),ye=require("../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),d=require("../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),Oe=require("../../../rc-util/es/hooks/useEvent.cjs"),Dn=require("../../../rc-util/es/hooks/useMergedState.cjs");require("../../../rc-util/es/ref.cjs");const Rn=require("../../../rc-util/es/warning.cjs"),we=require("../../../rc-util/es/hooks/useLayoutEffect.cjs"),Sn=require("../../../rc-util/es/omit.cjs"),Tn=require("../../../rc-util/es/pickAttrs.cjs"),Mn=require("react"),jn=require("../PickerTrigger/index.cjs"),An=require("../PickerTrigger/util.cjs"),V=require("../utils/miscUtil.cjs"),Fn=require("./context.cjs"),Bn=require("./hooks/useCellRender.cjs"),Hn=require("./hooks/useFieldsInvalidate.cjs"),_n=require("./hooks/useFilledProps.cjs"),Kn=require("./hooks/useOpen.cjs"),zn=require("./hooks/usePickerRef.cjs"),Yn=require("./hooks/usePresets.cjs"),Gn=require("./hooks/useRangeActive.cjs"),Jn=require("./hooks/useRangeDisabledDate.cjs"),Ln=require("./hooks/useRangePickerValue.cjs"),ke=require("./hooks/useRangeValue.cjs"),Qn=require("./hooks/useShowNow.cjs"),Un=require("./Popup/index.cjs"),Wn=require("./Selector/RangeSelector.cjs");function Xn(l){const q=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const f in l)if(f!=="default"){const p=Object.getOwnPropertyDescriptor(l,f);Object.defineProperty(q,f,p.get?p:{enumerable:!0,get:()=>l[f]})}}return q.default=l,Object.freeze(q)}const c=Xn(Mn);function Ee(l,q){var f=l??q;return Array.isArray(f)?f:[f,f]}function A(l){return l===1?"end":"start"}function Zn(l,q){var f=_n(l,function(){var e=l.disabled,r=l.allowEmpty;return{disabled:Ee(e,!1),allowEmpty:Ee(r,!1)}}),p=d(f,6),n=p[0],L=p[1],F=p[2],B=p[3],Q=p[4],H=p[5],U=n.prefixCls,xe=n.styles,Ie=n.classNames,_=n.defaultValue,K=n.value,h=n.needConfirm,W=n.onKeyDown,v=n.disabled,N=n.allowEmpty,Ve=n.disabledDate,Ne=n.minDate,De=n.maxDate,Re=n.defaultOpen,Se=n.open,Te=n.onOpenChange,O=n.locale,w=n.generateConfig,g=n.picker,Me=n.showNow,je=n.showToday,b=n.showTime,Ae=n.mode,X=n.onPanelChange,Fe=n.onCalendarChange,Be=n.onOk,He=n.defaultPickerValue,_e=n.pickerValue,Ke=n.onPickerValueChange,ze=n.inputReadOnly,Ye=n.suffixIcon,Z=n.onFocus,$=n.onBlur,Ge=n.presets,Je=n.ranges,D=n.components,Le=n.cellRender,Qe=n.dateRender,Ue=n.monthCellRender,ee=n.onClick,k=zn(q),We=Kn(Se,Re,v,Te),ne=d(We,2),i=ne[0],Xe=ne[1],s=function(e,r){!v.some(function(t){return!t})&&e||Xe(e,r)},Ze=ke.useInnerValue(w,O,B,!0,!1,_,K,Fe,Be),E=d(Ze,5),$e=E[0],en=E[1],re=E[2],R=E[3],nn=E[4],a=re(),rn=Gn(v,N,i),m=d(rn,9),z=m[0],ue=m[1],P=m[2],u=m[3],un=m[4],te=m[5],x=m[6],tn=m[7],on=m[8],oe=function(e,r){ue(!0),Z==null||Z(e,{range:A(r??u)})},le=function(e,r){ue(!1),$==null||$(e,{range:A(r??u)})},S=c.useMemo(function(){if(!b)return null;var e=b.disabledTime,r=e?function(t){var o=A(u),y=V.getFromDate(a,x,u);return e(t,o,{from:y})}:void 0;return ye(ye({},b),{},{disabledTime:r})},[b,u,a,x]),ln=Dn([g,g],{value:Ae}),ie=d(ln,2),I=ie[0],an=ie[1],T=I[u]||g,M=T==="date"&&S?"datetime":T,ae=M===g&&M!=="time",cn=Qn(g,T,Me,je,!0),fn=ke.default(n,$e,en,re,R,v,B,z,i,H),ce=d(fn,2),fe=ce[0],se=ce[1],sn=Jn(a,v,x,w,O,Ve),dn=Hn(a,H,N),de=d(dn,2),pn=de[0],mn=de[1],vn=Ln.default(w,O,a,I,i,u,L,ae,He,_e,S==null?void 0:S.defaultOpenValue,Ke,Ne,De),pe=d(vn,2),gn=pe[0],Cn=pe[1],me=Oe(function(e,r,t){var o=V.fillIndex(I,u,r);if(o[0]===I[0]&&o[1]===I[1]||an(o),X&&t!==!1){var y=be(a);e&&(y[u]=e),X(y,o)}}),Y=function(e,r){return V.fillIndex(a,r,e)},C=function(e,r){var t=a;e&&(t=Y(e,u)),tn(u);var o=te(t);R(t),fe(u,o===null),o===null?s(!1,{force:!0}):r||k.current.focus({index:o})},qn=c.useState(null),ve=d(qn,2),hn=ve[0],ge=ve[1],bn=c.useState(null),Ce=d(bn,2),j=Ce[0],G=Ce[1],qe=c.useMemo(function(){return j||a},[a,j]);c.useEffect(function(){i||G(null)},[i]);var yn=c.useState([0,0,0]),he=d(yn,2),On=he[0],wn=he[1],kn=Yn(Ge,Je),En=Bn(Le,Qe,Ue,A(u)),Pn=a[u]||null,xn=Oe(function(e){return H(e,{activeIndex:u})}),In=c.useMemo(function(){var e=Tn(n,!1);return Sn(n,[].concat(be(Object.keys(e)),["onChange","onCalendarChange","style","className","onPanelChange","disabledTime"]))},[n]),Vn=c.createElement(Un,J({},In,{showNow:cn,showTime:S,range:!0,multiplePanel:ae,activeInfo:On,disabledDate:sn,onFocus:function(e){s(!0),oe(e)},onBlur:le,onPanelMouseDown:function(){P("panel")},picker:g,mode:T,internalMode:M,onPanelChange:me,format:Q,value:Pn,isInvalid:xn,onChange:null,onSelect:function(e){var r=V.fillIndex(a,u,e);R(r),h||F||L!==M||C(e)},pickerValue:gn,defaultOpenValue:V.toArray(b==null?void 0:b.defaultOpenValue)[u],onPickerValueChange:Cn,hoverValue:qe,onHover:function(e){G(e?Y(e,u):null),ge("cell")},needConfirm:h,onSubmit:C,onOk:nn,presets:kn,onPresetHover:function(e){G(e),ge("preset")},onPresetSubmit:function(e){se(e)&&s(!1,{force:!0})},onNow:function(e){C(e)},cellRender:En})),Nn=c.useMemo(function(){return{prefixCls:U,locale:O,generateConfig:w,button:D.button,input:D.input}},[U,O,w,D.button,D.input]);return we.default(function(){i&&u!==void 0&&me(null,g,!1)},[i,u,g]),we.default(function(){var e=P();i||e!=="input"||(s(!1),C(null,!0)),i||!F||h||e!=="panel"||(s(!0),C())},[i]),process.env.NODE_ENV!=="production"&&v.some(function(e,r){return e&&function(t){return!(K!=null&&K[t]||_!=null&&_[t])}(r)&&!N[r]})&&Rn.warningOnce(!1,"`disabled` should not set with empty `value`. You should set `allowEmpty` or `value` instead."),c.createElement(Fn.Provider,{value:Nn},c.createElement(jn,J({},An.pickTriggerProps(n),{popupElement:Vn,popupStyle:xe.popup,popupClassName:Ie.popup,visible:i,onClose:function(){s(!1)},range:!0}),c.createElement(Wn,J({},n,{ref:k,suffixIcon:Ye,activeIndex:z||i?u:null,activeHelp:!!j,allHelp:!!j&&hn==="preset",focused:z,onFocus:function(e,r){var t=x.length,o=x[t-1];t&&o!==r&&h&&!N[o]&&!on(o)&&a[o]?k.current.focus({index:o}):(P("input"),s(!0,{inherit:!0}),u!==r&&i&&!h&&F&&C(null,!0),un(r),oe(e,r))},onBlur:function(e,r){if(s(!1),!h&&P()==="input"){var t=te(a);fe(u,t===null)}le(e,r)},onKeyDown:function(e,r){e.key==="Tab"&&C(null,!0),W==null||W(e,r)},onSubmit:C,value:qe,maskFormat:Q,onChange:function(e,r){var t=Y(e,r);R(t)},onInputChange:function(){P("input")},format:B,inputReadOnly:ze,disabled:v,open:i,onOpenChange:s,onClick:function(e){var r,t=e.target.getRootNode();if(!k.current.nativeElement.contains((r=t.activeElement)!==null&&r!==void 0?r:document.activeElement)){var o=v.findIndex(function(y){return!y});o>=0&&k.current.focus({index:o})}s(!0),ee==null||ee(e)},onClear:function(){se(null),s(!1,{force:!0})},invalid:pn,onInvalid:mn,onActiveInfo:wn}))))}var Pe=c.forwardRef(Zn);process.env.NODE_ENV!=="production"&&(Pe.displayName="RefRangePicker"),module.exports=Pe;
