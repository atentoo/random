"use strict";const Re=require("../../../../@babel/runtime/helpers/esm/extends.cjs"),re=require("../../../../@babel/runtime/helpers/esm/defineProperty.cjs"),s=require("../../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),Oe=require("../../../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),Be=require("../../../../../_virtual/index.cjs"),Ae=require("../../../../rc-util/es/hooks/useEvent.cjs"),je=require("../../../../rc-util/es/hooks/useLayoutEffect.cjs"),Ke=require("react");require("../../../../rc-util/es/ref.cjs"),require("../../../../rc-util/es/warning.cjs");const ue=require("../../../../rc-util/es/raf.cjs"),Fe=require("../../utils/miscUtil.cjs"),Pe=require("../context.cjs"),He=require("../hooks/useLockEffect.cjs"),Ue=require("./Icon.cjs"),ze=require("./MaskFormat.cjs"),Ve=require("./util.cjs");function _e(n){const m=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const a in n)if(a!=="default"){const g=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(m,a,g.get?g:{enumerable:!0,get:()=>n[a]})}}return m.default=n,Object.freeze(m)}const t=_e(Ke);var Le=["active","showActiveCls","suffixIcon","format","validateFormat","onChange","onInput","helped","onHelp","onSubmit","onKeyDown","preserveInvalidOnBlur","invalid","clearIcon"],oe=t.forwardRef(function(n,m){var a=n.active,g=n.showActiveCls,ae=g===void 0||g,ce=n.suffixIcon,o=n.format,y=n.validateFormat,R=n.onChange;n.onInput;var D=n.helped,ie=n.onHelp,le=n.onSubmit,O=n.onKeyDown,B=n.preserveInvalidOnBlur,fe=B!==void 0&&B,se=n.invalid,ve=n.clearIcon,de=Oe(n,Le),b=n.value,pe=n.onFocus,me=n.onBlur,A=n.onMouseUp,j=t.useContext(Pe),ge=j.prefixCls,K=j.input,be=K===void 0?"input":K,I="".concat(ge,"-input"),he=t.useState(!1),F=s(he,2),P=F[0],H=F[1],qe=t.useState(b),U=s(qe,2),we=U[0],h=U[1],Se=t.useState(""),z=s(Se,2),ye=z[0],C=z[1],De=t.useState(null),V=s(De,2),M=V[0],N=V[1],Ie=t.useState(null),_=s(Ie,2),Ce=_[0],L=_[1],i=we||"";t.useEffect(function(){h(b)},[b]);var T=t.useRef(),v=t.useRef();t.useImperativeHandle(m,function(){return{nativeElement:T.current,inputElement:v.current,focus:function(e){v.current.focus(e)},blur:function(){v.current.blur()}}});var d=t.useMemo(function(){return new ze(o||"")},[o]),Me=t.useMemo(function(){return D?[0,0]:d.getSelection(M)},[d,M,D]),G=s(Me,2),l=G[0],f=G[1],J=function(e){e&&e!==o&&e!==b&&ie()},q=Ae(function(e){y(e)&&R(e),h(e),J(e)}),k=t.useRef(!1),Q=function(e){me(e)};He(a,function(){a||fe||h(b)});var W=function(e){e.key==="Enter"&&y(i)&&le(),O==null||O(e)},X=t.useRef();je.default(function(){if(P&&o&&!k.current){if(d.match(i))return v.current.setSelectionRange(l,f),X.current=ue(function(){v.current.setSelectionRange(l,f)}),function(){ue.cancel(X.current)};q(o)}},[d,o,P,i,M,l,f,Ce,q]);var Ne=o?{onFocus:function(e){H(!0),N(0),C(""),pe(e)},onBlur:function(e){H(!1),Q(e)},onKeyDown:function(e){W(e);var r=e.key,u=null,p=null,Y=f-l,Z=o.slice(l,f),x=function(w){N(function(E){var c=E+w;return c=Math.max(c,0),c=Math.min(c,d.size()-1)})},$=function(w){var E=Ve.getMaskRange(Z),c=s(E,3),S=c[0],ee=c[1],xe=c[2],Ee=i.slice(l,f),ne=Number(Ee);if(isNaN(ne))return String(xe||(w>0?S:ee));var te=ee-S+1;return String(S+(te+(ne+w)-S)%te)};switch(r){case"Backspace":case"Delete":u="",p=Z;break;case"ArrowLeft":u="",x(-1);break;case"ArrowRight":u="",x(1);break;case"ArrowUp":u="",p=$(1);break;case"ArrowDown":u="",p=$(-1);break;default:isNaN(Number(r))||(p=u=ye+r)}if(u!==null&&(C(u),u.length>=Y&&(x(1),C(""))),p!==null){var ke=i.slice(0,l)+Fe.leftPad(p,Y)+i.slice(f);q(ke.slice(0,o.length))}L({})},onMouseDown:function(){k.current=!0},onMouseUp:function(e){var r=e.target.selectionStart,u=d.getMaskCellIndex(r);N(u),L({}),A==null||A(e),k.current=!1},onPaste:function(e){var r=e.clipboardData.getData("text");y(r)&&q(r)}}:{};return t.createElement("div",{ref:T,className:Be(I,re(re({},"".concat(I,"-active"),a&&ae),"".concat(I,"-placeholder"),D))},t.createElement(be,Re({ref:v,"aria-invalid":se,autoComplete:"off"},de,{onKeyDown:W,onBlur:Q},Ne,{value:i,onChange:function(e){if(!o){var r=e.target.value;J(r),h(r),R(r)}}})),t.createElement(Ue.default,{type:"suffix",icon:ce}),ve)});process.env.NODE_ENV!=="production"&&(oe.displayName="Input"),module.exports=oe;
