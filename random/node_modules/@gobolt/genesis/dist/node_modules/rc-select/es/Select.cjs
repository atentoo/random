"use strict";const ot=require("../../@babel/runtime/helpers/esm/extends.cjs"),d=require("../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),we=require("../../@babel/runtime/helpers/esm/defineProperty.cjs"),S=require("../../@babel/runtime/helpers/esm/objectSpread2.cjs"),m=require("../../@babel/runtime/helpers/esm/slicedToArray.cjs"),it=require("../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),lt=require("../../@babel/runtime/helpers/esm/typeof.cjs"),Ae=require("../../rc-util/es/hooks/useMergedState.cjs"),ut=require("../../rc-util/es/warning.cjs"),at=require("react"),U=require("./BaseSelect/index.cjs"),st=require("./OptGroup.cjs"),ct=require("./Option.cjs"),vt=require("./OptionList.cjs"),ft=require("./SelectContext.cjs"),dt=require("./hooks/useCache.cjs"),pt=require("./hooks/useFilterOptions.cjs"),mt=require("./hooks/useId.cjs"),bt=require("./hooks/useOptions.cjs"),Pe=require("./hooks/useRefFunc.cjs"),X=require("./utils/commonUtil.cjs"),R=require("./utils/valueUtil.cjs"),je=require("./utils/warningPropsUtil.cjs");function ht(r){const O=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const b in r)if(b!=="default"){const i=Object.getOwnPropertyDescriptor(r,b);Object.defineProperty(O,b,i.get?i:{enumerable:!0,get:()=>r[b]})}}return O.default=r,Object.freeze(O)}const u=ht(at);var gt=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","optionRender","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","direction","listHeight","listItemHeight","labelRender","value","defaultValue","labelInValue","onChange","maxCount"],St=["inputValue"],Fe=u.forwardRef(function(r,O){var b=r.id,i=r.mode,Z=r.prefixCls,He=Z===void 0?"rc-select":Z,$=r.backfill,ee=r.fieldNames,Re=r.inputValue,te=r.searchValue,ne=r.onSearch,re=r.autoClearSearchValue,oe=re===void 0||re,ie=r.onSelect,le=r.onDeselect,ue=r.dropdownMatchSelectWidth,_=ue===void 0||ue,W=r.filterOption,L=r.filterSort,k=r.optionFilterProp,D=r.optionLabelProp,ae=r.options,se=r.optionRender,ce=r.children,ve=r.defaultActiveFirstOption,fe=r.menuItemSelectedIcon,de=r.virtual,z=r.direction,pe=r.listHeight,me=pe===void 0?200:pe,be=r.listItemHeight,he=be===void 0?20:be,G=r.labelRender,_e=r.value,We=r.defaultValue,ge=r.labelInValue,Se=r.onChange,Oe=r.maxCount,Le=it(r,gt),Ve=mt.default(b),h=U.isMultiple(i),g=!(ae||!ce),ze=u.useMemo(function(){return(W!==void 0||i!=="combobox")&&W},[W,i]),a=u.useMemo(function(){return R.fillFieldNames(ee,g)},[JSON.stringify(ee),g]),Ge=Ae("",{value:te!==void 0?te:Re,postState:function(e){return e||""}}),qe=m(Ge,2),v=qe[0],I=qe[1],V=bt(ae,ce,a,k,D),q=V.valueOptions,Je=V.labelOptions,w=V.options,J=u.useCallback(function(e){return X.toArray(e).map(function(t){var n,o,l,p,f,M;(function(H){return!H||lt(H)!=="object"})(t)?n=t:(l=t.key,o=t.label,n=(M=t.value)!==null&&M!==void 0?M:l);var N,c=q.get(n);if(c&&(o===void 0&&(o=c==null?void 0:c[D||a.label]),l===void 0&&(l=(N=c==null?void 0:c.key)!==null&&N!==void 0?N:n),p=c==null?void 0:c.disabled,f=c==null?void 0:c.title,process.env.NODE_ENV!=="production"&&!D)){var x=c==null?void 0:c[a.label];x===void 0||u.isValidElement(x)||u.isValidElement(o)||x===o||ut.warningOnce(!1,"`label` of `value` is not same as `label` in Select options.")}return{label:o,value:n,key:l,disabled:p,title:f}})},[a,D,q]),Te=Ae(We,{value:_e}),ye=m(Te,2),T=ye[0],Be=ye[1],Ke=u.useMemo(function(){var e,t=J(h&&T===null?[]:T);return i==="combobox"&&X.isComboNoValue((e=t[0])===null||e===void 0?void 0:e.value)?[]:t},[T,J,i,h]),Qe=dt(Ke,q),Ce=m(Qe,2),s=Ce[0],Me=Ce[1],Ue=u.useMemo(function(){if(!i&&s.length===1){var e=s[0];if(e.value===null&&(e.label===null||e.label===void 0))return[]}return s.map(function(t){var n;return S(S({},t),{},{label:(n=typeof G=="function"?G(t):t.label)!==null&&n!==void 0?n:t.value})})},[i,s,G]),A=u.useMemo(function(){return new Set(s.map(function(e){return e.value}))},[s]);u.useEffect(function(){if(i==="combobox"){var e,t=(e=s[0])===null||e===void 0?void 0:e.value;I(X.hasValue(t)?String(t):"")}},[s]);var P=Pe(function(e,t){var n=t??e;return we(we({},a.value,e),a.label,n)}),Xe=u.useMemo(function(){if(i!=="tags")return w;var e=d(w);return d(s).sort(function(t,n){return t.value<n.value?-1:1}).forEach(function(t){var n=t.value;(function(o){return q.has(o)})(n)||e.push(P(n,t.label))}),e},[P,w,q,s,i]),y=pt(Xe,a,v,ze,k),B=u.useMemo(function(){return i!=="tags"||!v||y.some(function(e){return e[k||"value"]===v})||y.some(function(e){return e[a.value]===v})?y:[P(v)].concat(d(y))},[P,k,i,y,v,a]),Ye=function e(t){return d(t).sort(function(n,o){return L(n,o,{searchValue:v})}).map(function(n){return Array.isArray(n.options)?S(S({},n),{},{options:n.options.length>0?e(n.options):n.options}):n})},Ne=u.useMemo(function(){return L?Ye(B):B},[B,L,v]),K=u.useMemo(function(){return R.flattenOptions(Ne,{fieldNames:a,childrenAsData:g})},[Ne,a,g]),C=function(e){var t=J(e);if(Be(t),Se&&(t.length!==s.length||t.some(function(l,p){var f;return((f=s[p])===null||f===void 0?void 0:f.value)!==(l==null?void 0:l.value)}))){var n=ge?t:t.map(function(l){return l.value}),o=t.map(function(l){return R.injectPropsWithOption(Me(l.value))});Se(h?n:n[0],h?o:o[0])}},Ze=u.useState(null),xe=m(Ze,2),$e=xe[0],j=xe[1],et=u.useState(0),Ee=m(et,2),tt=Ee[0],nt=Ee[1],ke=ve!==void 0?ve:i!=="combobox",De=u.useCallback(function(e,t){var n=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}).source,o=n===void 0?"keyboard":n;nt(t),$&&i==="combobox"&&e!==null&&o==="keyboard"&&j(String(e))},[$,i]),F=function(e,t,n){var o=function(){var Q,E=Me(e);return[ge?{label:E==null?void 0:E[a.label],value:e,key:(Q=E==null?void 0:E.key)!==null&&Q!==void 0?Q:e}:e,R.injectPropsWithOption(E)]};if(t&&ie){var l=o(),p=m(l,2),f=p[0],M=p[1];ie(f,M)}else if(!t&&le&&n!=="clear"){var N=o(),c=m(N,2),x=c[0],H=c[1];le(x,H)}},Ie=Pe(function(e,t){var n,o=!h||t.selected;n=o?h?[].concat(d(s),[e]):[e]:s.filter(function(l){return l.value!==e}),C(n),F(e,o),i==="combobox"?j(""):U.isMultiple&&!oe||(I(""),j(""))}),rt=u.useMemo(function(){var e=de!==!1&&_!==!1;return S(S({},V),{},{flattenOptions:K,onActiveValue:De,defaultActiveFirstOption:ke,onSelect:Ie,menuItemSelectedIcon:fe,rawValues:A,fieldNames:a,virtual:e,direction:z,listHeight:me,listItemHeight:he,childrenAsData:g,maxCount:Oe,optionRender:se})},[Oe,V,K,De,ke,Ie,fe,A,a,de,_,z,me,he,g,se]);return process.env.NODE_ENV!=="production"&&(je.default(r),je.warningNullOptions(w,a)),u.createElement(ft.Provider,{value:rt},u.createElement(U.default,ot({},Le,{id:Ve,prefixCls:He,ref:O,omitDomProps:St,mode:i,displayValues:Ue,onDisplayValuesChange:function(e,t){C(e);var n=t.type,o=t.values;n!=="remove"&&n!=="clear"||o.forEach(function(l){F(l.value,!1,n)})},direction:z,searchValue:v,onSearch:function(e,t){if(I(e),j(null),t.source!=="submit")t.source!=="blur"&&(i==="combobox"&&C(e),ne==null||ne(e));else{var n=(e||"").trim();if(n){var o=Array.from(new Set([].concat(d(A),[n])));C(o),F(n,!0),I("")}}},autoClearSearchValue:oe,onSearchSplit:function(e){var t=e;i!=="tags"&&(t=e.map(function(o){var l=Je.get(o);return l==null?void 0:l.value}).filter(function(o){return o!==void 0}));var n=Array.from(new Set([].concat(d(A),d(t))));C(n),n.forEach(function(o){F(o,!0)})},dropdownMatchSelectWidth:_,OptionList:vt,emptyOptions:!K.length,activeValue:$e,activeDescendantId:"".concat(Ve,"_list_").concat(tt)})))});process.env.NODE_ENV!=="production"&&(Fe.displayName="Select");var Y=Fe;Y.Option=ct,Y.OptGroup=st,module.exports=Y;
