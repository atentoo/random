import I from "../../@babel/runtime/helpers/esm/defineProperty.js";
import Ce from "../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import K from "../../@babel/runtime/helpers/esm/extends.js";
import Ie from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import ee from "../../@babel/runtime/helpers/esm/toConsumableArray.js";
import te from "../../../_virtual/index.js";
import s from "../../rc-util/es/KeyCode.js";
import ke from "../../rc-util/es/hooks/useMemo.js";
import Oe from "../../rc-util/es/omit.js";
import oe from "../../rc-util/es/pickAttrs.js";
import Pe from "../../rc-virtual-list/es/List.js";
import * as r from "react";
import { useEffect as ne } from "react";
import Te from "./SelectContext.js";
import De from "./TransBtn.js";
import Ae from "./hooks/useBaseProps.js";
import { isPlatformMac as Ve } from "./utils/platformUtil.js";
import { isValidCount as ze } from "./utils/valueUtil.js";
var Me = ["disabled", "title", "children", "style", "className"];
function re(k) {
  return typeof k == "string" || typeof k == "number";
}
var Le = function(k, ie) {
  var m = Ae(), ae = m.prefixCls, O = m.id, v = m.open, E = m.multiple, N = m.mode, w = m.searchValue, R = m.toggleOpen, le = m.notFoundContent, ce = m.onPopupScroll, l = r.useContext(Te), P = l.maxCount, F = l.flattenOptions, U = l.onActiveValue, ue = l.defaultActiveFirstOption, se = l.onSelect, S = l.menuItemSelectedIcon, c = l.rawValues, W = l.fieldNames, x = l.virtual, me = l.direction, fe = l.listHeight, de = l.listItemHeight, j = l.optionRender, p = "".concat(ae, "-item"), f = ke(function() {
    return F;
  }, [v, F], function(e, t) {
    return t[0] && e[1] !== t[1];
  }), T = r.useRef(null), D = r.useMemo(function() {
    return E && ze(P) && (c == null ? void 0 : c.size) >= P;
  }, [E, P, c == null ? void 0 : c.size]), B = function(e) {
    e.preventDefault();
  }, A = function(e) {
    var t;
    (t = T.current) === null || t === void 0 || t.scrollTo(typeof e == "number" ? { index: e } : e);
  }, q = r.useCallback(function(e) {
    return N !== "combobox" && c.has(e);
  }, [N, ee(c).toString(), c.size]), V = function(e) {
    for (var t = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 1, i = f.length, o = 0; o < i; o += 1) {
      var n = (e + o * t + i) % i, u = f[n] || {}, a = u.group, b = u.data;
      if (!a && (b == null || !b.disabled) && (q(b.value) || !D)) return n;
    }
    return -1;
  }, ve = r.useState(function() {
    return V(0);
  }), G = Ie(ve, 2), d = G[0], pe = G[1], C = function(e) {
    var t = arguments.length > 1 && arguments[1] !== void 0 && arguments[1];
    pe(e);
    var i = { source: t ? "keyboard" : "mouse" }, o = f[e];
    o ? U(o.value, e, i) : U(null, -1, i);
  };
  ne(function() {
    C(ue !== !1 ? V(0) : -1);
  }, [f.length, w]);
  var J = r.useCallback(function(e) {
    return N === "combobox" ? String(e).toLowerCase() === w.toLowerCase() : c.has(e);
  }, [N, w, ee(c).toString(), c.size]);
  ne(function() {
    var e, t = setTimeout(function() {
      if (!E && v && c.size === 1) {
        var i = Array.from(c)[0], o = f.findIndex(function(n) {
          return n.data.value === i;
        });
        o !== -1 && (C(o), A(o));
      }
    });
    return v && ((e = T.current) === null || e === void 0 || e.scrollTo(void 0)), function() {
      return clearTimeout(t);
    };
  }, [v, w]);
  var z = function(e) {
    e !== void 0 && se(e, { selected: !c.has(e) }), E || R(!1);
  };
  if (r.useImperativeHandle(ie, function() {
    return { onKeyDown: function(e) {
      var t = e.which, i = e.ctrlKey;
      switch (t) {
        case s.N:
        case s.P:
        case s.UP:
        case s.DOWN:
          var o = 0;
          if (t === s.UP ? o = -1 : t === s.DOWN ? o = 1 : Ve() && i && (t === s.N ? o = 1 : t === s.P && (o = -1)), o !== 0) {
            var n = V(d + o, o);
            A(n), C(n, !0);
          }
          break;
        case s.TAB:
        case s.ENTER:
          var u, a = f[d];
          !a || a != null && (u = a.data) !== null && u !== void 0 && u.disabled || D ? z(void 0) : z(a.value), v && e.preventDefault();
          break;
        case s.ESC:
          R(!1), v && e.stopPropagation();
      }
    }, onKeyUp: function() {
    }, scrollTo: function(e) {
      A(e);
    } };
  }), f.length === 0) return r.createElement("div", { role: "listbox", id: "".concat(O, "_list"), className: "".concat(p, "-empty"), onMouseDown: B }, le);
  var ge = Object.keys(W).map(function(e) {
    return W[e];
  }), Q = function(e) {
    return e.label;
  };
  function X(e, t) {
    return { role: e.group ? "presentation" : "option", id: "".concat(O, "_list_").concat(t) };
  }
  var M = function(e) {
    var t = f[e];
    if (!t) return null;
    var i = t.data || {}, o = i.value, n = t.group, u = oe(i, !0), a = Q(t);
    return t ? r.createElement("div", K({ "aria-label": typeof a != "string" || n ? null : a }, u, { key: e }, X(t, e), { "aria-selected": J(o) }), o) : null;
  }, Y = { role: "listbox", id: "".concat(O, "_list") };
  return r.createElement(r.Fragment, null, x && r.createElement("div", K({}, Y, { style: { height: 0, width: 0, overflow: "hidden" } }), M(d - 1), M(d), M(d + 1)), r.createElement(Pe, { itemKey: "key", ref: T, data: f, height: fe, itemHeight: de, fullHeight: !1, onMouseDown: B, onScroll: ce, virtual: x, direction: me, innerProps: x ? null : Y }, function(e, t) {
    var i = e.group, o = e.groupOption, n = e.data, u = e.label, a = e.value, b = n.key;
    if (i) {
      var L, ye = (L = n.title) !== null && L !== void 0 ? L : re(u) ? u.toString() : void 0;
      return r.createElement("div", { className: te(p, "".concat(p, "-group"), n.className), title: ye }, u !== void 0 ? u : b);
    }
    var be = n.disabled, Z = n.title;
    n.children;
    var he = n.style, Ee = n.className, Ne = Ce(n, Me), we = Oe(Ne, ge), g = q(a), h = be || !g && D, y = "".concat(p, "-option"), Se = te(p, y, Ee, I(I(I(I({}, "".concat(y, "-grouped"), o), "".concat(y, "-active"), d === t && !h), "".concat(y, "-disabled"), h), "".concat(y, "-selected"), g)), H = Q(e), xe = !S || typeof S == "function" || g, _ = typeof H == "number" ? H : H || a, $ = re(_) ? _.toString() : void 0;
    return Z !== void 0 && ($ = Z), r.createElement("div", K({}, oe(we), x ? {} : X(e, t), { "aria-selected": J(a), className: Se, title: $, onMouseMove: function() {
      d === t || h || C(t);
    }, onClick: function() {
      h || z(a);
    }, style: he }), r.createElement("div", { className: "".concat(y, "-content") }, typeof j == "function" ? j(e, { index: t }) : _), r.isValidElement(S) || g, xe && r.createElement(De, { className: "".concat(p, "-option-state"), customizeIcon: S, customizeIconProps: { value: a, disabled: h, isSelected: g } }, g ? "âœ“" : null));
  }));
}, He = r.forwardRef(Le);
process.env.NODE_ENV !== "production" && (He.displayName = "OptionList");
export {
  He as default
};
