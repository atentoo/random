"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const Me=require("../../../@babel/runtime/helpers/esm/extends.cjs"),d=require("../../../@babel/runtime/helpers/esm/defineProperty.cjs"),Rn=require("../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),V=require("../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),$=require("../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),In=require("../../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),Te=require("../../../../_virtual/index.cjs"),Pn=require("../../../rc-util/es/hooks/useLayoutEffect.cjs"),On=require("../../../rc-util/es/hooks/useMergedState.cjs"),Nn=require("../../../rc-util/es/isMobile.cjs"),Mn=require("../../../rc-util/es/ref.cjs"),Tn=require("react"),An=require("../hooks/useAllowClear.cjs"),Kn=require("../hooks/useBaseProps.cjs"),kn=require("../hooks/useDelayReset.cjs"),Fn=require("../hooks/useLock.cjs"),Bn=require("../hooks/useSelectTriggerControl.cjs"),jn=require("../Selector/index.cjs"),zn=require("../SelectTrigger.cjs"),Un=require("../TransBtn.cjs"),ee=require("../utils/valueUtil.cjs"),Wn=require("../SelectContext.cjs"),_n=require("./Polite.cjs");function Ln(e){const q=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const h in e)if(h!=="default"){const C=Object.getOwnPropertyDescriptor(e,h);Object.defineProperty(q,h,C.get?C:{enumerable:!0,get:()=>e[h]})}}return q.default=e,Object.freeze(q)}const o=Ln(Tn);var Hn=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","prefix","suffixIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","builtinPlacements","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],Gn=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"],Ke=function(e){return e==="tags"||e==="multiple"},Ae=o.forwardRef(function(e,q){var h,C=e.id,a=e.prefixCls,ke=e.className,ne=e.showSearch,Fe=e.tagRender,Be=e.direction,oe=e.omitDomProps,m=e.displayValues,k=e.onDisplayValuesChange,te=e.emptyOptions,re=e.notFoundContent,F=re===void 0?"Not Found":re,ue=e.onClear,i=e.mode,s=e.disabled,P=e.loading,ae=e.getInputElement,le=e.getRawInputElement,je=e.open,ze=e.defaultOpen,B=e.onDropdownVisibleChange,Ue=e.activeValue,ie=e.onActiveValueChange,We=e.activeDescendantId,ce=e.searchValue,_e=e.autoClearSearchValue,D=e.onSearch,se=e.onSearchSplit,j=e.tokenSeparators,de=e.allowClear,Le=e.prefix,fe=e.suffixIcon,He=e.clearIcon,Ge=e.OptionList,Je=e.animation,Qe=e.transitionName,Xe=e.dropdownStyle,Ye=e.dropdownClassName,Ze=e.dropdownMatchSelectWidth,$e=e.dropdownRender,en=e.dropdownAlign,nn=e.placement,on=e.builtinPlacements,tn=e.getPopupContainer,me=e.showAction,rn=me===void 0?[]:me,ve=e.onFocus,pe=e.onBlur,ge=e.onKeyUp,he=e.onKeyDown,we=e.onMouseDown,un=In(e,Hn),w=Ke(i),R=(ne!==void 0?ne:w)||i==="combobox",z=$({},un);Gn.forEach(function(n){delete z[n]}),oe==null||oe.forEach(function(n){delete z[n]});var an=o.useState(!1),be=V(an,2),ln=be[0],cn=be[1];o.useEffect(function(){cn(Nn())},[]);var U=o.useRef(null),O=o.useRef(null),W=o.useRef(null),I=o.useRef(null),N=o.useRef(null),_=o.useRef(!1),sn=kn(),L=V(sn,3),H=L[0],G=L[1],dn=L[2];o.useImperativeHandle(q,function(){var n,t;return{focus:(n=I.current)===null||n===void 0?void 0:n.focus,blur:(t=I.current)===null||t===void 0?void 0:t.blur,scrollTo:function(c){var r;return(r=N.current)===null||r===void 0?void 0:r.scrollTo(c)},nativeElement:U.current||O.current}});var b=o.useMemo(function(){var n;if(i!=="combobox")return ce;var t=(n=m[0])===null||n===void 0?void 0:n.value;return typeof t=="string"||typeof t=="number"?String(t):""},[ce,i,m]),ye=i==="combobox"&&typeof ae=="function"&&ae()||null,y=typeof le=="function"&&le(),fn=Mn.useComposeRef(O,y==null||(h=y.props)===null||h===void 0?void 0:h.ref),mn=o.useState(!1),Ce=V(mn,2),vn=Ce[0],pn=Ce[1];Pn.default(function(){pn(!0)},[]);var gn=On(!1,{defaultValue:ze,value:je}),Se=V(gn,2),Ee=Se[0],J=Se[1],u=!!vn&&Ee,xe=!F&&te;(s||xe&&u&&i==="combobox")&&(u=!1);var M=!xe&&u,v=o.useCallback(function(n){var t=n!==void 0?n:!u;s||(J(t),u!==t&&(B==null||B(t)))},[s,u,J,B]),hn=o.useMemo(function(){return(j||[]).some(function(n){return[`
`,`\r
`].includes(n)})},[j]),Ve=o.useContext(Wn)||{},T=Ve.maxCount,Q=Ve.rawValues,X=function(n,t,c){if(!(w&&ee.isValidCount(T)&&(Q==null?void 0:Q.size)>=T)){var r=!0,l=n;ie==null||ie(null);var f=ee.getSeparatedContent(n,j,ee.isValidCount(T)?T-Q.size:void 0),p=c?null:f;return i!=="combobox"&&p&&(l="",se==null||se(p),v(!1),r=!1),D&&b!==l&&D(l,{source:t?"typing":"effect"}),r}};o.useEffect(function(){u||w||i==="combobox"||X("",!1,!1)},[u]),o.useEffect(function(){Ee&&s&&J(!1),s&&!_.current&&G(!1)},[s]);var wn=Fn(),qe=V(wn,2),bn=qe[0],yn=qe[1],A=o.useRef(!1),Y=o.useRef(!1),S=[];o.useEffect(function(){return function(){S.forEach(function(n){return clearTimeout(n)}),S.splice(0,S.length)}},[]);var De,Cn=o.useState({}),Sn=V(Cn,2)[1];y&&(De=function(n){v(n)}),Bn(function(){var n;return[U.current,(n=W.current)===null||n===void 0?void 0:n.getPopupElement()]},M,v,!!y);var Re,En=o.useMemo(function(){return $($({},e),{},{notFoundContent:F,open:u,triggerOpen:M,id:C,showSearch:R,multiple:w,toggleOpen:v})},[e,F,M,u,C,R,w,v]),Ie=!!fe||P;Ie&&(Re=o.createElement(Un,{className:Te("".concat(a,"-arrow"),d({},"".concat(a,"-arrow-loading"),P)),customizeIcon:fe,customizeIconProps:{loading:P,searchValue:b,open:u,focused:H,showSearch:R}}));var Pe,Oe=An.useAllowClear(a,function(){var n;ue==null||ue(),(n=I.current)===null||n===void 0||n.focus(),k([],{type:"clear",values:m}),X("",!1,!1)},m,de,He,s,b,i),xn=Oe.allowClear,Vn=Oe.clearIcon,qn=o.createElement(Ge,{ref:N}),Dn=Te(a,ke,d(d(d(d(d(d(d(d(d(d({},"".concat(a,"-focused"),H),"".concat(a,"-multiple"),w),"".concat(a,"-single"),!w),"".concat(a,"-allow-clear"),de),"".concat(a,"-show-arrow"),Ie),"".concat(a,"-disabled"),s),"".concat(a,"-loading"),P),"".concat(a,"-open"),u),"".concat(a,"-customize-input"),ye),"".concat(a,"-show-search"),R)),Ne=o.createElement(zn,{ref:W,disabled:s,prefixCls:a,visible:M,popupElement:qn,animation:Je,transitionName:Qe,dropdownStyle:Xe,dropdownClassName:Ye,direction:Be,dropdownMatchSelectWidth:Ze,dropdownRender:$e,dropdownAlign:en,placement:nn,builtinPlacements:on,getPopupContainer:tn,empty:te,getTriggerDOMNode:function(n){return O.current||n},onPopupVisibleChange:De,onPopupMouseEnter:function(){Sn({})}},y?o.cloneElement(y,{ref:fn}):o.createElement(jn,Me({},e,{domRef:O,prefixCls:a,inputElement:ye,ref:I,id:C,prefix:Le,showSearch:R,autoClearSearchValue:_e,mode:i,activeDescendantId:We,tagRender:Fe,values:m,open:u,onToggleOpen:v,activeValue:Ue,searchValue:b,onSearch:X,onSearchSubmit:function(n){n&&n.trim()&&D(n,{source:"submit"})},onRemove:function(n){var t=m.filter(function(c){return c!==n});k(t,{type:"remove",values:[n]})},tokenWithEnter:hn,onInputBlur:function(){A.current=!1}})));return Pe=y?Ne:o.createElement("div",Me({className:Dn},z,{ref:U,onMouseDown:function(n){var t,c=n.target,r=(t=W.current)===null||t===void 0?void 0:t.getPopupElement();if(r&&r.contains(c)){var l=setTimeout(function(){var E,x=S.indexOf(l);x!==-1&&S.splice(x,1),dn(),ln||r.contains(document.activeElement)||(E=I.current)===null||E===void 0||E.focus()});S.push(l)}for(var f=arguments.length,p=new Array(f>1?f-1:0),g=1;g<f;g++)p[g-1]=arguments[g];we==null||we.apply(void 0,[n].concat(p))},onKeyDown:function(n){var t,c=bn(),r=n.key,l=r==="Enter";if(l&&(i!=="combobox"&&n.preventDefault(),u||v(!0)),yn(!!b),r==="Backspace"&&!c&&w&&!b&&m.length){for(var f=Rn(m),p=null,g=f.length-1;g>=0;g-=1){var E=f[g];if(!E.disabled){f.splice(g,1),p=E;break}}p&&k(f,{type:"remove",values:[p]})}for(var x=arguments.length,Z=new Array(x>1?x-1:0),K=1;K<x;K++)Z[K-1]=arguments[K];!u||l&&A.current||(l&&(A.current=!0),(t=N.current)===null||t===void 0||t.onKeyDown.apply(t,[n].concat(Z))),he==null||he.apply(void 0,[n].concat(Z))},onKeyUp:function(n){for(var t=arguments.length,c=new Array(t>1?t-1:0),r=1;r<t;r++)c[r-1]=arguments[r];var l;u&&((l=N.current)===null||l===void 0||l.onKeyUp.apply(l,[n].concat(c))),n.key==="Enter"&&(A.current=!1),ge==null||ge.apply(void 0,[n].concat(c))},onFocus:function(){G(!0),s||(ve&&!Y.current&&ve.apply(void 0,arguments),rn.includes("focus")&&v(!0)),Y.current=!0},onBlur:function(){_.current=!0,G(!1,function(){Y.current=!1,_.current=!1,v(!1)}),s||(b&&(i==="tags"?D(b,{source:"submit"}):i==="multiple"&&D("",{source:"blur"})),pe&&pe.apply(void 0,arguments))}}),o.createElement(_n,{visible:H&&!u,values:m}),Ne,Re,xn&&Vn),o.createElement(Kn.BaseSelectContext.Provider,{value:En},Pe)});process.env.NODE_ENV!=="production"&&(Ae.displayName="BaseSelect"),exports.default=Ae,exports.isMultiple=Ke;
