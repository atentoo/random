import s from "../../../../@babel/runtime/helpers/esm/slicedToArray.js";
import D from "../../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import * as C from "react";
import { pathKey as O } from "../Cache.js";
import U from "../StyleContext.js";
import V from "./useCompatibleInsertionEffect.js";
import _ from "./useEffectCleanupRegister.js";
import j from "./useHMR.js";
function z(E, G, N, c, m) {
  var u = C.useContext(U).cache, b = [E].concat(D(G)), o = O(b), x = _([o]), d = j(), p = function(i) {
    u.opUpdate(o, function(e) {
      var n = s(e || [void 0, void 0], 2), t = n[0], r = t === void 0 ? 0 : t, a = n[1], v = a;
      process.env.NODE_ENV !== "production" && a && d && (c == null || c(v, d), v = null);
      var h = [r, v || N()];
      return i ? i(h) : h;
    });
  };
  C.useMemo(function() {
    p();
  }, [o]);
  var f = u.opGet(o);
  process.env.NODE_ENV === "production" || f || (p(), f = u.opGet(o));
  var l = f[1];
  return V(function() {
    m == null || m(l);
  }, function(i) {
    return p(function(e) {
      var n = s(e, 2), t = n[0], r = n[1];
      return i && t === 0 && (m == null || m(l)), [t + 1, r];
    }), function() {
      u.opUpdate(o, function(e) {
        var n = s(e || [], 2), t = n[0], r = t === void 0 ? 0 : t, a = n[1];
        return r - 1 === 0 ? (x(function() {
          !i && u.opGet(o) || c == null || c(a, !1);
        }), null) : [r - 1, a];
      });
    };
  }, [o]), l;
}
export {
  z as default
};
