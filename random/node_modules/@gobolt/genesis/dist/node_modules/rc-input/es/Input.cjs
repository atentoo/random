"use strict";const he=require("../../@babel/runtime/helpers/esm/objectSpread2.cjs"),j=require("../../@babel/runtime/helpers/esm/extends.cjs"),G=require("../../@babel/runtime/helpers/esm/defineProperty.cjs"),ge=require("../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),S=require("../../@babel/runtime/helpers/esm/slicedToArray.cjs"),Ce=require("../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),F=require("../../../_virtual/index.cjs"),xe=require("../../rc-util/es/hooks/useMergedState.cjs"),ye=require("../../rc-util/es/omit.cjs"),o=require("react"),Ee=require("./BaseInput.cjs"),we=require("./hooks/useCount.cjs"),p=require("./utils/commonUtils.cjs");var qe=["autoComplete","onChange","onFocus","onBlur","onPressEnter","onKeyDown","onKeyUp","prefixCls","disabled","htmlSize","className","maxLength","suffix","showCount","count","type","classes","classNames","styles","onCompositionStart","onCompositionEnd"],Se=o.forwardRef(function(n,J){var M=n.autoComplete,N=n.onChange,R=n.onFocus,K=n.onBlur,b=n.onPressEnter,B=n.onKeyDown,z=n.onKeyUp,D=n.prefixCls,a=D===void 0?"rc-input":D,m=n.disabled,Q=n.htmlSize,W=n.className,X=n.maxLength,v=n.suffix,Y=n.showCount,Z=n.count,U=n.type,_=U===void 0?"text":U,$=n.classes,c=n.classNames,i=n.styles,I=n.onCompositionStart,L=n.onCompositionEnd,ee=Ce(n,qe),ne=o.useState(!1),P=S(ne,2),te=P[0],h=P[1],g=o.useRef(!1),l=o.useRef(!1),r=o.useRef(null),re=o.useRef(null),C=function(e){r.current&&p.triggerFocus(r.current,e)},oe=xe(n.defaultValue,{value:n.value}),k=S(oe,2),O=k[0],V=k[1],x=O==null?"":String(O),ue=o.useState(null),A=S(ue,2),y=A[0],le=A[1],u=we(Z,Y),f=u.max||X,E=u.strategy(x),se=!!f&&E>f;o.useImperativeHandle(J,function(){var e;return{focus:C,blur:function(){var t;(t=r.current)===null||t===void 0||t.blur()},setSelectionRange:function(t,w,d){var s;(s=r.current)===null||s===void 0||s.setSelectionRange(t,w,d)},select:function(){var t;(t=r.current)===null||t===void 0||t.select()},input:r.current,nativeElement:((e=re.current)===null||e===void 0?void 0:e.nativeElement)||r.current}}),o.useEffect(function(){l.current&&(l.current=!1),h(function(e){return(!e||!m)&&e})},[m]);var H=function(e,t,w){var d,s,q=t;if(!g.current&&u.exceedFormatter&&u.max&&u.strategy(t)>u.max)t!==(q=u.exceedFormatter(t,{max:u.max}))&&le([((d=r.current)===null||d===void 0?void 0:d.selectionStart)||0,((s=r.current)===null||s===void 0?void 0:s.selectionEnd)||0]);else if(w.source==="compositionEnd")return;V(q),r.current&&p.resolveOnChange(r.current,e,N,q)};o.useEffect(function(){var e;y&&((e=r.current)===null||e===void 0||e.setSelectionRange.apply(e,ge(y)))},[y]);var T,ae=function(e){H(e,e.target.value,{source:"change"})},ce=function(e){g.current=!1,H(e,e.currentTarget.value,{source:"compositionEnd"}),L==null||L(e)},ie=function(e){b&&e.key==="Enter"&&!l.current&&(l.current=!0,b(e)),B==null||B(e)},fe=function(e){e.key==="Enter"&&(l.current=!1),z==null||z(e)},de=function(e){h(!0),R==null||R(e)},me=function(e){l.current&&(l.current=!1),h(!1),K==null||K(e)},ve=se&&"".concat(a,"-out-of-range");return o.createElement(Ee,j({},ee,{prefixCls:a,className:F(W,ve),handleReset:function(e){V(""),C(),r.current&&p.resolveOnChange(r.current,e,N)},value:x,focused:te,triggerFocus:C,suffix:function(){var e=Number(f)>0;if(v||u.show){var t=u.showFormatter?u.showFormatter({value:x,count:E,maxLength:f}):"".concat(E).concat(e?" / ".concat(f):"");return o.createElement(o.Fragment,null,u.show&&o.createElement("span",{className:F("".concat(a,"-show-count-suffix"),G({},"".concat(a,"-show-count-has-suffix"),!!v),c==null?void 0:c.count),style:he({},i==null?void 0:i.count)},t),v)}return null}(),disabled:m,classes:$,classNames:c,styles:i}),(T=ye(n,["prefixCls","onPressEnter","addonBefore","addonAfter","prefix","suffix","allowClear","defaultValue","showCount","count","classes","htmlSize","styles","classNames","onClear"]),o.createElement("input",j({autoComplete:M},T,{onChange:ae,onFocus:de,onBlur:me,onKeyDown:ie,onKeyUp:fe,className:F(a,G({},"".concat(a,"-disabled"),m),c==null?void 0:c.input),style:i==null?void 0:i.input,ref:r,size:Q,type:_,onCompositionStart:function(e){g.current=!0,I==null||I(e)},onCompositionEnd:ce}))))});module.exports=Se;
