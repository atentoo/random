import Ce from "../../@babel/runtime/helpers/esm/objectSpread2.js";
import q from "../../@babel/runtime/helpers/esm/extends.js";
import G from "../../@babel/runtime/helpers/esm/defineProperty.js";
import xe from "../../@babel/runtime/helpers/esm/toConsumableArray.js";
import F from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import ye from "../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import N from "../../../_virtual/index.js";
import Ee from "../../rc-util/es/hooks/useMergedState.js";
import we from "../../rc-util/es/omit.js";
import f, { forwardRef as Se, useState as J, useRef as p, useImperativeHandle as Fe, useEffect as M } from "react";
import Ne from "./BaseInput.js";
import Ke from "./hooks/useCount.js";
import { triggerFocus as be, resolveOnChange as Q } from "./utils/commonUtils.js";
var Re = ["autoComplete", "onChange", "onFocus", "onBlur", "onPressEnter", "onKeyDown", "onKeyUp", "prefixCls", "disabled", "htmlSize", "className", "maxLength", "suffix", "showCount", "count", "type", "classes", "classNames", "styles", "onCompositionStart", "onCompositionEnd"], je = Se(function(n, W) {
  var X = n.autoComplete, K = n.onChange, b = n.onFocus, R = n.onBlur, B = n.onPressEnter, z = n.onKeyDown, D = n.onKeyUp, U = n.prefixCls, l = U === void 0 ? "rc-input" : U, d = n.disabled, Y = n.htmlSize, Z = n.className, _ = n.maxLength, v = n.suffix, $ = n.showCount, ee = n.count, I = n.type, ne = I === void 0 ? "text" : I, te = n.classes, s = n.classNames, i = n.styles, L = n.onCompositionStart, P = n.onCompositionEnd, oe = ye(n, Re), re = J(!1), k = F(re, 2), ue = k[0], h = k[1], g = p(!1), u = p(!1), o = p(null), ae = p(null), C = function(e) {
    o.current && be(o.current, e);
  }, le = Ee(n.defaultValue, { value: n.value }), V = F(le, 2), A = V[0], H = V[1], x = A == null ? "" : String(A), se = J(null), O = F(se, 2), y = O[0], ie = O[1], r = Ke(ee, $), c = r.max || _, E = r.strategy(x), ce = !!c && E > c;
  Fe(W, function() {
    var e;
    return { focus: C, blur: function() {
      var t;
      (t = o.current) === null || t === void 0 || t.blur();
    }, setSelectionRange: function(t, w, m) {
      var a;
      (a = o.current) === null || a === void 0 || a.setSelectionRange(t, w, m);
    }, select: function() {
      var t;
      (t = o.current) === null || t === void 0 || t.select();
    }, input: o.current, nativeElement: ((e = ae.current) === null || e === void 0 ? void 0 : e.nativeElement) || o.current };
  }), M(function() {
    u.current && (u.current = !1), h(function(e) {
      return (!e || !d) && e;
    });
  }, [d]);
  var T = function(e, t, w) {
    var m, a, S = t;
    if (!g.current && r.exceedFormatter && r.max && r.strategy(t) > r.max) t !== (S = r.exceedFormatter(t, { max: r.max })) && ie([((m = o.current) === null || m === void 0 ? void 0 : m.selectionStart) || 0, ((a = o.current) === null || a === void 0 ? void 0 : a.selectionEnd) || 0]);
    else if (w.source === "compositionEnd") return;
    H(S), o.current && Q(o.current, e, K, S);
  };
  M(function() {
    var e;
    y && ((e = o.current) === null || e === void 0 || e.setSelectionRange.apply(e, xe(y)));
  }, [y]);
  var j, me = function(e) {
    T(e, e.target.value, { source: "change" });
  }, fe = function(e) {
    g.current = !1, T(e, e.currentTarget.value, { source: "compositionEnd" }), P == null || P(e);
  }, de = function(e) {
    B && e.key === "Enter" && !u.current && (u.current = !0, B(e)), z == null || z(e);
  }, pe = function(e) {
    e.key === "Enter" && (u.current = !1), D == null || D(e);
  }, ve = function(e) {
    h(!0), b == null || b(e);
  }, he = function(e) {
    u.current && (u.current = !1), h(!1), R == null || R(e);
  }, ge = ce && "".concat(l, "-out-of-range");
  return f.createElement(Ne, q({}, oe, { prefixCls: l, className: N(Z, ge), handleReset: function(e) {
    H(""), C(), o.current && Q(o.current, e, K);
  }, value: x, focused: ue, triggerFocus: C, suffix: function() {
    var e = Number(c) > 0;
    if (v || r.show) {
      var t = r.showFormatter ? r.showFormatter({ value: x, count: E, maxLength: c }) : "".concat(E).concat(e ? " / ".concat(c) : "");
      return f.createElement(f.Fragment, null, r.show && f.createElement("span", { className: N("".concat(l, "-show-count-suffix"), G({}, "".concat(l, "-show-count-has-suffix"), !!v), s == null ? void 0 : s.count), style: Ce({}, i == null ? void 0 : i.count) }, t), v);
    }
    return null;
  }(), disabled: d, classes: te, classNames: s, styles: i }), (j = we(n, ["prefixCls", "onPressEnter", "addonBefore", "addonAfter", "prefix", "suffix", "allowClear", "defaultValue", "showCount", "count", "classes", "htmlSize", "styles", "classNames", "onClear"]), f.createElement("input", q({ autoComplete: X }, j, { onChange: me, onFocus: ve, onBlur: he, onKeyDown: de, onKeyUp: pe, className: N(l, G({}, "".concat(l, "-disabled"), d), s == null ? void 0 : s.input), style: i == null ? void 0 : i.input, ref: o, size: Y, type: ne, onCompositionStart: function(e) {
    g.current = !0, L == null || L(e);
  }, onCompositionEnd: fe }))));
});
export {
  je as default
};
