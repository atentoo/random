import g from "../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import v from "../../../@babel/runtime/helpers/esm/slicedToArray.js";
import * as p from "react";
import { useRef as a, useCallback as c } from "react";
import { warningOnce as R } from "../../../rc-util/es/warning.js";
import { nextSlice as j } from "../utils/timeUtil.js";
var h = "__RC_UTIL_PATH_SPLIT__", y = function(i) {
  return i.join(h);
}, _ = "rc-menu-more";
function D() {
  var i = p.useState({}), P = v(i, 2)[1], u = a(/* @__PURE__ */ new Map()), o = a(/* @__PURE__ */ new Map()), S = p.useState([]), l = v(S, 2), s = l[0], K = l[1], f = a(0), d = a(!1), E = c(function(t, e) {
    process.env.NODE_ENV !== "production" && R(!u.current.has(t), "Duplicated key '".concat(t, "' used in Menu by path [").concat(e.join(" > "), "]"));
    var r = y(e);
    o.current.set(r, t), u.current.set(t, r), f.current += 1;
    var n = f.current;
    j(function() {
      n === f.current && (d.current || P({}));
    });
  }, []), b = c(function(t, e) {
    var r = y(e);
    o.current.delete(r), u.current.delete(t);
  }, []), w = c(function(t) {
    K(t);
  }, []), m = c(function(t, e) {
    var r = u.current.get(t) || "", n = r.split(h);
    return e && s.includes(n[0]) && n.unshift(_), n;
  }, [s]), O = c(function(t, e) {
    return t.filter(function(r) {
      return r !== void 0;
    }).some(function(r) {
      return m(r, !0).includes(e);
    });
  }, [m]), k = c(function(t) {
    var e = "".concat(u.current.get(t)).concat(h), r = /* @__PURE__ */ new Set();
    return g(o.current.keys()).forEach(function(n) {
      n.startsWith(e) && r.add(o.current.get(n));
    }), r;
  }, []);
  return p.useEffect(function() {
    return function() {
      d.current = !0;
    };
  }, []), { registerPath: E, unregisterPath: b, refreshOverflowKeys: w, isSubPathKey: O, getKeyPath: m, getKeys: function() {
    var t = g(u.current.keys());
    return s.length && t.push(_), t;
  }, getSubPathKeys: k };
}
export {
  _ as OVERFLOW_KEY,
  D as default
};
