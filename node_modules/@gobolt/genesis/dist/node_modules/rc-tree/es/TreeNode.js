import Ce from "../../@babel/runtime/helpers/esm/extends.js";
import a from "../../@babel/runtime/helpers/esm/defineProperty.js";
import A from "../../@babel/runtime/helpers/esm/objectSpread2.js";
import he from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import Ne from "../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import t from "react";
import p from "../../../_virtual/index.js";
import ke from "../../rc-util/es/pickAttrs.js";
import { TreeContext as De, UnstableContext as Ee } from "./contextTypes.js";
import Me from "./Indent.js";
import F from "./utils/keyUtil.js";
import { convertNodePropsToEventData as i } from "./utils/treeUtil.js";
var ye = ["eventKey", "className", "style", "dragOver", "dragOverGapTop", "dragOverGapBottom", "isLeaf", "isStart", "isEnd", "expanded", "selected", "checked", "halfChecked", "loading", "domRef", "active", "data", "onMouseMove", "selectable"], H = "open", J = "close", Q = function(o) {
  var E, M, y, l = o.eventKey, W = o.className, X = o.style, Y = o.dragOver, Z = o.dragOverGapTop, $ = o.dragOverGapBottom, v = o.isLeaf, b = o.isStart, O = o.isEnd, d = o.expanded, P = o.selected, u = o.checked, N = o.halfChecked, s = o.loading, ee = o.domRef, oe = o.active, g = o.data, ne = o.onMouseMove, x = o.selectable, te = Ne(o, ye), e = t.useContext(De), T = t.useContext(Ee), ae = t.useRef(null), re = t.useState(!1), R = he(re, 2), ce = R[0], L = R[1], c = !!(e.disabled || o.disabled || (E = T.nodeDisabled) !== null && E !== void 0 && E.call(T, g)), C = t.useMemo(function() {
    return !(!e.checkable || o.checkable === !1) && e.checkable;
  }, [e.checkable, o.checkable]), I = function(n) {
    c || C && !o.disableCheckbox && e.onNodeCheck(n, i(o), !u);
  }, ie = t.useMemo(function() {
    return typeof x == "boolean" ? x : e.selectable;
  }, [x, e.selectable]), K = function(n) {
    e.onNodeClick(n, i(o)), ie ? function(r) {
      c || e.onNodeSelect(r, i(o));
    }(n) : I(n);
  }, _ = function(n) {
    e.onNodeDoubleClick(n, i(o));
  }, B = function(n) {
    e.onNodeMouseEnter(n, i(o));
  }, G = function(n) {
    e.onNodeMouseLeave(n, i(o));
  }, z = function(n) {
    e.onNodeContextMenu(n, i(o));
  }, f = t.useMemo(function() {
    return !(!e.draggable || e.draggable.nodeDraggable && !e.draggable.nodeDraggable(g));
  }, [e.draggable, g]), le = function(n) {
    s || e.onNodeExpand(n, i(o));
  }, w = t.useMemo(function() {
    var n = (F(e.keyEntities, l) || {}).children;
    return !!(n || []).length;
  }, [e.keyEntities, l]), m = t.useMemo(function() {
    return v !== !1 && (v || !e.loadData && !w || e.loadData && o.loaded && !w);
  }, [v, e.loadData, w, o.loaded]);
  t.useEffect(function() {
    s || typeof e.loadData != "function" || !d || m || o.loaded || e.onNodeLoad(i(o));
  }, [s, e.loadData, e.onNodeLoad, d, m, o]);
  var de = t.useMemo(function() {
    var n;
    return (n = e.draggable) !== null && n !== void 0 && n.icon ? t.createElement("span", { className: "".concat(e.prefixCls, "-draggable-icon") }, e.draggable.icon) : null;
  }, [e.draggable]), U = function(n) {
    var r = o.switcherIcon || e.switcherIcon;
    return typeof r == "function" ? r(A(A({}, o), {}, { isLeaf: n })) : r;
  }, se = t.useMemo(function() {
    if (!C) return null;
    var n = typeof C != "boolean" ? C : null;
    return t.createElement("span", { className: p("".concat(e.prefixCls, "-checkbox"), a(a(a({}, "".concat(e.prefixCls, "-checkbox-checked"), u), "".concat(e.prefixCls, "-checkbox-indeterminate"), !u && N), "".concat(e.prefixCls, "-checkbox-disabled"), c || o.disableCheckbox)), onClick: I, role: "checkbox", "aria-checked": N ? "mixed" : u, "aria-disabled": c || o.disableCheckbox, "aria-label": "Select ".concat(typeof o.title == "string" ? o.title : "tree node") }, n);
  }, [C, u, N, c, o.disableCheckbox, o.title]), k = t.useMemo(function() {
    return m ? null : d ? H : J;
  }, [m, d]), S = t.useMemo(function() {
    return t.createElement("span", { className: p("".concat(e.prefixCls, "-iconEle"), "".concat(e.prefixCls, "-icon__").concat(k || "docu"), a({}, "".concat(e.prefixCls, "-icon_loading"), s)) });
  }, [e.prefixCls, k, s]), fe = t.useMemo(function() {
    var n = !!e.draggable;
    return !o.disabled && n && e.dragOverNodeKey === l ? e.dropIndicatorRender({ dropPosition: e.dropPosition, dropLevelOffset: e.dropLevelOffset, indent: e.indent, prefixCls: e.prefixCls, direction: e.direction }) : null;
  }, [e.dropPosition, e.dropLevelOffset, e.indent, e.prefixCls, e.direction, e.draggable, e.dragOverNodeKey, e.dropIndicatorRender]), pe = t.useMemo(function() {
    var n, r, j = o.title, h = j === void 0 ? "---" : j, q = "".concat(e.prefixCls, "-node-content-wrapper");
    if (e.showIcon) {
      var D = o.icon || e.icon;
      n = D ? t.createElement("span", { className: p("".concat(e.prefixCls, "-iconEle"), "".concat(e.prefixCls, "-icon__customize")) }, typeof D == "function" ? D(o) : D) : S;
    } else e.loadData && s && (n = S);
    return r = typeof h == "function" ? h(g) : e.titleRender ? e.titleRender(g) : h, t.createElement("span", { ref: ae, title: typeof h == "string" ? h : "", className: p(q, "".concat(q, "-").concat(k || "normal"), a({}, "".concat(e.prefixCls, "-node-selected"), !c && (P || ce))), onMouseEnter: B, onMouseLeave: G, onContextMenu: z, onClick: K, onDoubleClick: _ }, n, t.createElement("span", { className: "".concat(e.prefixCls, "-title") }, r), fe);
  }, [e.prefixCls, e.showIcon, o, e.icon, S, e.titleRender, g, k, B, G, z, K, _]), ue = ke(te, { aria: !0, data: !0 }), ge = (F(e.keyEntities, l) || {}).level, me = O[O.length - 1], V = !c && f, ve = e.draggingNodeKey === l, xe = x !== void 0 ? { "aria-selected": !!x } : void 0;
  return t.createElement("div", Ce({ ref: ee, role: "treeitem", "aria-expanded": v ? void 0 : d, className: p(W, "".concat(e.prefixCls, "-treenode"), (y = {}, a(a(a(a(a(a(a(a(a(a(y, "".concat(e.prefixCls, "-treenode-disabled"), c), "".concat(e.prefixCls, "-treenode-switcher-").concat(d ? "open" : "close"), !v), "".concat(e.prefixCls, "-treenode-checkbox-checked"), u), "".concat(e.prefixCls, "-treenode-checkbox-indeterminate"), N), "".concat(e.prefixCls, "-treenode-selected"), P), "".concat(e.prefixCls, "-treenode-loading"), s), "".concat(e.prefixCls, "-treenode-active"), oe), "".concat(e.prefixCls, "-treenode-leaf-last"), me), "".concat(e.prefixCls, "-treenode-draggable"), f), "dragging", ve), a(a(a(a(a(a(a(y, "drop-target", e.dropTargetKey === l), "drop-container", e.dropContainerKey === l), "drag-over", !c && Y), "drag-over-gap-top", !c && Z), "drag-over-gap-bottom", !c && $), "filter-node", (M = e.filterTreeNode) === null || M === void 0 ? void 0 : M.call(e, i(o))), "".concat(e.prefixCls, "-treenode-leaf"), m))), style: X, draggable: V, onDragStart: V ? function(n) {
    n.stopPropagation(), L(!0), e.onNodeDragStart(n, o);
    try {
      n.dataTransfer.setData("text/plain", "");
    } catch {
    }
  } : void 0, onDragEnter: f ? function(n) {
    n.preventDefault(), n.stopPropagation(), e.onNodeDragEnter(n, o);
  } : void 0, onDragOver: f ? function(n) {
    n.preventDefault(), n.stopPropagation(), e.onNodeDragOver(n, o);
  } : void 0, onDragLeave: f ? function(n) {
    n.stopPropagation(), e.onNodeDragLeave(n, o);
  } : void 0, onDrop: f ? function(n) {
    n.preventDefault(), n.stopPropagation(), L(!1), e.onNodeDrop(n, o);
  } : void 0, onDragEnd: f ? function(n) {
    n.stopPropagation(), L(!1), e.onNodeDragEnd(n, o);
  } : void 0, onMouseMove: ne }, xe, ue), t.createElement(Me, { prefixCls: e.prefixCls, level: ge, isStart: b, isEnd: O }), de, function() {
    if (m) {
      var n = U(!0);
      return n !== !1 ? t.createElement("span", { className: p("".concat(e.prefixCls, "-switcher"), "".concat(e.prefixCls, "-switcher-noop")) }, n) : null;
    }
    var r = U(!1);
    return r !== !1 ? t.createElement("span", { onClick: le, className: p("".concat(e.prefixCls, "-switcher"), "".concat(e.prefixCls, "-switcher_").concat(d ? H : J)) }, r) : null;
  }(), se, pe);
};
Q.isTreeNode = 1, process.env.NODE_ENV !== "production" && (Q.displayName = "TreeNode");
export {
  Q as default
};
