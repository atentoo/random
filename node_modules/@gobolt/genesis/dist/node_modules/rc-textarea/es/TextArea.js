import ge from "../../@babel/runtime/helpers/esm/extends.js";
import Y from "../../@babel/runtime/helpers/esm/defineProperty.js";
import i from "../../@babel/runtime/helpers/esm/objectSpread2.js";
import Ce from "../../@babel/runtime/helpers/esm/toConsumableArray.js";
import d from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import ye from "../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import p from "../../../_virtual/index.js";
import Ee from "../../rc-input/es/BaseInput.js";
import we from "../../rc-util/es/hooks/useMergedState.js";
import o, { useRef as Z, useImperativeHandle as Se, useEffect as ze } from "react";
import Ne from "../../rc-input/es/hooks/useCount.js";
import { resolveOnChange as _ } from "../../rc-input/es/utils/commonUtils.js";
import be from "./ResizableTextArea.js";
var Fe = ["defaultValue", "value", "onFocus", "onBlur", "onChange", "allowClear", "maxLength", "onCompositionStart", "onCompositionEnd", "suffix", "prefixCls", "showCount", "count", "className", "style", "disabled", "hidden", "classNames", "styles", "onResize", "onClear", "onPressEnter", "readOnly", "autoSize", "onKeyDown"], Ie = o.forwardRef(function(n, $) {
  var v, R = n.defaultValue, h = n.value, O = n.onFocus, A = n.onBlur, L = n.onChange, x = n.allowClear, T = n.maxLength, B = n.onCompositionStart, D = n.onCompositionEnd, ee = n.suffix, K = n.prefixCls, u = K === void 0 ? "rc-textarea" : K, g = n.showCount, ne = n.count, te = n.className, C = n.style, c = n.disabled, oe = n.hidden, l = n.classNames, f = n.styles, V = n.onResize, ae = n.onClear, W = n.onPressEnter, P = n.readOnly, k = n.autoSize, H = n.onKeyDown, re = ye(n, Fe), le = we(R, { value: h, defaultValue: R }), I = d(le, 2), j = I[0], q = I[1], y = j == null ? "" : String(j), ue = o.useState(!1), G = d(ue, 2), ie = G[0], E = G[1], w = o.useRef(!1), se = o.useState(null), J = d(se, 2), ce = J[0], fe = J[1], M = Z(null), S = Z(null), a = function() {
    var e;
    return (e = S.current) === null || e === void 0 ? void 0 : e.textArea;
  }, Q = function() {
    a().focus();
  };
  Se($, function() {
    var e;
    return { resizableTextArea: S.current, focus: Q, blur: function() {
      a().blur();
    }, nativeElement: ((e = M.current) === null || e === void 0 ? void 0 : e.nativeElement) || a() };
  }), ze(function() {
    E(function(e) {
      return !c && e;
    });
  }, [c]);
  var me = o.useState(null), U = d(me, 2), z = U[0], de = U[1];
  o.useEffect(function() {
    var e;
    z && (e = a()).setSelectionRange.apply(e, Ce(z));
  }, [z]);
  var m, t = Ne(ne, g), s = (v = t.max) !== null && v !== void 0 ? v : T, pe = Number(s) > 0, N = t.strategy(y), ve = !!s && N > s, X = function(e, r) {
    var F = r;
    !w.current && t.exceedFormatter && t.max && t.strategy(r) > t.max && r !== (F = t.exceedFormatter(r, { max: t.max })) && de([a().selectionStart || 0, a().selectionEnd || 0]), q(F), _(e.currentTarget, e, L, F);
  }, b = ee;
  t.show && (m = t.showFormatter ? t.showFormatter({ value: y, count: N, maxLength: s }) : "".concat(N).concat(pe ? " / ".concat(s) : ""), b = o.createElement(o.Fragment, null, b, o.createElement("span", { className: p("".concat(u, "-data-count"), l == null ? void 0 : l.count), style: f == null ? void 0 : f.count }, m)));
  var xe = !k && !g && !x;
  return o.createElement(Ee, { ref: M, value: y, allowClear: x, handleReset: function(e) {
    q(""), Q(), _(a(), e, L);
  }, suffix: b, prefixCls: u, classNames: i(i({}, l), {}, { affixWrapper: p(l == null ? void 0 : l.affixWrapper, Y(Y({}, "".concat(u, "-show-count"), g), "".concat(u, "-textarea-allow-clear"), x)) }), disabled: c, focused: ie, className: p(te, ve && "".concat(u, "-out-of-range")), style: i(i({}, C), ce && !xe ? { height: "auto" } : {}), dataAttrs: { affixWrapper: { "data-count": typeof m == "string" ? m : void 0 } }, hidden: oe, readOnly: P, onClear: ae }, o.createElement(be, ge({}, re, { autoSize: k, maxLength: T, onKeyDown: function(e) {
    e.key === "Enter" && W && W(e), H == null || H(e);
  }, onChange: function(e) {
    X(e, e.target.value);
  }, onFocus: function(e) {
    E(!0), O == null || O(e);
  }, onBlur: function(e) {
    E(!1), A == null || A(e);
  }, onCompositionStart: function(e) {
    w.current = !0, B == null || B(e);
  }, onCompositionEnd: function(e) {
    w.current = !1, X(e, e.currentTarget.value), D == null || D(e);
  }, className: p(l == null ? void 0 : l.textarea), style: i(i({}, f == null ? void 0 : f.textarea), {}, { resize: C == null ? void 0 : C.resize }), disabled: c, prefixCls: u, onResize: function(e) {
    var r;
    V == null || V(e), (r = a()) !== null && r !== void 0 && r.style.height && fe(!0);
  }, ref: S, readOnly: P })));
});
export {
  Ie as default
};
