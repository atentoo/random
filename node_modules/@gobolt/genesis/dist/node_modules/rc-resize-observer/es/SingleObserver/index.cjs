"use strict";const N=require("../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),_=require("../../../@babel/runtime/helpers/esm/typeof.cjs"),h=require("../../../rc-util/es/Dom/findDOMNode.cjs"),g=require("../../../rc-util/es/ref.cjs"),k=require("react"),B=require("../Collection.cjs"),W=require("../utils/observerUtil.cjs"),I=require("./DomWrapper.cjs");function T(r){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const n in r)if(n!=="default"){const i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(o,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}return o.default=r,Object.freeze(o)}const t=T(k);function A(r,o){var n=r.children,i=r.disabled,u=t.useRef(null),v=t.useRef(null),p=t.useContext(B.CollectionContext),b=typeof n=="function",f=b?n(u):n,c=t.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),m=!b&&t.isValidElement(f)&&g.supportRef(f),S=m?g.getNodeRef(f):null,x=g.useComposeRef(S,u),R=function(){var e;return h.default(u.current)||(u.current&&_(u.current)==="object"?h.default((e=u.current)===null||e===void 0?void 0:e.nativeElement):null)||h.default(v.current)};t.useImperativeHandle(o,function(){return R()});var q=t.useRef(r);q.current=r;var O=t.useCallback(function(e){var E=q.current,j=E.onResize,P=E.data,w=e.getBoundingClientRect(),a=w.width,d=w.height,l=e.offsetWidth,s=e.offsetHeight,C=Math.floor(a),H=Math.floor(d);if(c.current.width!==C||c.current.height!==H||c.current.offsetWidth!==l||c.current.offsetHeight!==s){var y={width:C,height:H,offsetWidth:l,offsetHeight:s};c.current=y;var z=l===Math.round(a)?a:l,V=s===Math.round(d)?d:s,M=N(N({},y),{},{offsetWidth:z,offsetHeight:V});p==null||p(M,e,P),j&&Promise.resolve().then(function(){j(M,e)})}},[]);return t.useEffect(function(){var e=R();return e&&!i&&W.observe(e,O),function(){return W.unobserve(e,O)}},[u.current,i]),t.createElement(I,{ref:v},m?t.cloneElement(f,{ref:x}):f)}var D=t.forwardRef(A);process.env.NODE_ENV!=="production"&&(D.displayName="SingleObserver"),module.exports=D;
