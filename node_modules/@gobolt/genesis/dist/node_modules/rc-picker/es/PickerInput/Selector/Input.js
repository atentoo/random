import Be from "../../../../@babel/runtime/helpers/esm/extends.js";
import te from "../../../../@babel/runtime/helpers/esm/defineProperty.js";
import f from "../../../../@babel/runtime/helpers/esm/slicedToArray.js";
import Ae from "../../../../@babel/runtime/helpers/esm/objectWithoutProperties.js";
import Ke from "../../../../../_virtual/index.js";
import Fe from "../../../../rc-util/es/hooks/useEvent.js";
import He from "../../../../rc-util/es/hooks/useLayoutEffect.js";
import * as t from "react";
import "../../../../rc-util/es/ref.js";
import "../../../../rc-util/es/warning.js";
import re from "../../../../rc-util/es/raf.js";
import { leftPad as Oe } from "../../utils/miscUtil.js";
import Ue from "../context.js";
import Pe from "../hooks/useLockEffect.js";
import Ve from "./Icon.js";
import je from "./MaskFormat.js";
import { getMaskRange as ze } from "./util.js";
var Le = ["active", "showActiveCls", "suffixIcon", "format", "validateFormat", "onChange", "onInput", "helped", "onHelp", "onSubmit", "onKeyDown", "preserveInvalidOnBlur", "invalid", "clearIcon"], _e = t.forwardRef(function(n, oe) {
  var b = n.active, R = n.showActiveCls, ae = R === void 0 || R, ue = n.suffixIcon, a = n.format, I = n.validateFormat, B = n.onChange;
  n.onInput;
  var C = n.helped, ie = n.onHelp, ce = n.onSubmit, A = n.onKeyDown, K = n.preserveInvalidOnBlur, le = K !== void 0 && K, fe = n.invalid, se = n.clearIcon, me = Ae(n, Le), v = n.value, pe = n.onFocus, ve = n.onBlur, F = n.onMouseUp, H = t.useContext(Ue), de = H.prefixCls, O = H.input, ge = O === void 0 ? "input" : O, D = "".concat(de, "-input"), we = t.useState(!1), U = f(we, 2), P = U[0], V = U[1], Se = t.useState(v), j = f(Se, 2), be = j[0], d = j[1], Ie = t.useState(""), z = f(Ie, 2), Ce = z[0], k = z[1], De = t.useState(null), L = f(De, 2), x = L[0], y = L[1], ke = t.useState(null), _ = f(ke, 2), xe = _[0], h = _[1], i = be || "";
  t.useEffect(function() {
    d(v);
  }, [v]);
  var q = t.useRef(), s = t.useRef();
  t.useImperativeHandle(oe, function() {
    return { nativeElement: q.current, inputElement: s.current, focus: function(e) {
      s.current.focus(e);
    }, blur: function() {
      s.current.blur();
    } };
  });
  var m = t.useMemo(function() {
    return new je(a || "");
  }, [a]), ye = t.useMemo(function() {
    return C ? [0, 0] : m.getSelection(x);
  }, [m, x, C]), G = f(ye, 2), c = G[0], l = G[1], J = function(e) {
    e && e !== a && e !== v && ie();
  }, g = Fe(function(e) {
    I(e) && B(e), d(e), J(e);
  }), M = t.useRef(!1), Q = function(e) {
    ve(e);
  };
  Pe(b, function() {
    b || le || d(v);
  });
  var T = function(e) {
    e.key === "Enter" && I(i) && ce(), A == null || A(e);
  }, W = t.useRef();
  He(function() {
    if (P && a && !M.current) {
      if (m.match(i)) return s.current.setSelectionRange(c, l), W.current = re(function() {
        s.current.setSelectionRange(c, l);
      }), function() {
        re.cancel(W.current);
      };
      g(a);
    }
  }, [m, a, P, i, x, c, l, xe, g]);
  var Me = a ? { onFocus: function(e) {
    V(!0), y(0), k(""), pe(e);
  }, onBlur: function(e) {
    V(!1), Q(e);
  }, onKeyDown: function(e) {
    T(e);
    var r = e.key, o = null, p = null, X = l - c, Y = a.slice(c, l), N = function(w) {
      y(function(E) {
        var u = E + w;
        return u = Math.max(u, 0), u = Math.min(u, m.size() - 1);
      });
    }, Z = function(w) {
      var E = ze(Y), u = f(E, 3), S = u[0], $ = u[1], Ee = u[2], Re = i.slice(c, l), ee = Number(Re);
      if (isNaN(ee)) return String(Ee || (w > 0 ? S : $));
      var ne = $ - S + 1;
      return String(S + (ne + (ee + w) - S) % ne);
    };
    switch (r) {
      case "Backspace":
      case "Delete":
        o = "", p = Y;
        break;
      case "ArrowLeft":
        o = "", N(-1);
        break;
      case "ArrowRight":
        o = "", N(1);
        break;
      case "ArrowUp":
        o = "", p = Z(1);
        break;
      case "ArrowDown":
        o = "", p = Z(-1);
        break;
      default:
        isNaN(Number(r)) || (p = o = Ce + r);
    }
    if (o !== null && (k(o), o.length >= X && (N(1), k(""))), p !== null) {
      var Ne = i.slice(0, c) + Oe(p, X) + i.slice(l);
      g(Ne.slice(0, a.length));
    }
    h({});
  }, onMouseDown: function() {
    M.current = !0;
  }, onMouseUp: function(e) {
    var r = e.target.selectionStart, o = m.getMaskCellIndex(r);
    y(o), h({}), F == null || F(e), M.current = !1;
  }, onPaste: function(e) {
    var r = e.clipboardData.getData("text");
    I(r) && g(r);
  } } : {};
  return t.createElement("div", { ref: q, className: Ke(D, te(te({}, "".concat(D, "-active"), b && ae), "".concat(D, "-placeholder"), C)) }, t.createElement(ge, Be({ ref: s, "aria-invalid": fe, autoComplete: "off" }, me, { onKeyDown: T, onBlur: Q }, Me, { value: i, onChange: function(e) {
    if (!a) {
      var r = e.target.value;
      J(r), d(r), B(r);
    }
  } })), t.createElement(Ve, { type: "suffix", icon: ue }), se);
});
process.env.NODE_ENV !== "production" && (_e.displayName = "Input");
export {
  _e as default
};
