import c from "../../../../@babel/runtime/helpers/esm/slicedToArray.js";
import z from "../../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import M from "../../../../rc-util/es/hooks/useEvent.js";
import $ from "../../../../rc-util/es/hooks/useMergedState.js";
import "../../../../rc-util/es/ref.js";
import "../../../../rc-util/es/warning.js";
import * as J from "react";
import K from "../../hooks/useSyncState.js";
import { isSame as rr, formatValue as nr, isSameTimestamp as tr } from "../../utils/dateUtil.js";
import { fillIndex as er } from "../../utils/miscUtil.js";
import fr from "./useLockEffect.js";
var or = [];
function N(n, e, s) {
  return [function(f) {
    return f.map(function(a) {
      return nr(a, { generateConfig: n, locale: e, format: s[0] });
    });
  }, function(f, a) {
    for (var u = Math.max(f.length, a.length), p = -1, o = 0; o < u; o += 1) {
      var v = f[o] || null, g = a[o] || null;
      if (v !== g && !tr(n, v, g)) {
        p = o;
        break;
      }
    }
    return [p < 0, p !== 0];
  }];
}
function O(n, e) {
  return z(n).sort(function(s, f) {
    return e.isAfter(s, f) ? 1 : -1;
  });
}
function hr(n, e, s, f, a, u, p, o, v) {
  var g = $(u, { value: p }), h = c(g, 2), b = h[0], R = h[1], E = b || or, V = function(m) {
    var t = K(m), i = c(t, 2), x = i[0], d = i[1], I = M(function() {
      d(m);
    });
    return J.useEffect(function() {
      I();
    }, [m]), [x, d];
  }(E), k = c(V, 2), y = k[0], T = k[1], S = N(n, e, s), U = c(S, 2), q = U[0], L = U[1], j = M(function(m) {
    var t = z(m);
    if (f) for (var i = 0; i < 2; i += 1) t[i] = t[i] || null;
    else a && (t = O(t.filter(function(r) {
      return r;
    }), n));
    var x = L(y(), t), d = c(x, 2), I = d[0], l = d[1];
    if (!I && (T(t), o)) {
      var C = q(t);
      o(t, C, { range: l ? "end" : "start" });
    }
  });
  return [E, R, y, j, function() {
    v && v(y());
  }];
}
function xr(n, e, s, f, a, u, p, o, v, g) {
  var h = n.generateConfig, b = n.locale, R = n.picker, E = n.onChange, V = n.allowEmpty, k = n.order, y = !u.some(function(l) {
    return l;
  }) && k, T = N(h, b, p), S = c(T, 2), U = S[0], q = S[1], L = K(e), j = c(L, 2), m = j[0], t = j[1], i = M(function() {
    t(e);
  });
  J.useEffect(function() {
    i();
  }, [e]);
  var x = M(function(l) {
    var C = l === null, r = z(l || m());
    if (C) for (var P = Math.max(u.length, r.length), w = 0; w < P; w += 1) u[w] || (r[w] = null);
    y && r[0] && r[1] && (r = O(r, h)), a(r);
    var B = c(r, 2), A = B[0], D = B[1], F = !A, G = !D, Q = !V || (!F || V[0]) && (!G || V[1]), W = !k || F || G || rr(h, b, A, D, R) || h.isAfter(D, A), X = (u[0] || !A || !g(A, { activeIndex: 0 })) && (u[1] || !D || !g(D, { from: A, activeIndex: 1 })), H = C || Q && W && X;
    if (H) {
      s(r);
      var Y = q(r, e), Z = c(Y, 1)[0];
      E && !Z && E(C && r.every(function(_) {
        return !_;
      }) ? null : r, U(r));
    }
    return H;
  }), d = M(function(l, C) {
    var r = er(m(), l, f()[l]);
    t(r), C && x();
  }), I = !o && !v;
  return fr(!I, function() {
    I && (x(), a(e), i());
  }, 2), [d, x];
}
export {
  xr as default,
  hr as useInnerValue
};
