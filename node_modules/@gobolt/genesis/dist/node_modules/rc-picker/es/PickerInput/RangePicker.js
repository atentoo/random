import G from "../../../@babel/runtime/helpers/esm/extends.js";
import ye from "../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import we from "../../../@babel/runtime/helpers/esm/objectSpread2.js";
import m from "../../../@babel/runtime/helpers/esm/slicedToArray.js";
import ke from "../../../rc-util/es/hooks/useEvent.js";
import Nn from "../../../rc-util/es/hooks/useMergedState.js";
import "../../../rc-util/es/ref.js";
import { warningOnce as Rn } from "../../../rc-util/es/warning.js";
import Ee from "../../../rc-util/es/hooks/useLayoutEffect.js";
import Dn from "../../../rc-util/es/omit.js";
import Sn from "../../../rc-util/es/pickAttrs.js";
import * as u from "react";
import Tn from "../PickerTrigger/index.js";
import { pickTriggerProps as Fn } from "../PickerTrigger/util.js";
import { fillIndex as J, toArray as Mn, getFromDate as An } from "../utils/miscUtil.js";
import Bn from "./context.js";
import Hn from "./hooks/useCellRender.js";
import jn from "./hooks/useFieldsInvalidate.js";
import Kn from "./hooks/useFilledProps.js";
import _n from "./hooks/useOpen.js";
import Yn from "./hooks/usePickerRef.js";
import qn from "./hooks/usePresets.js";
import zn from "./hooks/useRangeActive.js";
import Gn from "./hooks/useRangeDisabledDate.js";
import Jn from "./hooks/useRangePickerValue.js";
import Ln, { useInnerValue as Qn } from "./hooks/useRangeValue.js";
import Un from "./hooks/useShowNow.js";
import Wn from "./Popup/index.js";
import Xn from "./Selector/RangeSelector.js";
function Oe(p, A) {
  var g = p ?? A;
  return Array.isArray(g) ? g : [g, g];
}
function M(p) {
  return p === 1 ? "end" : "start";
}
function Zn(p, A) {
  var g = Kn(p, function() {
    var e = p.disabled, o = p.allowEmpty;
    return { disabled: Oe(e, !1), allowEmpty: Oe(o, !1) };
  }), C = m(g, 6), n = C[0], L = C[1], B = C[2], H = C[3], Q = C[4], j = C[5], U = n.prefixCls, Pe = n.styles, Ve = n.classNames, K = n.defaultValue, _ = n.value, h = n.needConfirm, W = n.onKeyDown, s = n.disabled, I = n.allowEmpty, xe = n.disabledDate, Ie = n.minDate, Ne = n.maxDate, Re = n.defaultOpen, De = n.open, Se = n.onOpenChange, w = n.locale, k = n.generateConfig, d = n.picker, Te = n.showNow, Fe = n.showToday, b = n.showTime, Me = n.mode, X = n.onPanelChange, Ae = n.onCalendarChange, Be = n.onOk, He = n.defaultPickerValue, je = n.pickerValue, Ke = n.onPickerValueChange, _e = n.inputReadOnly, Ye = n.suffixIcon, Z = n.onFocus, $ = n.onBlur, qe = n.presets, ze = n.ranges, N = n.components, Ge = n.cellRender, Je = n.dateRender, Le = n.monthCellRender, ee = n.onClick, E = Yn(A), Qe = _n(De, Re, s, Se), ne = m(Qe, 2), a = ne[0], Ue = ne[1], f = function(e, o) {
    !s.some(function(t) {
      return !t;
    }) && e || Ue(e, o);
  }, We = Qn(k, w, H, !0, !1, K, _, Ae, Be), O = m(We, 5), Xe = O[0], Ze = O[1], oe = O[2], R = O[3], $e = O[4], i = oe(), en = zn(s, I, a), c = m(en, 9), Y = c[0], re = c[1], P = c[2], r = c[3], nn = c[4], te = c[5], V = c[6], on = c[7], rn = c[8], le = function(e, o) {
    re(!0), Z == null || Z(e, { range: M(o ?? r) });
  }, ae = function(e, o) {
    re(!1), $ == null || $(e, { range: M(o ?? r) });
  }, D = u.useMemo(function() {
    if (!b) return null;
    var e = b.disabledTime, o = e ? function(t) {
      var l = M(r), y = An(i, V, r);
      return e(t, l, { from: y });
    } : void 0;
    return we(we({}, b), {}, { disabledTime: o });
  }, [b, r, i, V]), tn = Nn([d, d], { value: Me }), ie = m(tn, 2), x = ie[0], ln = ie[1], S = x[r] || d, T = S === "date" && D ? "datetime" : S, ue = T === d && T !== "time", an = Un(d, S, Te, Fe, !0), un = Ln(n, Xe, Ze, oe, R, s, H, Y, a, j), fe = m(un, 2), me = fe[0], ce = fe[1], fn = Gn(i, s, V, k, w, xe), mn = jn(i, j, I), pe = m(mn, 2), cn = pe[0], pn = pe[1], sn = Jn(k, w, i, x, a, r, L, ue, He, je, D == null ? void 0 : D.defaultOpenValue, Ke, Ie, Ne), se = m(sn, 2), dn = se[0], vn = se[1], de = ke(function(e, o, t) {
    var l = J(x, r, o);
    if (l[0] === x[0] && l[1] === x[1] || ln(l), X && t !== !1) {
      var y = ye(i);
      e && (y[r] = e), X(y, l);
    }
  }), q = function(e, o) {
    return J(i, o, e);
  }, v = function(e, o) {
    var t = i;
    e && (t = q(e, r)), on(r);
    var l = te(t);
    R(t), me(r, l === null), l === null ? f(!1, { force: !0 }) : o || E.current.focus({ index: l });
  }, gn = u.useState(null), ve = m(gn, 2), Cn = ve[0], ge = ve[1], hn = u.useState(null), Ce = m(hn, 2), F = Ce[0], z = Ce[1], he = u.useMemo(function() {
    return F || i;
  }, [i, F]);
  u.useEffect(function() {
    a || z(null);
  }, [a]);
  var bn = u.useState([0, 0, 0]), be = m(bn, 2), yn = be[0], wn = be[1], kn = qn(qe, ze), En = Hn(Ge, Je, Le, M(r)), On = i[r] || null, Pn = ke(function(e) {
    return j(e, { activeIndex: r });
  }), Vn = u.useMemo(function() {
    var e = Sn(n, !1);
    return Dn(n, [].concat(ye(Object.keys(e)), ["onChange", "onCalendarChange", "style", "className", "onPanelChange", "disabledTime"]));
  }, [n]), xn = u.createElement(Wn, G({}, Vn, { showNow: an, showTime: D, range: !0, multiplePanel: ue, activeInfo: yn, disabledDate: fn, onFocus: function(e) {
    f(!0), le(e);
  }, onBlur: ae, onPanelMouseDown: function() {
    P("panel");
  }, picker: d, mode: S, internalMode: T, onPanelChange: de, format: Q, value: On, isInvalid: Pn, onChange: null, onSelect: function(e) {
    var o = J(i, r, e);
    R(o), h || B || L !== T || v(e);
  }, pickerValue: dn, defaultOpenValue: Mn(b == null ? void 0 : b.defaultOpenValue)[r], onPickerValueChange: vn, hoverValue: he, onHover: function(e) {
    z(e ? q(e, r) : null), ge("cell");
  }, needConfirm: h, onSubmit: v, onOk: $e, presets: kn, onPresetHover: function(e) {
    z(e), ge("preset");
  }, onPresetSubmit: function(e) {
    ce(e) && f(!1, { force: !0 });
  }, onNow: function(e) {
    v(e);
  }, cellRender: En })), In = u.useMemo(function() {
    return { prefixCls: U, locale: w, generateConfig: k, button: N.button, input: N.input };
  }, [U, w, k, N.button, N.input]);
  return Ee(function() {
    a && r !== void 0 && de(null, d, !1);
  }, [a, r, d]), Ee(function() {
    var e = P();
    a || e !== "input" || (f(!1), v(null, !0)), a || !B || h || e !== "panel" || (f(!0), v());
  }, [a]), process.env.NODE_ENV !== "production" && s.some(function(e, o) {
    return e && function(t) {
      return !(_ != null && _[t] || K != null && K[t]);
    }(o) && !I[o];
  }) && Rn(!1, "`disabled` should not set with empty `value`. You should set `allowEmpty` or `value` instead."), u.createElement(Bn.Provider, { value: In }, u.createElement(Tn, G({}, Fn(n), { popupElement: xn, popupStyle: Pe.popup, popupClassName: Ve.popup, visible: a, onClose: function() {
    f(!1);
  }, range: !0 }), u.createElement(Xn, G({}, n, { ref: E, suffixIcon: Ye, activeIndex: Y || a ? r : null, activeHelp: !!F, allHelp: !!F && Cn === "preset", focused: Y, onFocus: function(e, o) {
    var t = V.length, l = V[t - 1];
    t && l !== o && h && !I[l] && !rn(l) && i[l] ? E.current.focus({ index: l }) : (P("input"), f(!0, { inherit: !0 }), r !== o && a && !h && B && v(null, !0), nn(o), le(e, o));
  }, onBlur: function(e, o) {
    if (f(!1), !h && P() === "input") {
      var t = te(i);
      me(r, t === null);
    }
    ae(e, o);
  }, onKeyDown: function(e, o) {
    e.key === "Tab" && v(null, !0), W == null || W(e, o);
  }, onSubmit: v, value: he, maskFormat: Q, onChange: function(e, o) {
    var t = q(e, o);
    R(t);
  }, onInputChange: function() {
    P("input");
  }, format: H, inputReadOnly: _e, disabled: s, open: a, onOpenChange: f, onClick: function(e) {
    var o, t = e.target.getRootNode();
    if (!E.current.nativeElement.contains((o = t.activeElement) !== null && o !== void 0 ? o : document.activeElement)) {
      var l = s.findIndex(function(y) {
        return !y;
      });
      l >= 0 && E.current.focus({ index: l });
    }
    f(!0), ee == null || ee(e);
  }, onClear: function() {
    ce(null), f(!1, { force: !0 });
  }, invalid: cn, onInvalid: pn, onActiveInfo: wn }))));
}
var $n = u.forwardRef(Zn);
process.env.NODE_ENV !== "production" && ($n.displayName = "RefRangePicker");
export {
  $n as default
};
