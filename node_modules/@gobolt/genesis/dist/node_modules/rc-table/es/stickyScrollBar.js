import I from "../../@babel/runtime/helpers/esm/defineProperty.js";
import s from "../../@babel/runtime/helpers/esm/objectSpread2.js";
import M from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import { useContext as U } from "../../@rc-component/context/es/context.js";
import "../../rc-util/es/ref.js";
import * as t from "react";
import q from "../../../_virtual/index.js";
import k from "../../rc-util/es/Dom/addEventListener.js";
import R from "../../rc-util/es/getScrollBarSize.js";
import A from "./context/TableContext.js";
import { useLayoutState as F } from "./hooks/useFrame.js";
import y from "../../rc-util/es/raf.js";
import { getOffset as W } from "./utils/offsetUtil.js";
import { getDOM as G } from "../../rc-util/es/Dom/findDOMNode.js";
var J = function(d, D) {
  var w, E, c = d.scrollBodyRef, X = d.onScroll, B = d.offsetScroll, u = d.container, z = d.direction, L = U(A, "prefixCls"), m = ((w = c.current) === null || w === void 0 ? void 0 : w.scrollWidth) || 0, n = ((E = c.current) === null || E === void 0 ? void 0 : E.clientWidth) || 0, f = m && n * (n / m), N = t.useRef(), C = F({ scrollLeft: 0, isHiddenScrollBar: !0 }), H = M(C, 2), v = H[0], p = H[1], a = t.useRef({ delta: 0, x: 0 }), O = t.useState(!1), g = M(O, 2), h = g[0], S = g[1], x = t.useRef(null);
  t.useEffect(function() {
    return function() {
      y.cancel(x.current);
    };
  }, []);
  var T = function() {
    S(!1);
  }, V = function(e) {
    var r, i = (e || ((r = window) === null || r === void 0 ? void 0 : r.event)).buttons;
    if (h && i !== 0) {
      var l = a.current.x + e.pageX - a.current.x - a.current.delta, b = z === "rtl";
      l = Math.max(b ? f - n : 0, Math.min(b ? 0 : n - f, l)), (!b || Math.abs(l) + Math.abs(f) < n) && (X({ scrollLeft: l / n * (m + 2) }), a.current.x = e.pageX);
    } else h && S(!1);
  }, o = function() {
    y.cancel(x.current), x.current = y(function() {
      if (c.current) {
        var e = W(c.current).top, r = e + c.current.offsetHeight, i = u === window ? document.documentElement.scrollTop + window.innerHeight : W(u).top + u.clientHeight;
        r - R() <= i || e >= i - B ? p(function(l) {
          return s(s({}, l), {}, { isHiddenScrollBar: !0 });
        }) : p(function(l) {
          return s(s({}, l), {}, { isHiddenScrollBar: !1 });
        });
      }
    });
  }, j = function(e) {
    p(function(r) {
      return s(s({}, r), {}, { scrollLeft: e / m * n || 0 });
    });
  };
  return t.useImperativeHandle(D, function() {
    return { setScrollLeft: j, checkScrollBarVisible: o };
  }), t.useEffect(function() {
    var e = k(document.body, "mouseup", T, !1), r = k(document.body, "mousemove", V, !1);
    return o(), function() {
      e.remove(), r.remove();
    };
  }, [f, h]), t.useEffect(function() {
    if (c.current) {
      for (var e = [], r = G(c.current); r; ) e.push(r), r = r.parentElement;
      return e.forEach(function(i) {
        return i.addEventListener("scroll", o, !1);
      }), window.addEventListener("resize", o, !1), window.addEventListener("scroll", o, !1), u.addEventListener("scroll", o, !1), function() {
        e.forEach(function(i) {
          return i.removeEventListener("scroll", o);
        }), window.removeEventListener("resize", o), window.removeEventListener("scroll", o), u.removeEventListener("scroll", o);
      };
    }
  }, [u]), t.useEffect(function() {
    v.isHiddenScrollBar || p(function(e) {
      var r = c.current;
      return r ? s(s({}, e), {}, { scrollLeft: r.scrollLeft / r.scrollWidth * r.clientWidth }) : e;
    });
  }, [v.isHiddenScrollBar]), m <= n || !f || v.isHiddenScrollBar ? null : t.createElement("div", { style: { height: R(), width: n, bottom: B }, className: "".concat(L, "-sticky-scroll") }, t.createElement("div", { onMouseDown: function(e) {
    e.persist(), a.current.delta = e.pageX - v.scrollLeft, a.current.x = 0, S(!0), e.preventDefault();
  }, ref: N, className: q("".concat(L, "-sticky-scroll-bar"), I({}, "".concat(L, "-sticky-scroll-bar-active"), h)), style: { width: "".concat(f, "px"), transform: "translate3d(".concat(v.scrollLeft, "px, 0, 0)") } }));
};
const ie = t.forwardRef(J);
export {
  ie as default
};
