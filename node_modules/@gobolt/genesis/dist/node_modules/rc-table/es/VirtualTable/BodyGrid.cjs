"use strict";const oe=require("../../../@babel/runtime/helpers/esm/typeof.cjs"),ie=require("../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),k=require("../../../@rc-component/context/es/context.cjs");require("../../../rc-util/es/ref.cjs");const ue=require("react"),le=require("../../../rc-virtual-list/es/List.cjs"),G=require("../context/TableContext.cjs"),ce=require("../hooks/useFlattenRecords.cjs"),I=require("./BodyLine.cjs"),P=require("./context.cjs");function ae(u){const v=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(u){for(const a in u)if(a!=="default"){const x=Object.getOwnPropertyDescriptor(u,a);Object.defineProperty(v,a,x.get?x:{enumerable:!0,get:()=>u[a]})}}return v.default=u,Object.freeze(v)}const i=ae(ue);var fe=i.forwardRef(function(u,v){var a=u.data,x=u.onScroll,l=k.useContext(G.default,["flattenColumns","onColumnResize","getRowKey","prefixCls","expandedKeys","childrenColumnName","scrollX","direction"]),m=l.flattenColumns,L=l.onColumnResize,p=l.getRowKey,V=l.expandedKeys,X=l.prefixCls,Y=l.childrenColumnName,_=l.scrollX,B=l.direction,g=k.useContext(P.StaticContext),C=g.sticky,W=g.scrollY,A=g.listItemHeight,F=g.getComponent,J=g.onScroll,f=i.useRef(),s=ce(a,Y,V,p),b=i.useMemo(function(){var r=0;return m.map(function(t){var e=t.width;return[t.key,e,r+=e]})},[m]),K=i.useMemo(function(){return b.map(function(r){return r[2]})},[b]);i.useEffect(function(){b.forEach(function(r){var t=ie(r,2),e=t[0],o=t[1];L(e,o)})},[b]),i.useImperativeHandle(v,function(){var r,t={scrollTo:function(e){var o;(o=f.current)===null||o===void 0||o.scrollTo(e)},nativeElement:(r=f.current)===null||r===void 0?void 0:r.nativeElement};return Object.defineProperty(t,"scrollLeft",{get:function(){var e;return((e=f.current)===null||e===void 0?void 0:e.getScrollInfo().x)||0},set:function(e){var o;(o=f.current)===null||o===void 0||o.scrollTo({left:e})}}),t});var y=function(r,t){var e,o=(e=s[t])===null||e===void 0?void 0:e.record,E=r.onCell;if(E){var d,h=E(o,t);return(d=h==null?void 0:h.rowSpan)!==null&&d!==void 0?d:1}return 1},Q=i.useMemo(function(){return{columnsOffset:K}},[K]),N="".concat(X,"-tbody"),U=F(["body","wrapper"]),S={};return C&&(S.position="sticky",S.bottom=0,oe(C)==="object"&&C.offsetScroll&&(S.bottom=C.offsetScroll)),i.createElement(P.GridContext.Provider,{value:Q},i.createElement(le.default,{fullHeight:!1,ref:f,prefixCls:"".concat(N,"-virtual"),styles:{horizontalScrollBar:S},className:N,height:W,itemHeight:A||24,data:s,itemKey:function(r){return p(r.record)},component:U,scrollWidth:_,direction:B,onVirtualScroll:function(r){var t,e=r.x;x({currentTarget:(t=f.current)===null||t===void 0?void 0:t.nativeElement,scrollLeft:e})},onScroll:J,extraRender:function(r){var t=r.start,e=r.end,o=r.getSize,E=r.offsetY;if(e<0)return null;for(var d=m.filter(function(n){return y(n,t)===0}),h=t,Z=function(n){if(!(d=d.filter(function(c){return y(c,n)===0})).length)return h=n,1},q=t;q>=0&&!Z(q);q-=1);for(var j=m.filter(function(n){return y(n,e)!==1}),z=e,$=function(n){if(!(j=j.filter(function(c){return y(c,n)!==1})).length)return z=Math.max(n-1,e),1},w=e;w<s.length&&!$(w);w+=1);for(var H=[],ee=function(n){if(!s[n])return 1;m.some(function(c){return y(c,n)>1})&&H.push(n)},R=h;R<=z;R+=1)ee(R);return H.map(function(n){var c=s[n],O=p(c.record,n),re=o(O);return i.createElement(I,{key:n,data:c,rowKey:O,index:n,style:{top:-E+re.top},extra:!0,getHeight:function(te){var M=n+te-1,ne=p(s[M].record,M),T=o(O,ne);return T.bottom-T.top}})})}},function(r,t,e){var o=p(r.record,t);return i.createElement(I,{data:r,rowKey:o,index:t,style:e.style})}))}),D=G.responseImmutable(fe);process.env.NODE_ENV!=="production"&&(D.displayName="ResponseGrid"),module.exports=D;
