"use strict";const qt=require("../../../@babel/runtime/helpers/esm/extends.cjs"),z=require("../../../@babel/runtime/helpers/esm/defineProperty.cjs"),Fe=require("../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),G=require("../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),u=require("../../../@babel/runtime/helpers/esm/slicedToArray.cjs"),ce=require("../../../../_virtual/index.cjs"),ue=require("../../../rc-resize-observer/es/index.cjs"),Bt=require("../../../rc-util/es/hooks/useEvent.cjs"),jt=require("../../../rc-util/es/ref.cjs"),o=require("react"),Kt=require("../TabContext.cjs"),Pt=require("../hooks/useIndicator.cjs"),Ut=require("../hooks/useOffsets.cjs"),Ge=require("../hooks/useSyncState.cjs"),Ht=require("../hooks/useTouchMove.cjs"),Ve=require("../hooks/useUpdate.cjs"),Wt=require("../hooks/useVisibleRange.cjs"),V=require("../util.cjs"),It=require("./AddButton.cjs"),Je=require("./ExtraContent.cjs"),_t=require("./OperationNode.cjs"),Ft=require("./TabNode.cjs");function Gt(n){const d=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const v in n)if(v!=="default"){const k=Object.getOwnPropertyDescriptor(n,v);Object.defineProperty(d,v,k.get?k:{enumerable:!0,get:()=>n[v]})}}return d.default=n,Object.freeze(d)}const c=Gt(o);var C=function(n){var d=n.current||{},v=d.offsetWidth,k=v===void 0?0:v,N=d.offsetHeight,Q=N===void 0?0:N;if(n.current){var w=n.current.getBoundingClientRect(),l=w.width,q=w.height;if(Math.abs(l-k)<1)return[l,q]}return[k,Q]},J=function(n,d){return n[d?0:1]},Vt=c.forwardRef(function(n,d){var v=n.className,k=n.style,N=n.id,Q=n.animated,w=n.activeKey,l=n.rtl,q=n.extra,B=n.editable,M=n.locale,le=n.tabPosition,fe=n.tabBarGutter,Qe=n.children,se=n.onTabClick,j=n.onTabScroll,Xe=n.indicator,de=c.useContext(Kt),f=de.prefixCls,g=de.tabs,ve=o.useRef(null),ge=o.useRef(null),pe=o.useRef(null),T=o.useRef(null),K=o.useRef(null),he=o.useRef(null),me=o.useRef(null),i=le==="top"||le==="bottom",Ye=Ge(0,function(e,t){i&&j&&j({direction:e>t?"left":"right"})}),be=u(Ye,2),s=be[0],X=be[1],Ze=Ge(0,function(e,t){!i&&j&&j({direction:e>t?"top":"bottom"})}),ye=u(Ze,2),E=ye[0],Y=ye[1],$e=o.useState([0,0]),we=u($e,2),et=we[0],tt=we[1],nt=o.useState([0,0]),ke=u(nt,2),Ee=ke[0],rt=ke[1],it=o.useState([0,0]),Re=u(it,2),ot=Re[0],at=Re[1],ct=o.useState([0,0]),xe=u(ct,2),ut=xe[0],lt=xe[1],ft=Ve.useUpdateState(new Map),De=u(ft,2),st=De[0],dt=De[1],P=Ut(g,st,Ee[0]),Z=J(et,i),U=J(Ee,i),$=J(ot,i),Se=J(ut,i),Ce=Math.floor(Z)<Math.floor(U+$),p=Ce?Z-Se:Z-$,vt="".concat(f,"-nav-operations-hidden"),R=0,x=0;function ee(e){return e<R?R:e>x?x:e}i&&l?(R=0,x=Math.max(0,U-p)):(R=Math.min(0,p-U),x=0);var te=o.useRef(null),gt=o.useState(),Me=u(gt,2),H=Me[0],Te=Me[1];function ne(){Te(Date.now())}function re(){te.current&&clearTimeout(te.current)}Ht(T,function(e,t){function r(a,m){a(function(b){return ee(b+m)})}return!!Ce&&(i?r(X,e):r(Y,t),re(),ne(),!0)}),o.useEffect(function(){return re(),H&&(te.current=setTimeout(function(){Te(0)},100)),re},[H]);var pt=Wt(P,p,i?s:E,U,$,Se,G(G({},n),{},{tabs:g})),Ae=u(pt,2),ht=Ae[0],mt=Ae[1],Le=Bt(function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:w,t=P.get(e)||{width:0,height:0,left:0,right:0,top:0};if(i){var r=s;l?t.right<s?r=t.right:t.right+t.width>s+p&&(r=t.right+t.width-p):t.left<-s?r=-t.left:t.left+t.width>-s+p&&(r=-(t.left+t.width-p)),Y(0),X(ee(r))}else{var a=E;t.top<-E?a=-t.top:t.top+t.height>-E+p&&(a=-(t.top+t.height-p)),X(0),Y(ee(a))}}),bt=o.useState(),Oe=u(bt,2),D=Oe[0],A=Oe[1],yt=o.useState(!1),ze=u(yt,2),wt=ze[0],Ne=ze[1],h=g.filter(function(e){return!e.disabled}).map(function(e){return e.key}),S=function(e){var t=h.indexOf(D||w),r=h.length,a=h[(t+e+r)%r];A(a)},kt=function(e){var t=e.code,r=l&&i,a=h[0],m=h[h.length-1];switch(t){case"ArrowLeft":i&&S(r?1:-1);break;case"ArrowRight":i&&S(r?-1:1);break;case"ArrowUp":e.preventDefault(),i||S(-1);break;case"ArrowDown":e.preventDefault(),i||S(1);break;case"Home":e.preventDefault(),A(a);break;case"End":e.preventDefault(),A(m);break;case"Enter":case"Space":e.preventDefault(),se(D,e);break;case"Backspace":case"Delete":var b=h.indexOf(D),y=g.find(function(ae){return ae.key===D});V.getRemovable(y==null?void 0:y.closable,y==null?void 0:y.closeIcon,B,y==null?void 0:y.disabled)&&(e.preventDefault(),e.stopPropagation(),B.onEdit("remove",{key:D,event:e}),b===h.length-1?S(-1):S(1))}},W={};i?W[l?"marginRight":"marginLeft"]=fe:W.marginTop=fe;var qe=g.map(function(e,t){var r=e.key;return c.createElement(Ft,{id:N,prefixCls:f,key:r,tab:e,style:t===0?void 0:W,closable:e.closable,editable:B,active:r===w,focus:r===D,renderWrapper:Qe,removeAriaLabel:M==null?void 0:M.removeAriaLabel,tabCount:h.length,currentPosition:t+1,onClick:function(a){se(r,a)},onKeyDown:kt,onFocus:function(){wt||A(r),Le(r),ne(),T.current&&(l||(T.current.scrollLeft=0),T.current.scrollTop=0)},onBlur:function(){A(void 0)},onMouseDown:function(){Ne(!0)},onMouseUp:function(){Ne(!1)}})}),Be=function(){return dt(function(){var e,t=new Map,r=(e=K.current)===null||e===void 0?void 0:e.getBoundingClientRect();return g.forEach(function(a){var m,b=a.key,y=(m=K.current)===null||m===void 0?void 0:m.querySelector('[data-node-key="'.concat(V.genDataNodeKey(b),'"]'));if(y){var ae=function(O,We){var Ie=O.offsetWidth,Tt=O.offsetHeight,At=O.offsetTop,Lt=O.offsetLeft,F=O.getBoundingClientRect(),_e=F.width,Ot=F.height,zt=F.left,Nt=F.top;return Math.abs(_e-Ie)<1?[_e,Ot,zt-We.left,Nt-We.top]:[Ie,Tt,Lt,At]}(y,r),_=u(ae,4),Dt=_[0],St=_[1],Ct=_[2],Mt=_[3];t.set(b,{width:Dt,height:St,left:Ct,top:Mt})}}),t})};o.useEffect(function(){Be()},[g.map(function(e){return e.key}).join("_")]);var I=Ve.default(function(){var e=C(ve),t=C(ge),r=C(pe);tt([e[0]-t[0]-r[0],e[1]-t[1]-r[1]]);var a=C(me);at(a);var m=C(he);lt(m);var b=C(K);rt([b[0]-a[0],b[1]-a[1]]),Be()}),Et=g.slice(0,ht),Rt=g.slice(mt+1),je=[].concat(Fe(Et),Fe(Rt)),Ke=P.get(w),xt=Pt({activeTabOffset:Ke,horizontal:i,indicator:Xe,rtl:l}).style;o.useEffect(function(){Le()},[w,R,x,V.stringify(Ke),V.stringify(P),i]),o.useEffect(function(){I()},[l]);var ie,oe,Pe,Ue,He=!!je.length,L="".concat(f,"-nav-wrap");return i?l?(oe=s>0,ie=s!==x):(ie=s<0,oe=s!==R):(Pe=E<0,Ue=E!==R),c.createElement(ue,{onResize:I},c.createElement("div",{ref:jt.useComposeRef(d,ve),role:"tablist","aria-orientation":i?"horizontal":"vertical",className:ce("".concat(f,"-nav"),v),style:k,onKeyDown:function(){ne()}},c.createElement(Je,{ref:ge,position:"left",extra:q,prefixCls:f}),c.createElement(ue,{onResize:I},c.createElement("div",{className:ce(L,z(z(z(z({},"".concat(L,"-ping-left"),ie),"".concat(L,"-ping-right"),oe),"".concat(L,"-ping-top"),Pe),"".concat(L,"-ping-bottom"),Ue)),ref:T},c.createElement(ue,{onResize:I},c.createElement("div",{ref:K,className:"".concat(f,"-nav-list"),style:{transform:"translate(".concat(s,"px, ").concat(E,"px)"),transition:H?"none":void 0}},qe,c.createElement(It,{ref:me,prefixCls:f,locale:M,editable:B,style:G(G({},qe.length===0?void 0:W),{},{visibility:He?"hidden":null})}),c.createElement("div",{className:ce("".concat(f,"-ink-bar"),z({},"".concat(f,"-ink-bar-animated"),Q.inkBar)),style:xt}))))),c.createElement(_t,qt({},n,{removeAriaLabel:M==null?void 0:M.removeAriaLabel,ref:he,prefixCls:f,tabs:je,className:!He&&vt,tabMoving:!!H})),c.createElement(Je,{ref:pe,position:"right",extra:q,prefixCls:f})))});module.exports=Vt;
