import h from "../../../../@babel/runtime/helpers/esm/slicedToArray.js";
import w from "../../../../@babel/runtime/helpers/esm/toConsumableArray.js";
import _ from "../../../../@babel/runtime/helpers/esm/objectSpread2.js";
import A from "../../../../@emotion/hash/dist/hash.browser.esm.js";
import { updateCSS as M } from "../../../../rc-util/es/Dom/dynamicCSS.js";
import { useContext as V } from "react";
import j, { ATTR_TOKEN as I, CSS_IN_JS_INSTANCE as O, ATTR_MARK as F } from "../StyleContext.js";
import { memoResult as J, flattenToken as g, token2key as x, toStyleStr as P } from "../util/index.js";
import { transformToken as Q } from "../util/css-variables.js";
import X from "./useGlobalCache.js";
var z = {}, B = process.env.NODE_ENV !== "production" ? "css-dev-only-do-not-override" : "css", f = /* @__PURE__ */ new Map();
function G(a, s) {
  f.set(a, (f.get(a) || 0) - 1);
  var t = Array.from(f.keys()), r = t.filter(function(o) {
    return (f.get(o) || 0) <= 0;
  });
  t.length - r.length > 0 && r.forEach(function(o) {
    (function(i, l) {
      typeof document < "u" && document.querySelectorAll("style[".concat(I, '="').concat(i, '"]')).forEach(function(c) {
        var u;
        c[O] === l && ((u = c.parentNode) === null || u === void 0 || u.removeChild(c));
      });
    })(o, s), f.delete(o);
  });
}
var H = function(a, s, t, r) {
  var o = t.getDerivativeToken(a), i = _(_({}, o), s);
  return r && (i = r(i)), i;
}, L = "token";
function ae(a, s) {
  var t = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : {}, r = V(j), o = r.cache.instanceId, i = r.container, l = t.salt, c = l === void 0 ? "" : l, u = t.override, p = u === void 0 ? z : u, b = t.formatToken, K = t.getComputedToken, e = t.cssVar, k = J(function() {
    return Object.assign.apply(Object, [{}].concat(w(s)));
  }, s), R = g(k), q = g(p), D = e ? g(e) : "";
  return X(L, [c, a.id, R, q, D], function() {
    var m, n = K ? K(k, p, a) : H(k, p, a, b), v = _({}, n), d = "";
    if (e) {
      var y = Q(n, e.key, { prefix: e.prefix, ignore: e.ignore, unitless: e.unitless, preserve: e.preserve }), S = h(y, 2);
      n = S[0], d = S[1];
    }
    var T = x(n, c);
    n._tokenKey = T, v._tokenKey = x(v, c);
    var C = (m = e == null ? void 0 : e.key) !== null && m !== void 0 ? m : T;
    n._themeKey = C, function(N) {
      f.set(N, (f.get(N) || 0) + 1);
    }(C);
    var E = "".concat(B, "-").concat(A(T));
    return n._hashId = E, [n, E, v, d, (e == null ? void 0 : e.key) || ""];
  }, function(m) {
    G(m[0]._themeKey, o);
  }, function(m) {
    var n = h(m, 4), v = n[0], d = n[3];
    if (e && d) {
      var y = M(d, A("css-variables-".concat(v._themeKey)), { mark: F, prepend: "queue", attachTo: i, priority: -999 });
      y[O] = o, y.setAttribute(I, v._themeKey);
    }
  });
}
var ie = function(a, s, t) {
  var r = h(a, 5), o = r[2], i = r[3], l = r[4], c = (t || {}).plain;
  if (!i) return null;
  var u = o._tokenKey, p = { "data-rc-order": "prependQueue", "data-rc-priority": "".concat(-999) };
  return [-999, u, P(i, l, u, p, c)];
};
export {
  L as TOKEN_PREFIX,
  ae as default,
  ie as extract,
  H as getComputedToken
};
