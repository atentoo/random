"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const P=require("../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),F=require("../../../@babel/runtime/helpers/esm/defineProperty.cjs"),g=require("../../../@babel/runtime/helpers/esm/regeneratorRuntime.cjs"),w=require("../../../@babel/runtime/helpers/esm/objectSpread2.cjs"),k=require("../../../@babel/runtime/helpers/esm/asyncToGenerator.cjs"),A=require("../../../@rc-component/async-validator/es/index.cjs"),C=require("react"),R=require("../../../rc-util/es/warning.cjs"),T=require("./messages.cjs"),V=require("../../../rc-util/es/utils/set.cjs");function z(o){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const r in o)if(r!=="default"){const u=Object.getOwnPropertyDescriptor(o,r);Object.defineProperty(a,r,u.get?u:{enumerable:!0,get:()=>o[r]})}}return a.default=o,Object.freeze(a)}const E=z(C);var I=A;function G(o,a){return o.replace(/\\?\$\{\w+\}/g,function(r){if(r.startsWith("\\"))return r.slice(1);var u=r.slice(2,-1);return a[u]})}var M="CODE_LOGIC_ERROR";function _(o,a,r,u,l){return j.apply(this,arguments)}function j(){return j=k(g().mark(function o(a,r,u,l,h){var i,x,m,b,n,s,f,d,p;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return delete(i=w({},u)).ruleIndex,I.warning=function(){},i.validator&&(x=i.validator,i.validator=function(){try{return x.apply(void 0,arguments)}catch(c){return console.error(c),Promise.reject(M)}}),m=null,i&&i.type==="array"&&i.defaultField&&(m=i.defaultField,delete i.defaultField),b=new I(F({},a,[i])),n=V.merge(T.defaultValidateMessages,l.validateMessages),b.messages(n),s=[],e.prev=10,e.next=13,Promise.resolve(b.validate(F({},a,r),w({},l)));case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),e.t0.errors&&(s=e.t0.errors.map(function(c,t){var y=c.message,v=y===M?n.default:y;return E.isValidElement(v)?E.cloneElement(v,{key:"error_".concat(t)}):v}));case 18:if(s.length||!m){e.next=23;break}return e.next=21,Promise.all(r.map(function(c,t){return _("".concat(a,".").concat(t),c,m,l,h)}));case 21:return f=e.sent,e.abrupt("return",f.reduce(function(c,t){return[].concat(P(c),P(t))},[]));case 23:return d=w(w({},u),{},{name:a,enum:(u.enum||[]).join(", ")},h),p=s.map(function(c){return typeof c=="string"?G(c,d):c}),e.abrupt("return",p);case 26:case"end":return e.stop()}},o,null,[[10,15]])})),j.apply(this,arguments)}function S(){return(S=k(g().mark(function o(a){return g().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(a).then(function(u){var l;return(l=[]).concat.apply(l,P(u))}));case 1:case"end":return r.stop()}},o)}))).apply(this,arguments)}function D(){return(D=k(g().mark(function o(a){var r;return g().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=0,u.abrupt("return",new Promise(function(l){a.forEach(function(h){h.then(function(i){i.errors.length&&l([i]),(r+=1)===a.length&&l([])})})}));case 2:case"end":return u.stop()}},o)}))).apply(this,arguments)}exports.validateRules=function(o,a,r,u,l,h){var i,x=o.join("."),m=r.map(function(n,s){var f=n.validator,d=w(w({},n),{},{ruleIndex:s});return f&&(d.validator=function(p,e,c){var t=!1,y=f(p,e,function(){for(var v=arguments.length,q=new Array(v),O=0;O<v;O++)q[O]=arguments[O];Promise.resolve().then(function(){R.warningOnce(!t,"Your validator function has already return a promise. `callback` will be ignored."),t||c.apply(void 0,q)})});t=y&&typeof y.then=="function"&&typeof y.catch=="function",R.warningOnce(t,"`callback` is deprecated. Please return a promise instead."),t&&y.then(function(){c()}).catch(function(v){c(v||" ")})}),d}).sort(function(n,s){var f=n.warningOnly,d=n.ruleIndex,p=s.warningOnly,e=s.ruleIndex;return!!f==!!p?d-e:f?1:-1});if(l===!0)i=new Promise(function(){var n=k(g().mark(function s(f,d){var p,e,c;return g().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:p=0;case 1:if(!(p<m.length)){t.next=12;break}return e=m[p],t.next=5,_(x,a,e,u,h);case 5:if(!(c=t.sent).length){t.next=9;break}return d([{errors:c,rule:e}]),t.abrupt("return");case 9:p+=1,t.next=1;break;case 12:f([]);case 13:case"end":return t.stop()}},s)}));return function(s,f){return n.apply(this,arguments)}}());else{var b=m.map(function(n){return _(x,a,n,u,h).then(function(s){return{errors:s,rule:n}})});i=(l?function(n){return D.apply(this,arguments)}(b):function(n){return S.apply(this,arguments)}(b)).then(function(n){return Promise.reject(n)})}return i.catch(function(n){return n}),i};
