"use strict";const b=require("../../@babel/runtime/helpers/esm/objectSpread2.cjs"),o=require("../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),D=require("react"),N=require("../../rc-util/es/warning.cjs"),q=require("./FieldContext.cjs"),M=require("./Field.cjs"),g=require("./utils/valueUtil.cjs"),E=require("./ListContext.cjs");function T(i){const c=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const s in i)if(s!=="default"){const v=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(c,s,v.get?v:{enumerable:!0,get:()=>i[s]})}}return c.default=i,Object.freeze(c)}const u=T(D);module.exports=function(i){var c=i.name,s=i.initialValue,v=i.children,w=i.rules,x=i.validateTrigger,O=i.isListField,y=u.useContext(q.default),P=u.useContext(E),n=u.useRef({keys:[],id:0}).current,l=u.useMemo(function(){var a=g.getNamePath(y.prefixName)||[];return[].concat(o(a),o(g.getNamePath(c)))},[y.prefixName,c]),V=u.useMemo(function(){return b(b({},y),{},{prefixName:l})},[y,l]),j=u.useMemo(function(){return{getKey:function(a){var f=l.length,d=a[f];return[n.keys[d],a.slice(f+1)]}}},[l]);return typeof v!="function"?(N.warningOnce(!1,"Form.List only accepts function as children."),null):u.createElement(E.Provider,{value:j},u.createElement(q.default.Provider,{value:V},u.createElement(M,{name:[],shouldUpdate:function(a,f,d){return d.source!=="internal"&&a!==f},rules:w,validateTrigger:x,initialValue:s,isList:!0,isListField:O??!!P},function(a,f){var d=a.value,F=d===void 0?[]:d,m=a.onChange,L=y.getFieldValue,p=function(){return L(l||[])||[]},A={add:function(r,e){var t=p();e>=0&&e<=t.length?(n.keys=[].concat(o(n.keys.slice(0,e)),[n.id],o(n.keys.slice(e))),m([].concat(o(t.slice(0,e)),[r],o(t.slice(e))))):(process.env.NODE_ENV!=="production"&&(e<0||e>t.length)&&N.warningOnce(!1,"The second parameter of the add function should be a valid positive number."),n.keys=[].concat(o(n.keys),[n.id]),m([].concat(o(t),[r]))),n.id+=1},remove:function(r){var e=p(),t=new Set(Array.isArray(r)?r:[r]);t.size<=0||(n.keys=n.keys.filter(function(C,k){return!t.has(k)}),m(e.filter(function(C,k){return!t.has(k)})))},move:function(r,e){if(r!==e){var t=p();r<0||r>=t.length||e<0||e>=t.length||(n.keys=g.move(n.keys,r,e),m(g.move(t,r,e)))}}},h=F||[];return Array.isArray(h)||(h=[],process.env.NODE_ENV!=="production"&&N.warningOnce(!1,"Current value of '".concat(l.join(" > "),"' is not an array type."))),v(h.map(function(r,e){var t=n.keys[e];return t===void 0&&(n.keys[e]=n.id,t=n.keys[e],n.id+=1),{name:e,key:t,isListField:!0}}),A,f)})))};
