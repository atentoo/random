import m from "../../@babel/runtime/helpers/esm/objectSpread2.js";
import p from "../../@babel/runtime/helpers/esm/defineProperty.js";
import h from "../../@babel/runtime/helpers/esm/slicedToArray.js";
import K from "../../../_virtual/index.js";
import x from "../../rc-util/es/raf.js";
import * as e from "react";
import { getPageXY as Q } from "./hooks/useScrollDrag.js";
var pe = e.forwardRef(function(t, W) {
  var X = t.prefixCls, Z = t.rtl, v = t.scrollOffset, $ = t.scrollRange, U = t.onStartMove, ee = t.onStopMove, te = t.onScroll, o = t.horizontal, g = t.spinSize, w = t.containerSize, re = t.style, ne = t.thumbStyle, E = t.showScrollBar, oe = e.useState(!1), B = h(oe, 2), s = B[0], H = B[1], ie = e.useState(null), P = h(ie, 2), C = P[0], ae = P[1], ue = e.useState(null), M = h(ue, 2), O = M[0], ce = M[1], b = !Z, S = e.useRef(), k = e.useRef(), se = e.useState(E), I = h(se, 2), V = I[0], _ = I[1], L = e.useRef(), R = function() {
    E !== !0 && E !== !1 && (clearTimeout(L.current), _(!0), L.current = setTimeout(function() {
      _(!1);
    }, 3e3));
  }, d = $ - w || 0, y = w - g || 0, l = e.useMemo(function() {
    return v === 0 || d === 0 ? 0 : v / d * y;
  }, [v, d, y]), T = e.useRef({ top: l, dragging: s, pageY: C, startTop: O });
  T.current = { top: l, dragging: s, pageY: C, startTop: O };
  var D = function(r) {
    H(!0), ae(Q(r, o)), ce(T.current.top), U(), r.stopPropagation(), r.preventDefault();
  };
  e.useEffect(function() {
    var r = function(N) {
      N.preventDefault();
    }, a = S.current, u = k.current;
    return a.addEventListener("touchstart", r, { passive: !1 }), u.addEventListener("touchstart", D, { passive: !1 }), function() {
      a.removeEventListener("touchstart", r), u.removeEventListener("touchstart", D);
    };
  }, []);
  var j = e.useRef();
  j.current = d;
  var q = e.useRef();
  q.current = y, e.useEffect(function() {
    if (s) {
      var r, a = function(N) {
        var z = T.current, le = z.dragging, fe = z.pageY, ve = z.startTop;
        x.cancel(r);
        var A = S.current.getBoundingClientRect(), de = w / (o ? A.width : A.height);
        if (le) {
          var F = (Q(N, o) - fe) * de, Y = ve;
          !b && o ? Y -= F : Y += F;
          var G = j.current, J = q.current, me = J ? Y / J : 0, f = Math.ceil(me * G);
          f = Math.max(f, 0), f = Math.min(f, G), r = x(function() {
            te(f, o);
          });
        }
      }, u = function() {
        H(!1), ee();
      };
      return window.addEventListener("mousemove", a, { passive: !0 }), window.addEventListener("touchmove", a, { passive: !0 }), window.addEventListener("mouseup", u, { passive: !0 }), window.addEventListener("touchend", u, { passive: !0 }), function() {
        window.removeEventListener("mousemove", a), window.removeEventListener("touchmove", a), window.removeEventListener("mouseup", u), window.removeEventListener("touchend", u), x.cancel(r);
      };
    }
  }, [s]), e.useEffect(function() {
    return R(), function() {
      clearTimeout(L.current);
    };
  }, [v]), e.useImperativeHandle(W, function() {
    return { delayHidden: R };
  });
  var c = "".concat(X, "-scrollbar"), n = { position: "absolute", visibility: V ? null : "hidden" }, i = { position: "absolute", background: "rgba(0, 0, 0, 0.5)", borderRadius: 99, cursor: "pointer", userSelect: "none" };
  return o ? (n.height = 8, n.left = 0, n.right = 0, n.bottom = 0, i.height = "100%", i.width = g, b ? i.left = l : i.right = l) : (n.width = 8, n.top = 0, n.bottom = 0, b ? n.right = 0 : n.left = 0, i.width = "100%", i.height = g, i.top = l), e.createElement("div", { ref: S, className: K(c, p(p(p({}, "".concat(c, "-horizontal"), o), "".concat(c, "-vertical"), !o), "".concat(c, "-visible"), V)), style: m(m({}, n), re), onMouseDown: function(r) {
    r.stopPropagation(), r.preventDefault();
  }, onMouseMove: R }, e.createElement("div", { ref: k, className: K("".concat(c, "-thumb"), p({}, "".concat(c, "-thumb-moving"), s)), style: m(m({}, i), ne), onMouseDown: D }));
});
process.env.NODE_ENV !== "production" && (pe.displayName = "ScrollBar");
export {
  pe as default
};
