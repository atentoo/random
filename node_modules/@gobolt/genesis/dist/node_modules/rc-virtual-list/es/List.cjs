"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const Sr=require("../../@babel/runtime/helpers/esm/extends.cjs"),gr=require("../../@babel/runtime/helpers/esm/typeof.cjs"),P=require("../../@babel/runtime/helpers/esm/objectSpread2.cjs"),ze=require("../../@babel/runtime/helpers/esm/defineProperty.cjs"),R=require("../../@babel/runtime/helpers/esm/slicedToArray.cjs"),mr=require("../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),pr=require("../../../_virtual/index.cjs"),yr=require("../../rc-resize-observer/es/index.cjs"),He=require("../../rc-util/es/hooks/useEvent.cjs"),J=require("../../rc-util/es/hooks/useLayoutEffect.cjs"),c=require("react");require("../../rc-util/es/ref.cjs"),require("../../rc-util/es/warning.cjs");const Oe=require("react-dom"),Mr=require("./Filler.cjs"),qr=require("./hooks/useChildren.cjs"),wr=require("./hooks/useDiffItem.cjs"),Rr=require("./hooks/useFrameWheel.cjs"),br=require("./hooks/useGetSize.cjs"),xr=require("./hooks/useHeights.cjs"),zr=require("./hooks/useMobileTouchMove.cjs"),Hr=require("./hooks/useOriginScroll.cjs"),Or=require("./hooks/useScrollDrag.cjs"),Br=require("./hooks/useScrollTo.cjs"),Be=require("./ScrollBar.cjs"),Le=require("./utils/scrollbarUtil.cjs");function Lr(t){const O=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const y in t)if(y!=="default"){const f=Object.getOwnPropertyDescriptor(t,y);Object.defineProperty(O,y,f.get?f:{enumerable:!0,get:()=>t[y]})}}return O.default=t,Object.freeze(O)}const u=Lr(c);var Nr=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","scrollWidth","component","onScroll","onVirtualScroll","onVisibleChange","innerProps","extraRender","styles","showScrollBar"],Pr=[],Cr={overflowY:"auto",overflowAnchor:"none"};function Pe(t,O){var y=t.prefixCls,f=y===void 0?"rc-virtual-list":y,Ce=t.className,s=t.height,M=t.itemHeight,Q=t.fullHeight,Te=Q===void 0||Q,je=t.style,_=t.data,De=t.children,C=t.itemKey,Ie=t.virtual,Ve=t.direction,a=t.scrollWidth,U=t.component,Ye=U===void 0?"div":U,Z=t.onScroll,$=t.onVirtualScroll,E=t.onVisibleChange,_e=t.innerProps,ee=t.extraRender,S=t.styles,re=t.showScrollBar,te=re===void 0?"optional":re,We=mr(t,Nr),q=u.useCallback(function(e){return typeof C=="function"?C(e):e==null?void 0:e[C]},[C]),Xe=xr(q),T=R(Xe,4),Ke=T[0],ne=T[1],d=T[2],ke=T[3],g=!(Ie===!1||!s||!M),Ae=u.useMemo(function(){return Object.values(d.maps).reduce(function(e,r){return e+r},0)},[d.id,d.maps]),b=g&&_&&(Math.max(M*_.length,Ae)>s||!!a),m=Ve==="rtl",Ge=pr(f,ze({},"".concat(f,"-rtl"),m),Ce),o=_||Pr,x=c.useRef(),ie=c.useRef(),oe=c.useRef(),Fe=c.useState(0),le=R(Fe,2),p=le[0],Je=le[1],Qe=c.useState(0),ue=R(Qe,2),v=ue[0],j=ue[1],Ue=c.useState(!1),ae=R(Ue,2),Ze=ae[0],ce=ae[1],se=function(){ce(!0)},fe=function(){ce(!1)},$e={getKey:q};function z(e){Je(function(r){var n=function(l){var i=l;return Number.isNaN(X.current)||(i=Math.min(i,X.current)),i=Math.max(i,0),i}(typeof e=="function"?e(r):e);return x.current.scrollTop=n,n})}var de=c.useRef({start:0,end:o.length}),Ee=c.useRef(),er=wr(o,q),rr=R(er,1)[0];Ee.current=rr;var D=u.useMemo(function(){if(!g)return{scrollHeight:void 0,start:0,end:o.length-1,offset:void 0};var e;if(!b)return{scrollHeight:((e=ie.current)===null||e===void 0?void 0:e.offsetHeight)||0,start:0,end:o.length-1,offset:void 0};for(var r,n,l,i=0,dr=o.length,N=0;N<dr;N+=1){var vr=o[N],hr=q(vr),xe=d.get(hr),F=i+(xe===void 0?M:xe);F>=p&&r===void 0&&(r=N,n=i),F>p+s&&l===void 0&&(l=N),i=F}return r===void 0&&(r=0,n=0,l=Math.ceil(s/M)),l===void 0&&(l=o.length-1),{scrollHeight:i,start:r,end:l=Math.min(l+1,o.length-1),offset:n}},[b,g,p,o,ke,s]),w=D.scrollHeight,H=D.start,B=D.end,ve=D.offset;de.current.start=H,de.current.end=B,u.useLayoutEffect(function(){var e=d.getRecord();if(e.size===1){var r=Array.from(e)[0],n=o[H];if(n&&q(n)===r){var l=d.get(r)-M;z(function(i){return i+l})}}d.resetRecord()},[w]);var tr=u.useState({width:0,height:s}),he=R(tr,2),h=he[0],nr=he[1],Se=c.useRef(),ge=c.useRef(),ir=u.useMemo(function(){return Le.getSpinSize(h.width,a)},[h.width,a]),or=u.useMemo(function(){return Le.getSpinSize(h.height,w)},[h.height,w]),W=w-s,X=c.useRef(W);X.current=W;var I=p<=0,V=p>=W,me=v<=0,pe=v>=a,lr=Hr(I,V,me,pe),K=function(){return{x:m?-v:v,y:p}},k=c.useRef(K()),Y=He(function(e){if($){var r=P(P({},K()),e);k.current.x===r.x&&k.current.y===r.y||($(r),k.current=r)}});function ye(e,r){var n=e;r?(Oe.flushSync(function(){j(n)}),Y()):z(n)}var A=function(e){var r=e,n=a?a-h.width:0;return r=Math.max(r,0),r=Math.min(r,n)},ur=He(function(e,r){r?(Oe.flushSync(function(){j(function(n){return A(n+(m?-e:e))})}),Y()):z(function(n){return n+e})}),ar=Rr(g,I,V,me,pe,!!a,ur),Me=R(ar,2),G=Me[0],qe=Me[1];zr(g,x,function(e,r,n,l){var i=l;return!lr(e,r,n)&&(!i||!i._virtualHandled)&&(i&&(i._virtualHandled=!0),G({preventDefault:function(){},deltaX:e?r:0,deltaY:e?0:r}),!0)}),Or.default(b,x,function(e){z(function(r){return r+e})}),J.default(function(){function e(n){var l=I&&n.detail<0,i=V&&n.detail>0;!g||l||i||n.preventDefault()}var r=x.current;return r.addEventListener("wheel",G,{passive:!1}),r.addEventListener("DOMMouseScroll",qe,{passive:!0}),r.addEventListener("MozMousePixelScroll",e,{passive:!1}),function(){r.removeEventListener("wheel",G),r.removeEventListener("DOMMouseScroll",qe),r.removeEventListener("MozMousePixelScroll",e)}},[g,I,V]),J.default(function(){if(a){var e=A(v);j(e),Y({x:e})}},[h.width,a]);var we=function(){var e,r;(e=Se.current)===null||e===void 0||e.delayHidden(),(r=ge.current)===null||r===void 0||r.delayHidden()},Re=Br(x,o,d,M,q,function(){return ne(!0)},z,we);u.useImperativeHandle(O,function(){return{nativeElement:oe.current,getScrollInfo:K,scrollTo:function(e){var r;(r=e)&&gr(r)==="object"&&("left"in r||"top"in r)?(e.left!==void 0&&j(A(e.left)),Re(e.top)):Re(e)}}}),J.default(function(){if(E){var e=o.slice(H,B+1);E(e,o)}},[H,B,o]);var cr=br.useGetSize(o,q,d,M),sr=ee==null?void 0:ee({start:H,end:B,virtual:b,offsetX:v,offsetY:ve,rtl:m,getSize:cr}),fr=qr(o,H,B,a,v,Ke,De,$e),L=null;s&&(L=P(ze({},Te?"height":"maxHeight",s),Cr),g&&(L.overflowY="hidden",a&&(L.overflowX="hidden"),Ze&&(L.pointerEvents="none")));var be={};return m&&(be.dir="rtl"),u.createElement("div",Sr({ref:oe,style:P(P({},je),{},{position:"relative"}),className:Ge},be,We),u.createElement(yr,{onResize:function(e){nr({width:e.offsetWidth,height:e.offsetHeight})}},u.createElement(Ye,{className:"".concat(f,"-holder"),style:L,ref:x,onScroll:function(e){var r=e.currentTarget.scrollTop;r!==p&&z(r),Z==null||Z(e),Y()},onMouseEnter:we},u.createElement(Mr,{prefixCls:f,height:w,offsetX:v,offsetY:ve,scrollWidth:a,onInnerResize:ne,ref:ie,innerProps:_e,rtl:m,extra:sr},fr))),b&&w>s&&u.createElement(Be,{ref:Se,prefixCls:f,scrollOffset:p,scrollRange:w,rtl:m,onScroll:ye,onStartMove:se,onStopMove:fe,spinSize:or,containerSize:h.height,style:S==null?void 0:S.verticalScrollBar,thumbStyle:S==null?void 0:S.verticalScrollBarThumb,showScrollBar:te}),b&&a>h.width&&u.createElement(Be,{ref:ge,prefixCls:f,scrollOffset:v,scrollRange:a,rtl:m,onScroll:ye,onStartMove:se,onStopMove:fe,spinSize:ir,containerSize:h.width,horizontal:!0,style:S==null?void 0:S.horizontalScrollBar,thumbStyle:S==null?void 0:S.horizontalScrollBarThumb,showScrollBar:te}))}var Ne=u.forwardRef(Pe);Ne.displayName="List",exports.RawList=Pe,exports.default=Ne;
