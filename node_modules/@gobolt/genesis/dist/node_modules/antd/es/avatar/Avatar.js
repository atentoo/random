import * as t from "react";
import C from "../../../../_virtual/index.js";
import K from "../../../rc-resize-observer/es/index.js";
import { composeRef as Q } from "../../../rc-util/es/ref.js";
import { responsiveArray as X } from "../_util/responsiveObserver.js";
import { devUseWarning as Y } from "../_util/warning.js";
import "../config-provider/index.js";
import Z from "../config-provider/hooks/useCSSVarCls.js";
import ee from "../config-provider/hooks/useSize.js";
import te from "../grid/hooks/useBreakpoint.js";
import re from "./AvatarContext.js";
import se from "./style/index.js";
import { ConfigContext as ne } from "../config-provider/context.js";
var oe = function(s, g) {
  var f = {};
  for (var n in s) Object.prototype.hasOwnProperty.call(s, n) && g.indexOf(n) < 0 && (f[n] = s[n]);
  if (s != null && typeof Object.getOwnPropertySymbols == "function") {
    var l = 0;
    for (n = Object.getOwnPropertySymbols(s); l < n.length; l++) g.indexOf(n[l]) < 0 && Object.prototype.propertyIsEnumerable.call(s, n[l]) && (f[n[l]] = s[n[l]]);
  }
  return f;
};
const ae = (s, g) => {
  const [f, n] = t.useState(1), [l, w] = t.useState(!1), [E, h] = t.useState(!0), b = t.useRef(null), u = t.useRef(null), z = Q(g, b), { getPrefixCls: P, avatar: d } = t.useContext(ne), v = t.useContext(re), N = () => {
    if (!u.current || !b.current) return;
    const e = u.current.offsetWidth, r = b.current.offsetWidth;
    if (e !== 0 && r !== 0) {
      const { gap: i = 4 } = s;
      2 * i < r && n(r - 2 * i < e ? (r - 2 * i) / e : 1);
    }
  };
  t.useEffect(() => {
    w(!0);
  }, []), t.useEffect(() => {
    h(!0), n(1);
  }, [s.src]), t.useEffect(N, [s.gap]);
  const R = () => {
    const { onError: e } = s;
    (e == null ? void 0 : e()) !== !1 && h(!1);
  }, { prefixCls: _, shape: k, size: j, src: p, srcSet: A, icon: c, className: V, rootClassName: W, alt: D, draggable: I, children: O, crossOrigin: T } = s, y = oe(s, ["prefixCls", "shape", "size", "src", "srcSet", "icon", "className", "rootClassName", "alt", "draggable", "children", "crossOrigin"]), o = ee((e) => {
    var r, i;
    return (i = (r = j ?? (v == null ? void 0 : v.size)) !== null && r !== void 0 ? r : e) !== null && i !== void 0 ? i : "default";
  }), L = Object.keys(typeof o == "object" && o || {}).some((e) => ["xs", "sm", "md", "lg", "xl", "xxl"].includes(e)), x = te(L), M = t.useMemo(() => {
    if (typeof o != "object") return {};
    const e = X.find((i) => x[i]), r = o[e];
    return r ? { width: r, height: r, fontSize: r && (c || O) ? r / 2 : 18 } : {};
  }, [x, o]);
  if (process.env.NODE_ENV !== "production") {
    const e = Y("Avatar");
    process.env.NODE_ENV !== "production" && e(!(typeof c == "string" && c.length > 2), "breaking", `\`icon\` is using ReactNode instead of string naming in v4. Please check \`${c}\` at https://ant.design/components/icon`);
  }
  const a = P("avatar", _), S = Z(a), [U, q, B] = se(a, S), F = C({ [`${a}-lg`]: o === "large", [`${a}-sm`]: o === "small" }), $ = t.isValidElement(p), G = k || (v == null ? void 0 : v.shape) || "circle", H = C(a, F, d == null ? void 0 : d.className, `${a}-${G}`, { [`${a}-image`]: $ || p && E, [`${a}-icon`]: !!c }, B, S, V, W, q), J = typeof o == "number" ? { width: o, height: o, fontSize: c ? o / 2 : 18 } : {};
  let m;
  if (typeof p == "string" && E) m = t.createElement("img", { src: p, draggable: I, srcSet: A, onError: R, alt: D, crossOrigin: T });
  else if ($) m = p;
  else if (c) m = c;
  else if (l || f !== 1) {
    const e = `scale(${f})`, r = { msTransform: e, WebkitTransform: e, transform: e };
    m = t.createElement(K, { onResize: N }, t.createElement("span", { className: `${a}-string`, ref: u, style: Object.assign({}, r) }, O));
  } else m = t.createElement("span", { className: `${a}-string`, style: { opacity: 0 }, ref: u }, O);
  return delete y.onError, delete y.gap, U(t.createElement("span", Object.assign({}, y, { style: Object.assign(Object.assign(Object.assign(Object.assign({}, J), M), d == null ? void 0 : d.style), y.style), className: H, ref: z }), m));
}, ie = t.forwardRef(ae);
process.env.NODE_ENV !== "production" && (ie.displayName = "Avatar");
export {
  ie as default
};
