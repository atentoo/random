"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const S=require("../../../../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),x=require("react"),V=require("../../../_util/warning.cjs"),C=require("../../util.cjs"),F=require("./FilterDropdown.cjs");function E(r){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const o in r)if(o!=="default"){const l=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(t,o,l.get?l:{enumerable:!0,get:()=>r[o]})}}return t.default=r,Object.freeze(t)}const j=E(x),M=(r,t,o)=>{let l=[];return(r||[]).forEach((e,f)=>{var s;const c=C.getColumnPos(f,o);if(e.filters||"filterDropdown"in e||"onFilter"in e)if("filteredValue"in e){let n=e.filteredValue;"filterDropdown"in e||(n=(s=n==null?void 0:n.map(String))!==null&&s!==void 0?s:n),l.push({column:e,key:C.getColumnKey(e,c),filteredKeys:n,forceFiltered:e.filtered})}else l.push({column:e,key:C.getColumnKey(e,c),filteredKeys:t&&e.defaultFilteredValue?e.defaultFilteredValue:void 0,forceFiltered:e.filtered});"children"in e&&(l=[].concat(S(l),S(M(e.children,t,c))))}),l};function P(r,t,o,l,e,f,s,c,n){return o.map((u,g)=>{const b=C.getColumnPos(g,c),{filterOnClose:m=!0,filterMultiple:O=!0,filterMode:K,filterSearch:d}=u;let i=u;if(i.filters||i.filterDropdown){const h=C.getColumnKey(i,b),p=l.find(a=>{let{key:y}=a;return h===y});i=Object.assign(Object.assign({},i),{title:a=>j.createElement(F.default,{tablePrefixCls:r,prefixCls:`${r}-filter`,dropdownPrefixCls:t,column:i,columnKey:h,filterState:p,filterOnClose:m,filterMultiple:O,filterMode:K,filterSearch:d,triggerFilter:f,locale:e,getPopupContainer:s,rootClassName:n},C.renderColumnTitle(u.title,a))})}return"children"in i&&(i=Object.assign(Object.assign({},i),{children:P(r,t,i.children,l,e,f,s,b,n)})),i})}const v=r=>{const t={};return r.forEach(o=>{let{key:l,filteredKeys:e,column:f}=o;const s=l,{filters:c,filterDropdown:n}=f;if(n)t[s]=e||null;else if(Array.isArray(e)){const u=F.flattenKeys(c);t[s]=u.filter(g=>e.includes(String(g)))}else t[s]=null}),t},D=(r,t,o)=>t.reduce((l,e)=>{const{column:{onFilter:f,filters:s},filteredKeys:c}=e;return f&&c&&c.length?l.map(n=>Object.assign({},n)).filter(n=>c.some(u=>{const g=F.flattenKeys(s),b=g.findIndex(O=>String(O)===String(u)),m=b!==-1?g[b]:u;return n[o]&&(n[o]=D(n[o],t,o)),f(m,n)})):l},r),k=r=>r.flatMap(t=>"children"in t?[t].concat(S(k(t.children||[]))):[t]);exports.flattenKeys=F.flattenKeys,exports.default=r=>{const{prefixCls:t,dropdownPrefixCls:o,mergedColumns:l,onFilterChange:e,getPopupContainer:f,locale:s,rootClassName:c}=r,n=V.devUseWarning("Table"),u=j.useMemo(()=>k(l||[]),[l]),[g,b]=j.useState(()=>M(u,!0)),m=j.useMemo(()=>{const d=M(u,!1);if(d.length===0)return d;let i=!0,h=!0;if(d.forEach(p=>{let{filteredKeys:a}=p;a!==void 0?i=!1:h=!1}),i){const p=(u||[]).map((a,y)=>C.getColumnKey(a,C.getColumnPos(y)));return g.filter(a=>{let{key:y}=a;return p.includes(y)}).map(a=>{const y=u[p.findIndex(w=>w===a.key)];return Object.assign(Object.assign({},a),{column:Object.assign(Object.assign({},a.column),y),forceFiltered:y.filtered})})}return process.env.NODE_ENV!=="production"&&n(h,"usage","Columns should all contain `filteredValue` or not contain `filteredValue`."),d},[u,g]),O=j.useMemo(()=>v(m),[m]),K=d=>{const i=m.filter(h=>{let{key:p}=h;return p!==d.key});i.push(d),b(i),e(v(i),i)};return[d=>P(t,o,d,m,s,K,f,void 0,c),m,O]},exports.getFilterData=D;
