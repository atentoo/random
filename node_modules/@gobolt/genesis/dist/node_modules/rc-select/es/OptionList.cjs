"use strict";const D=require("../../@babel/runtime/helpers/esm/defineProperty.cjs"),xe=require("../../@babel/runtime/helpers/esm/objectWithoutProperties.cjs"),K=require("../../@babel/runtime/helpers/esm/extends.cjs"),Pe=require("../../@babel/runtime/helpers/esm/slicedToArray.cjs"),re=require("../../@babel/runtime/helpers/esm/toConsumableArray.cjs"),oe=require("../../../_virtual/index.cjs"),d=require("../../rc-util/es/KeyCode.cjs"),Ce=require("../../rc-util/es/hooks/useMemo.cjs"),De=require("../../rc-util/es/omit.cjs"),ie=require("../../rc-util/es/pickAttrs.cjs"),ke=require("../../rc-virtual-list/es/List.cjs"),R=require("react"),Ie=require("./SelectContext.cjs"),Te=require("./TransBtn.cjs"),ze=require("./hooks/useBaseProps.cjs"),Me=require("./utils/platformUtil.cjs"),Ve=require("./utils/valueUtil.cjs");function Ae(f){const h=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(f){for(const l in f)if(l!=="default"){const q=Object.getOwnPropertyDescriptor(f,l);Object.defineProperty(h,l,q.get?q:{enumerable:!0,get:()=>f[l]})}}return h.default=f,Object.freeze(h)}const o=Ae(R);var Le=["disabled","title","children","style","className"];function ae(f){return typeof f=="string"||typeof f=="number"}var _e=function(f,h){var l=ze.default(),q=l.prefixCls,k=l.id,p=l.open,O=l.multiple,S=l.mode,w=l.searchValue,F=l.toggleOpen,ue=l.notFoundContent,ce=l.onPopupScroll,u=o.useContext(Ie),I=u.maxCount,U=u.flattenOptions,W=u.onActiveValue,se=u.defaultActiveFirstOption,de=u.onSelect,x=u.menuItemSelectedIcon,c=u.rawValues,B=u.fieldNames,P=u.virtual,fe=u.direction,ve=u.listHeight,me=u.listItemHeight,G=u.optionRender,g="".concat(q,"-item"),v=Ce(function(){return U},[p,U],function(e,t){return t[0]&&e[1]!==t[1]}),T=o.useRef(null),z=o.useMemo(function(){return O&&Ve.isValidCount(I)&&(c==null?void 0:c.size)>=I},[O,I,c==null?void 0:c.size]),J=function(e){e.preventDefault()},M=function(e){var t;(t=T.current)===null||t===void 0||t.scrollTo(typeof e=="number"?{index:e}:e)},Q=o.useCallback(function(e){return S!=="combobox"&&c.has(e)},[S,re(c).toString(),c.size]),V=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=v.length,n=0;n<i;n+=1){var r=(e+n*t+i)%i,s=v[r]||{},a=s.group,E=s.data;if(!a&&(E==null||!E.disabled)&&(Q(E.value)||!z))return r}return-1},pe=o.useState(function(){return V(0)}),X=Pe(pe,2),m=X[0],ge=X[1],C=function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];ge(e);var i={source:t?"keyboard":"mouse"},n=v[e];n?W(n.value,e,i):W(null,-1,i)};R.useEffect(function(){C(se!==!1?V(0):-1)},[v.length,w]);var Y=o.useCallback(function(e){return S==="combobox"?String(e).toLowerCase()===w.toLowerCase():c.has(e)},[S,w,re(c).toString(),c.size]);R.useEffect(function(){var e,t=setTimeout(function(){if(!O&&p&&c.size===1){var i=Array.from(c)[0],n=v.findIndex(function(r){return r.data.value===i});n!==-1&&(C(n),M(n))}});return p&&((e=T.current)===null||e===void 0||e.scrollTo(void 0)),function(){return clearTimeout(t)}},[p,w]);var A=function(e){e!==void 0&&de(e,{selected:!c.has(e)}),O||F(!1)};if(o.useImperativeHandle(h,function(){return{onKeyDown:function(e){var t=e.which,i=e.ctrlKey;switch(t){case d.N:case d.P:case d.UP:case d.DOWN:var n=0;if(t===d.UP?n=-1:t===d.DOWN?n=1:Me.isPlatformMac()&&i&&(t===d.N?n=1:t===d.P&&(n=-1)),n!==0){var r=V(m+n,n);M(r),C(r,!0)}break;case d.TAB:case d.ENTER:var s,a=v[m];!a||a!=null&&(s=a.data)!==null&&s!==void 0&&s.disabled||z?A(void 0):A(a.value),p&&e.preventDefault();break;case d.ESC:F(!1),p&&e.stopPropagation()}},onKeyUp:function(){},scrollTo:function(e){M(e)}}}),v.length===0)return o.createElement("div",{role:"listbox",id:"".concat(k,"_list"),className:"".concat(g,"-empty"),onMouseDown:J},ue);var be=Object.keys(B).map(function(e){return B[e]}),Z=function(e){return e.label};function $(e,t){return{role:e.group?"presentation":"option",id:"".concat(k,"_list_").concat(t)}}var L=function(e){var t=v[e];if(!t)return null;var i=t.data||{},n=i.value,r=t.group,s=ie(i,!0),a=Z(t);return t?o.createElement("div",K({"aria-label":typeof a!="string"||r?null:a},s,{key:e},$(t,e),{"aria-selected":Y(n)}),n):null},ee={role:"listbox",id:"".concat(k,"_list")};return o.createElement(o.Fragment,null,P&&o.createElement("div",K({},ee,{style:{height:0,width:0,overflow:"hidden"}}),L(m-1),L(m),L(m+1)),o.createElement(ke.default,{itemKey:"key",ref:T,data:v,height:ve,itemHeight:me,fullHeight:!1,onMouseDown:J,onScroll:ce,virtual:P,direction:fe,innerProps:P?null:ee},function(e,t){var i=e.group,n=e.groupOption,r=e.data,s=e.label,a=e.value,E=r.key;if(i){var _,ye=(_=r.title)!==null&&_!==void 0?_:ae(s)?s.toString():void 0;return o.createElement("div",{className:oe(g,"".concat(g,"-group"),r.className),title:ye},s!==void 0?s:E)}var he=r.disabled,te=r.title;r.children;var Ee=r.style,Ne=r.className,qe=xe(r,Le),Oe=De(qe,be),b=Q(a),N=he||!b&&z,y="".concat(g,"-option"),Se=oe(g,y,Ne,D(D(D(D({},"".concat(y,"-grouped"),n),"".concat(y,"-active"),m===t&&!N),"".concat(y,"-disabled"),N),"".concat(y,"-selected"),b)),j=Z(e),we=!x||typeof x=="function"||b,H=typeof j=="number"?j:j||a,ne=ae(H)?H.toString():void 0;return te!==void 0&&(ne=te),o.createElement("div",K({},ie(Oe),P?{}:$(e,t),{"aria-selected":Y(a),className:Se,title:ne,onMouseMove:function(){m===t||N||C(t)},onClick:function(){N||A(a)},style:Ee}),o.createElement("div",{className:"".concat(y,"-content")},typeof G=="function"?G(e,{index:t}):H),o.isValidElement(x)||b,we&&o.createElement(Te,{className:"".concat(g,"-option-state"),customizeIcon:x,customizeIconProps:{value:a,disabled:N,isSelected:b}},b?"âœ“":null))}))},le=o.forwardRef(_e);process.env.NODE_ENV!=="production"&&(le.displayName="OptionList"),module.exports=le;
